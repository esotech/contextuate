(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();/**
* @vue/shared v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function uo(e){const t=Object.create(null);for(const s of e.split(","))t[s]=1;return s=>s in t}const ke={},Xs=[],jt=()=>{},va=()=>!1,kr=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),fo=e=>e.startsWith("onUpdate:"),ct=Object.assign,_o=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},yc=Object.prototype.hasOwnProperty,be=(e,t)=>yc.call(e,t),re=Array.isArray,Gs=e=>Er(e)==="[object Map]",ma=e=>Er(e)==="[object Set]",le=e=>typeof e=="function",Ue=e=>typeof e=="string",ks=e=>typeof e=="symbol",Re=e=>e!==null&&typeof e=="object",Sa=e=>(Re(e)||le(e))&&le(e.then)&&le(e.catch),ba=Object.prototype.toString,Er=e=>ba.call(e),wc=e=>Er(e).slice(8,-1),ya=e=>Er(e)==="[object Object]",Mr=e=>Ue(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Si=uo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Rr=e=>{const t=Object.create(null);return(s=>t[s]||(t[s]=e(s)))},Cc=/-\w/g,Lt=Rr(e=>e.replace(Cc,t=>t.slice(1).toUpperCase())),xc=/\B([A-Z])/g,Es=Rr(e=>e.replace(xc,"-$1").toLowerCase()),Br=Rr(e=>e.charAt(0).toUpperCase()+e.slice(1)),Vr=Rr(e=>e?`on${Br(e)}`:""),ws=(e,t)=>!Object.is(e,t),Qi=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},wa=(e,t,s,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:s})},po=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let Ho;const Dr=()=>Ho||(Ho=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ut(e){if(re(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],r=Ue(i)?Rc(i):Ut(i);if(r)for(const n in r)t[n]=r[n]}return t}else if(Ue(e)||Re(e))return e}const kc=/;(?![^(]*\))/g,Ec=/:([^]+)/,Mc=/\/\*[^]*?\*\//g;function Rc(e){const t={};return e.replace(Mc,"").split(kc).forEach(s=>{if(s){const i=s.split(Ec);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function ve(e){let t="";if(Ue(e))t=e;else if(re(e))for(let s=0;s<e.length;s++){const i=ve(e[s]);i&&(t+=i+" ")}else if(Re(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const Bc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Dc=uo(Bc);function Ca(e){return!!e||e===""}const xa=e=>!!(e&&e.__v_isRef===!0),j=e=>Ue(e)?e:e==null?"":re(e)||Re(e)&&(e.toString===ba||!le(e.toString))?xa(e)?j(e.value):JSON.stringify(e,ka,2):String(e),ka=(e,t)=>xa(t)?ka(e,t.value):Gs(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[i,r],n)=>(s[jr(i,n)+" =>"]=r,s),{})}:ma(t)?{[`Set(${t.size})`]:[...t.values()].map(s=>jr(s))}:ks(t)?jr(t):Re(t)&&!re(t)&&!ya(t)?String(t):t,jr=(e,t="")=>{var s;return ks(e)?`Symbol(${(s=e.description)!=null?s:t})`:e};/**
* @vue/reactivity v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let lt;class Ea{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=lt,!t&&lt&&(this.index=(lt.scopes||(lt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].pause();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].resume();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].resume()}}run(t){if(this._active){const s=lt;try{return lt=this,t()}finally{lt=s}}}on(){++this._on===1&&(this.prevScope=lt,lt=this)}off(){this._on>0&&--this._on===0&&(lt=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let s,i;for(s=0,i=this.effects.length;s<i;s++)this.effects[s].stop();for(this.effects.length=0,s=0,i=this.cleanups.length;s<i;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,i=this.scopes.length;s<i;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function Ma(e){return new Ea(e)}function Ra(){return lt}function Tc(e,t=!1){lt&&lt.cleanups.push(e)}let Ee;const qr=new WeakSet;class Ba{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,lt&&lt.active&&lt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,qr.has(this)&&(qr.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Ta(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Wo(this),Pa(this);const t=Ee,s=Ot;Ee=this,Ot=!0;try{return this.fn()}finally{La(this),Ee=t,Ot=s,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)mo(t);this.deps=this.depsTail=void 0,Wo(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?qr.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){gn(this)&&this.run()}get dirty(){return gn(this)}}let Da=0,bi,yi;function Ta(e,t=!1){if(e.flags|=8,t){e.next=yi,yi=e;return}e.next=bi,bi=e}function go(){Da++}function vo(){if(--Da>0)return;if(yi){let t=yi;for(yi=void 0;t;){const s=t.next;t.next=void 0,t.flags&=-9,t=s}}let e;for(;bi;){let t=bi;for(bi=void 0;t;){const s=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(i){e||(e=i)}t=s}}if(e)throw e}function Pa(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function La(e){let t,s=e.depsTail,i=s;for(;i;){const r=i.prevDep;i.version===-1?(i===s&&(s=r),mo(i),Pc(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=r}e.deps=t,e.depsTail=s}function gn(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Ia(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Ia(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Bi)||(e.globalVersion=Bi,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!gn(e))))return;e.flags|=2;const t=e.dep,s=Ee,i=Ot;Ee=e,Ot=!0;try{Pa(e);const r=e.fn(e._value);(t.version===0||ws(r,e._value))&&(e.flags|=128,e._value=r,t.version++)}catch(r){throw t.version++,r}finally{Ee=s,Ot=i,La(e),e.flags&=-3}}function mo(e,t=!1){const{dep:s,prevSub:i,nextSub:r}=e;if(i&&(i.nextSub=r,e.prevSub=void 0),r&&(r.prevSub=i,e.nextSub=void 0),s.subs===e&&(s.subs=i,!i&&s.computed)){s.computed.flags&=-5;for(let n=s.computed.deps;n;n=n.nextDep)mo(n,!0)}!t&&!--s.sc&&s.map&&s.map.delete(s.key)}function Pc(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let Ot=!0;const Aa=[];function ns(){Aa.push(Ot),Ot=!1}function os(){const e=Aa.pop();Ot=e===void 0?!0:e}function Wo(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const s=Ee;Ee=void 0;try{t()}finally{Ee=s}}}let Bi=0;class Lc{constructor(t,s){this.sub=t,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class So{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!Ee||!Ot||Ee===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==Ee)s=this.activeLink=new Lc(Ee,this),Ee.deps?(s.prevDep=Ee.depsTail,Ee.depsTail.nextDep=s,Ee.depsTail=s):Ee.deps=Ee.depsTail=s,Oa(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const i=s.nextDep;i.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=i),s.prevDep=Ee.depsTail,s.nextDep=void 0,Ee.depsTail.nextDep=s,Ee.depsTail=s,Ee.deps===s&&(Ee.deps=i)}return s}trigger(t){this.version++,Bi++,this.notify(t)}notify(t){go();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{vo()}}}function Oa(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let i=t.deps;i;i=i.nextDep)Oa(i)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const cr=new WeakMap,Is=Symbol(""),vn=Symbol(""),Di=Symbol("");function at(e,t,s){if(Ot&&Ee){let i=cr.get(e);i||cr.set(e,i=new Map);let r=i.get(s);r||(i.set(s,r=new So),r.map=i,r.key=s),r.track()}}function ts(e,t,s,i,r,n){const o=cr.get(e);if(!o){Bi++;return}const l=a=>{a&&a.trigger()};if(go(),t==="clear")o.forEach(l);else{const a=re(e),h=a&&Mr(s);if(a&&s==="length"){const c=Number(i);o.forEach((u,d)=>{(d==="length"||d===Di||!ks(d)&&d>=c)&&l(u)})}else switch((s!==void 0||o.has(void 0))&&l(o.get(s)),h&&l(o.get(Di)),t){case"add":a?h&&l(o.get("length")):(l(o.get(Is)),Gs(e)&&l(o.get(vn)));break;case"delete":a||(l(o.get(Is)),Gs(e)&&l(o.get(vn)));break;case"set":Gs(e)&&l(o.get(Is));break}}vo()}function Ic(e,t){const s=cr.get(e);return s&&s.get(t)}function zs(e){const t=ge(e);return t===e?t:(at(t,"iterate",Di),Mt(e)?t:t.map(Nt))}function Tr(e){return at(e=ge(e),"iterate",Di),e}function vs(e,t){return ls(e)?rs(e)?Zs(Nt(t)):Zs(t):Nt(t)}const Ac={__proto__:null,[Symbol.iterator](){return Yr(this,Symbol.iterator,e=>vs(this,e))},concat(...e){return zs(this).concat(...e.map(t=>re(t)?zs(t):t))},entries(){return Yr(this,"entries",e=>(e[1]=vs(this,e[1]),e))},every(e,t){return Zt(this,"every",e,t,void 0,arguments)},filter(e,t){return Zt(this,"filter",e,t,s=>s.map(i=>vs(this,i)),arguments)},find(e,t){return Zt(this,"find",e,t,s=>vs(this,s),arguments)},findIndex(e,t){return Zt(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Zt(this,"findLast",e,t,s=>vs(this,s),arguments)},findLastIndex(e,t){return Zt(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Zt(this,"forEach",e,t,void 0,arguments)},includes(...e){return Xr(this,"includes",e)},indexOf(...e){return Xr(this,"indexOf",e)},join(e){return zs(this).join(e)},lastIndexOf(...e){return Xr(this,"lastIndexOf",e)},map(e,t){return Zt(this,"map",e,t,void 0,arguments)},pop(){return ri(this,"pop")},push(...e){return ri(this,"push",e)},reduce(e,...t){return Fo(this,"reduce",e,t)},reduceRight(e,...t){return Fo(this,"reduceRight",e,t)},shift(){return ri(this,"shift")},some(e,t){return Zt(this,"some",e,t,void 0,arguments)},splice(...e){return ri(this,"splice",e)},toReversed(){return zs(this).toReversed()},toSorted(e){return zs(this).toSorted(e)},toSpliced(...e){return zs(this).toSpliced(...e)},unshift(...e){return ri(this,"unshift",e)},values(){return Yr(this,"values",e=>vs(this,e))}};function Yr(e,t,s){const i=Tr(e),r=i[t]();return i!==e&&!Mt(e)&&(r._next=r.next,r.next=()=>{const n=r._next();return n.done||(n.value=s(n.value)),n}),r}const Oc=Array.prototype;function Zt(e,t,s,i,r,n){const o=Tr(e),l=o!==e&&!Mt(e),a=o[t];if(a!==Oc[t]){const u=a.apply(e,n);return l?Nt(u):u}let h=s;o!==e&&(l?h=function(u,d){return s.call(this,vs(e,u),d,e)}:s.length>2&&(h=function(u,d){return s.call(this,u,d,e)}));const c=a.call(o,h,i);return l&&r?r(c):c}function Fo(e,t,s,i){const r=Tr(e);let n=s;return r!==e&&(Mt(e)?s.length>3&&(n=function(o,l,a){return s.call(this,o,l,a,e)}):n=function(o,l,a){return s.call(this,o,vs(e,l),a,e)}),r[t](n,...i)}function Xr(e,t,s){const i=ge(e);at(i,"iterate",Di);const r=i[t](...s);return(r===-1||r===!1)&&Lr(s[0])?(s[0]=ge(s[0]),i[t](...s)):r}function ri(e,t,s=[]){ns(),go();const i=ge(e)[t].apply(e,s);return vo(),os(),i}const Nc=uo("__proto__,__v_isRef,__isVue"),Na=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ks));function $c(e){ks(e)||(e=String(e));const t=ge(this);return at(t,"has",e),t.hasOwnProperty(e)}class $a{constructor(t=!1,s=!1){this._isReadonly=t,this._isShallow=s}get(t,s,i){if(s==="__v_skip")return t.__v_skip;const r=this._isReadonly,n=this._isShallow;if(s==="__v_isReactive")return!r;if(s==="__v_isReadonly")return r;if(s==="__v_isShallow")return n;if(s==="__v_raw")return i===(r?n?Yc:za:n?Fa:Wa).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const o=re(t);if(!r){let a;if(o&&(a=Ac[s]))return a;if(s==="hasOwnProperty")return $c}const l=Reflect.get(t,s,Ie(t)?t:i);if((ks(s)?Na.has(s):Nc(s))||(r||at(t,"get",s),n))return l;if(Ie(l)){const a=o&&Mr(s)?l:l.value;return r&&Re(a)?Sn(a):a}return Re(l)?r?Sn(l):Pr(l):l}}class Ha extends $a{constructor(t=!1){super(!1,t)}set(t,s,i,r){let n=t[s];const o=re(t)&&Mr(s);if(!this._isShallow){const h=ls(n);if(!Mt(i)&&!ls(i)&&(n=ge(n),i=ge(i)),!o&&Ie(n)&&!Ie(i))return h||(n.value=i),!0}const l=o?Number(s)<t.length:be(t,s),a=Reflect.set(t,s,i,Ie(t)?t:r);return t===ge(r)&&(l?ws(i,n)&&ts(t,"set",s,i):ts(t,"add",s,i)),a}deleteProperty(t,s){const i=be(t,s);t[s];const r=Reflect.deleteProperty(t,s);return r&&i&&ts(t,"delete",s,void 0),r}has(t,s){const i=Reflect.has(t,s);return(!ks(s)||!Na.has(s))&&at(t,"has",s),i}ownKeys(t){return at(t,"iterate",re(t)?"length":Is),Reflect.ownKeys(t)}}class Hc extends $a{constructor(t=!1){super(!0,t)}set(t,s){return!0}deleteProperty(t,s){return!0}}const Wc=new Ha,Fc=new Hc,zc=new Ha(!0);const mn=e=>e,Ui=e=>Reflect.getPrototypeOf(e);function Kc(e,t,s){return function(...i){const r=this.__v_raw,n=ge(r),o=Gs(n),l=e==="entries"||e===Symbol.iterator&&o,a=e==="keys"&&o,h=r[e](...i),c=s?mn:t?Zs:Nt;return!t&&at(n,"iterate",a?vn:Is),{next(){const{value:u,done:d}=h.next();return d?{value:u,done:d}:{value:l?[c(u[0]),c(u[1])]:c(u),done:d}},[Symbol.iterator](){return this}}}}function Vi(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function Uc(e,t){const s={get(r){const n=this.__v_raw,o=ge(n),l=ge(r);e||(ws(r,l)&&at(o,"get",r),at(o,"get",l));const{has:a}=Ui(o),h=t?mn:e?Zs:Nt;if(a.call(o,r))return h(n.get(r));if(a.call(o,l))return h(n.get(l));n!==o&&n.get(r)},get size(){const r=this.__v_raw;return!e&&at(ge(r),"iterate",Is),r.size},has(r){const n=this.__v_raw,o=ge(n),l=ge(r);return e||(ws(r,l)&&at(o,"has",r),at(o,"has",l)),r===l?n.has(r):n.has(r)||n.has(l)},forEach(r,n){const o=this,l=o.__v_raw,a=ge(l),h=t?mn:e?Zs:Nt;return!e&&at(a,"iterate",Is),l.forEach((c,u)=>r.call(n,h(c),h(u),o))}};return ct(s,e?{add:Vi("add"),set:Vi("set"),delete:Vi("delete"),clear:Vi("clear")}:{add(r){!t&&!Mt(r)&&!ls(r)&&(r=ge(r));const n=ge(this);return Ui(n).has.call(n,r)||(n.add(r),ts(n,"add",r,r)),this},set(r,n){!t&&!Mt(n)&&!ls(n)&&(n=ge(n));const o=ge(this),{has:l,get:a}=Ui(o);let h=l.call(o,r);h||(r=ge(r),h=l.call(o,r));const c=a.call(o,r);return o.set(r,n),h?ws(n,c)&&ts(o,"set",r,n):ts(o,"add",r,n),this},delete(r){const n=ge(this),{has:o,get:l}=Ui(n);let a=o.call(n,r);a||(r=ge(r),a=o.call(n,r)),l&&l.call(n,r);const h=n.delete(r);return a&&ts(n,"delete",r,void 0),h},clear(){const r=ge(this),n=r.size!==0,o=r.clear();return n&&ts(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{s[r]=Kc(r,e,t)}),s}function bo(e,t){const s=Uc(e,t);return(i,r,n)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?i:Reflect.get(be(s,r)&&r in i?s:i,r,n)}const Vc={get:bo(!1,!1)},jc={get:bo(!1,!0)},qc={get:bo(!0,!1)};const Wa=new WeakMap,Fa=new WeakMap,za=new WeakMap,Yc=new WeakMap;function Xc(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Gc(e){return e.__v_skip||!Object.isExtensible(e)?0:Xc(wc(e))}function Pr(e){return ls(e)?e:yo(e,!1,Wc,Vc,Wa)}function Jc(e){return yo(e,!1,zc,jc,Fa)}function Sn(e){return yo(e,!0,Fc,qc,za)}function yo(e,t,s,i,r){if(!Re(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const n=Gc(e);if(n===0)return e;const o=r.get(e);if(o)return o;const l=new Proxy(e,n===2?i:s);return r.set(e,l),l}function rs(e){return ls(e)?rs(e.__v_raw):!!(e&&e.__v_isReactive)}function ls(e){return!!(e&&e.__v_isReadonly)}function Mt(e){return!!(e&&e.__v_isShallow)}function Lr(e){return e?!!e.__v_raw:!1}function ge(e){const t=e&&e.__v_raw;return t?ge(t):e}function wo(e){return!be(e,"__v_skip")&&Object.isExtensible(e)&&wa(e,"__v_skip",!0),e}const Nt=e=>Re(e)?Pr(e):e,Zs=e=>Re(e)?Sn(e):e;function Ie(e){return e?e.__v_isRef===!0:!1}function ue(e){return Zc(e,!1)}function Zc(e,t){return Ie(e)?e:new Qc(e,t)}class Qc{constructor(t,s){this.dep=new So,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?t:ge(t),this._value=s?t:Nt(t),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(t){const s=this._rawValue,i=this.__v_isShallow||Mt(t)||ls(t);t=i?t:ge(t),ws(t,s)&&(this._rawValue=t,this._value=i?t:Nt(t),this.dep.trigger())}}function $e(e){return Ie(e)?e.value:e}const eu={get:(e,t,s)=>t==="__v_raw"?e:$e(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const r=e[t];return Ie(r)&&!Ie(s)?(r.value=s,!0):Reflect.set(e,t,s,i)}};function Ka(e){return rs(e)?e:new Proxy(e,eu)}function tu(e){const t=re(e)?new Array(e.length):{};for(const s in e)t[s]=iu(e,s);return t}class su{constructor(t,s,i){this._object=t,this._key=s,this._defaultValue=i,this.__v_isRef=!0,this._value=void 0,this._raw=ge(t);let r=!0,n=t;if(!re(t)||!Mr(String(s)))do r=!Lr(n)||Mt(n);while(r&&(n=n.__v_raw));this._shallow=r}get value(){let t=this._object[this._key];return this._shallow&&(t=$e(t)),this._value=t===void 0?this._defaultValue:t}set value(t){if(this._shallow&&Ie(this._raw[this._key])){const s=this._object[this._key];if(Ie(s)){s.value=t;return}}this._object[this._key]=t}get dep(){return Ic(this._raw,this._key)}}function iu(e,t,s){return new su(e,t,s)}class ru{constructor(t,s,i){this.fn=t,this.setter=s,this._value=void 0,this.dep=new So(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Bi-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&Ee!==this)return Ta(this,!0),!0}get value(){const t=this.dep.track();return Ia(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function nu(e,t,s=!1){let i,r;return le(e)?i=e:(i=e.get,r=e.set),new ru(i,r,s)}const ji={},ur=new WeakMap;let Ds;function ou(e,t=!1,s=Ds){if(s){let i=ur.get(s);i||ur.set(s,i=[]),i.push(e)}}function lu(e,t,s=ke){const{immediate:i,deep:r,once:n,scheduler:o,augmentJob:l,call:a}=s,h=C=>r?C:Mt(C)||r===!1||r===0?ss(C,1):ss(C);let c,u,d,f,_=!1,v=!1;if(Ie(e)?(u=()=>e.value,_=Mt(e)):rs(e)?(u=()=>h(e),_=!0):re(e)?(v=!0,_=e.some(C=>rs(C)||Mt(C)),u=()=>e.map(C=>{if(Ie(C))return C.value;if(rs(C))return h(C);if(le(C))return a?a(C,2):C()})):le(e)?t?u=a?()=>a(e,2):e:u=()=>{if(d){ns();try{d()}finally{os()}}const C=Ds;Ds=c;try{return a?a(e,3,[f]):e(f)}finally{Ds=C}}:u=jt,t&&r){const C=u,N=r===!0?1/0:r;u=()=>ss(C(),N)}const b=Ra(),m=()=>{c.stop(),b&&b.active&&_o(b.effects,c)};if(n&&t){const C=t;t=(...N)=>{C(...N),m()}}let y=v?new Array(e.length).fill(ji):ji;const k=C=>{if(!(!(c.flags&1)||!c.dirty&&!C))if(t){const N=c.run();if(r||_||(v?N.some((X,ne)=>ws(X,y[ne])):ws(N,y))){d&&d();const X=Ds;Ds=c;try{const ne=[N,y===ji?void 0:v&&y[0]===ji?[]:y,f];y=N,a?a(t,3,ne):t(...ne)}finally{Ds=X}}}else c.run()};return l&&l(k),c=new Ba(u),c.scheduler=o?()=>o(k,!1):k,f=C=>ou(C,!1,c),d=c.onStop=()=>{const C=ur.get(c);if(C){if(a)a(C,4);else for(const N of C)N();ur.delete(c)}},t?i?k(!0):y=c.run():o?o(k.bind(null,!0),!0):c.run(),m.pause=c.pause.bind(c),m.resume=c.resume.bind(c),m.stop=m,m}function ss(e,t=1/0,s){if(t<=0||!Re(e)||e.__v_skip||(s=s||new Map,(s.get(e)||0)>=t))return e;if(s.set(e,t),t--,Ie(e))ss(e.value,t,s);else if(re(e))for(let i=0;i<e.length;i++)ss(e[i],t,s);else if(ma(e)||Gs(e))e.forEach(i=>{ss(i,t,s)});else if(ya(e)){for(const i in e)ss(e[i],t,s);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&ss(e[i],t,s)}return e}/**
* @vue/runtime-core v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ni(e,t,s,i){try{return i?e(...i):e()}catch(r){Ir(r,t,s)}}function Yt(e,t,s,i){if(le(e)){const r=Ni(e,t,s,i);return r&&Sa(r)&&r.catch(n=>{Ir(n,t,s)}),r}if(re(e)){const r=[];for(let n=0;n<e.length;n++)r.push(Yt(e[n],t,s,i));return r}}function Ir(e,t,s,i=!0){const r=t?t.vnode:null,{errorHandler:n,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||ke;if(t){let l=t.parent;const a=t.proxy,h=`https://vuejs.org/error-reference/#runtime-${s}`;for(;l;){const c=l.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](e,a,h)===!1)return}l=l.parent}if(n){ns(),Ni(n,null,10,[e,a,h]),os();return}}au(e,s,r,i,o)}function au(e,t,s,i=!0,r=!1){if(r)throw e;console.error(e)}const ft=[];let zt=-1;const Js=[];let ms=null,js=0;const Ua=Promise.resolve();let dr=null;function Qs(e){const t=dr||Ua;return e?t.then(this?e.bind(this):e):t}function hu(e){let t=zt+1,s=ft.length;for(;t<s;){const i=t+s>>>1,r=ft[i],n=Ti(r);n<e||n===e&&r.flags&2?t=i+1:s=i}return t}function Co(e){if(!(e.flags&1)){const t=Ti(e),s=ft[ft.length-1];!s||!(e.flags&2)&&t>=Ti(s)?ft.push(e):ft.splice(hu(t),0,e),e.flags|=1,Va()}}function Va(){dr||(dr=Ua.then(qa))}function cu(e){re(e)?Js.push(...e):ms&&e.id===-1?ms.splice(js+1,0,e):e.flags&1||(Js.push(e),e.flags|=1),Va()}function zo(e,t,s=zt+1){for(;s<ft.length;s++){const i=ft[s];if(i&&i.flags&2){if(e&&i.id!==e.uid)continue;ft.splice(s,1),s--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function ja(e){if(Js.length){const t=[...new Set(Js)].sort((s,i)=>Ti(s)-Ti(i));if(Js.length=0,ms){ms.push(...t);return}for(ms=t,js=0;js<ms.length;js++){const s=ms[js];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}ms=null,js=0}}const Ti=e=>e.id==null?e.flags&2?-1:1/0:e.id;function qa(e){try{for(zt=0;zt<ft.length;zt++){const t=ft[zt];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Ni(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;zt<ft.length;zt++){const t=ft[zt];t&&(t.flags&=-2)}zt=-1,ft.length=0,ja(),dr=null,(ft.length||Js.length)&&qa()}}let kt=null,Ya=null;function fr(e){const t=kt;return kt=e,Ya=e&&e.type.__scopeId||null,t}function uu(e,t=kt,s){if(!t||e._n)return e;const i=(...r)=>{i._d&&gr(-1);const n=fr(t);let o;try{o=e(...r)}finally{fr(n),i._d&&gr(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function Xa(e,t){if(kt===null)return e;const s=Hr(kt),i=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[n,o,l,a=ke]=t[r];n&&(le(n)&&(n={mounted:n,updated:n}),n.deep&&ss(o),i.push({dir:n,instance:s,value:o,oldValue:void 0,arg:l,modifiers:a}))}return e}function Ms(e,t,s,i){const r=e.dirs,n=t&&t.dirs;for(let o=0;o<r.length;o++){const l=r[o];n&&(l.oldValue=n[o].value);let a=l.dir[i];a&&(ns(),Yt(a,s,8,[e.el,l,e,t]),os())}}function du(e,t){if(ht){let s=ht.provides;const i=ht.parent&&ht.parent.provides;i===s&&(s=ht.provides=Object.create(i)),s[e]=t}}function wi(e,t,s=!1){const i=Sh();if(i||Os){let r=Os?Os._context.provides:i?i.parent==null||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(r&&e in r)return r[e];if(arguments.length>1)return s&&le(t)?t.call(i&&i.proxy):t}}function fu(){return!!(Sh()||Os)}const _u=Symbol.for("v-scx"),pu=()=>wi(_u);function As(e,t,s){return Ga(e,t,s)}function Ga(e,t,s=ke){const{immediate:i,deep:r,flush:n,once:o}=s,l=ct({},s),a=t&&i||!t&&n!=="post";let h;if(Li){if(n==="sync"){const f=pu();h=f.__watcherHandles||(f.__watcherHandles=[])}else if(!a){const f=()=>{};return f.stop=jt,f.resume=jt,f.pause=jt,f}}const c=ht;l.call=(f,_,v)=>Yt(f,c,_,v);let u=!1;n==="post"?l.scheduler=f=>{Ct(f,c&&c.suspense)}:n!=="sync"&&(u=!0,l.scheduler=(f,_)=>{_?f():Co(f)}),l.augmentJob=f=>{t&&(f.flags|=4),u&&(f.flags|=2,c&&(f.id=c.uid,f.i=c))};const d=lu(e,t,l);return Li&&(h?h.push(d):a&&d()),d}function gu(e,t,s){const i=this.proxy,r=Ue(e)?e.includes(".")?Ja(i,e):()=>i[e]:e.bind(i,i);let n;le(t)?n=t:(n=t.handler,s=t);const o=Hi(this),l=Ga(r,n.bind(i),s);return o(),l}function Ja(e,t){const s=t.split(".");return()=>{let i=e;for(let r=0;r<s.length&&i;r++)i=i[s[r]];return i}}const vu=Symbol("_vte"),mu=e=>e.__isTeleport,Su=Symbol("_leaveCb");function xo(e,t){e.shapeFlag&6&&e.component?(e.transition=t,xo(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Gt(e,t){return le(e)?ct({name:e.name},t,{setup:e}):e}function Za(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const _r=new WeakMap;function Ci(e,t,s,i,r=!1){if(re(e)){e.forEach((_,v)=>Ci(_,t&&(re(t)?t[v]:t),s,i,r));return}if(xi(i)&&!r){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&Ci(e,t,s,i.component.subTree);return}const n=i.shapeFlag&4?Hr(i.component):i.el,o=r?null:n,{i:l,r:a}=e,h=t&&t.r,c=l.refs===ke?l.refs={}:l.refs,u=l.setupState,d=ge(u),f=u===ke?va:_=>be(d,_);if(h!=null&&h!==a){if(Ko(t),Ue(h))c[h]=null,f(h)&&(u[h]=null);else if(Ie(h)){h.value=null;const _=t;_.k&&(c[_.k]=null)}}if(le(a))Ni(a,l,12,[o,c]);else{const _=Ue(a),v=Ie(a);if(_||v){const b=()=>{if(e.f){const m=_?f(a)?u[a]:c[a]:a.value;if(r)re(m)&&_o(m,n);else if(re(m))m.includes(n)||m.push(n);else if(_)c[a]=[n],f(a)&&(u[a]=c[a]);else{const y=[n];a.value=y,e.k&&(c[e.k]=y)}}else _?(c[a]=o,f(a)&&(u[a]=o)):v&&(a.value=o,e.k&&(c[e.k]=o))};if(o){const m=()=>{b(),_r.delete(e)};m.id=-1,_r.set(e,m),Ct(m,s)}else Ko(e),b()}}}function Ko(e){const t=_r.get(e);t&&(t.flags|=8,_r.delete(e))}Dr().requestIdleCallback;Dr().cancelIdleCallback;const xi=e=>!!e.type.__asyncLoader,Qa=e=>e.type.__isKeepAlive;function bu(e,t){eh(e,"a",t)}function yu(e,t){eh(e,"da",t)}function eh(e,t,s=ht){const i=e.__wdc||(e.__wdc=()=>{let r=s;for(;r;){if(r.isDeactivated)return;r=r.parent}return e()});if(Ar(t,i,s),s){let r=s.parent;for(;r&&r.parent;)Qa(r.parent.vnode)&&wu(i,t,s,r),r=r.parent}}function wu(e,t,s,i){const r=Ar(t,e,i,!0);$i(()=>{_o(i[t],r)},s)}function Ar(e,t,s=ht,i=!1){if(s){const r=s[e]||(s[e]=[]),n=t.__weh||(t.__weh=(...o)=>{ns();const l=Hi(s),a=Yt(t,s,e,o);return l(),os(),a});return i?r.unshift(n):r.push(n),n}}const as=e=>(t,s=ht)=>{(!Li||e==="sp")&&Ar(e,(...i)=>t(...i),s)},Cu=as("bm"),Or=as("m"),xu=as("bu"),ku=as("u"),Eu=as("bum"),$i=as("um"),Mu=as("sp"),Ru=as("rtg"),Bu=as("rtc");function Du(e,t=ht){Ar("ec",e,t)}const Tu="components";function Uo(e,t){return Lu(Tu,e,!0,t)||e}const Pu=Symbol.for("v-ndc");function Lu(e,t,s=!0,i=!1){const r=kt||ht;if(r){const n=r.type;{const l=vd(n,!1);if(l&&(l===t||l===Lt(t)||l===Br(Lt(t))))return n}const o=Vo(r[e]||n[e],t)||Vo(r.appContext[e],t);return!o&&i?n:o}}function Vo(e,t){return e&&(e[t]||e[Lt(t)]||e[Br(Lt(t))])}function _t(e,t,s,i){let r;const n=s,o=re(e);if(o||Ue(e)){const l=o&&rs(e);let a=!1,h=!1;l&&(a=!Mt(e),h=ls(e),e=Tr(e)),r=new Array(e.length);for(let c=0,u=e.length;c<u;c++)r[c]=t(a?h?Zs(Nt(e[c])):Nt(e[c]):e[c],c,void 0,n)}else if(typeof e=="number"){r=new Array(e);for(let l=0;l<e;l++)r[l]=t(l+1,l,void 0,n)}else if(Re(e))if(e[Symbol.iterator])r=Array.from(e,(l,a)=>t(l,a,void 0,n));else{const l=Object.keys(e);r=new Array(l.length);for(let a=0,h=l.length;a<h;a++){const c=l[a];r[a]=t(e[c],c,a,n)}}else r=[];return r}const bn=e=>e?bh(e)?Hr(e):bn(e.parent):null,ki=ct(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>bn(e.parent),$root:e=>bn(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>sh(e),$forceUpdate:e=>e.f||(e.f=()=>{Co(e.update)}),$nextTick:e=>e.n||(e.n=Qs.bind(e.proxy)),$watch:e=>gu.bind(e)}),Gr=(e,t)=>e!==ke&&!e.__isScriptSetup&&be(e,t),Iu={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:s,setupState:i,data:r,props:n,accessCache:o,type:l,appContext:a}=e;if(t[0]!=="$"){const d=o[t];if(d!==void 0)switch(d){case 1:return i[t];case 2:return r[t];case 4:return s[t];case 3:return n[t]}else{if(Gr(i,t))return o[t]=1,i[t];if(r!==ke&&be(r,t))return o[t]=2,r[t];if(be(n,t))return o[t]=3,n[t];if(s!==ke&&be(s,t))return o[t]=4,s[t];yn&&(o[t]=0)}}const h=ki[t];let c,u;if(h)return t==="$attrs"&&at(e.attrs,"get",""),h(e);if((c=l.__cssModules)&&(c=c[t]))return c;if(s!==ke&&be(s,t))return o[t]=4,s[t];if(u=a.config.globalProperties,be(u,t))return u[t]},set({_:e},t,s){const{data:i,setupState:r,ctx:n}=e;return Gr(r,t)?(r[t]=s,!0):i!==ke&&be(i,t)?(i[t]=s,!0):be(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(n[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:r,props:n,type:o}},l){let a;return!!(s[l]||e!==ke&&l[0]!=="$"&&be(e,l)||Gr(t,l)||be(n,l)||be(i,l)||be(ki,l)||be(r.config.globalProperties,l)||(a=o.__cssModules)&&a[l])},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:be(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function jo(e){return re(e)?e.reduce((t,s)=>(t[s]=null,t),{}):e}let yn=!0;function Au(e){const t=sh(e),s=e.proxy,i=e.ctx;yn=!1,t.beforeCreate&&qo(t.beforeCreate,e,"bc");const{data:r,computed:n,methods:o,watch:l,provide:a,inject:h,created:c,beforeMount:u,mounted:d,beforeUpdate:f,updated:_,activated:v,deactivated:b,beforeDestroy:m,beforeUnmount:y,destroyed:k,unmounted:C,render:N,renderTracked:X,renderTriggered:ne,errorCaptured:G,serverPrefetch:Q,expose:pe,inheritAttrs:oe,components:$,directives:M,filters:A}=t;if(h&&Ou(h,i,null),o)for(const F in o){const P=o[F];le(P)&&(i[F]=P.bind(s))}if(r){const F=r.call(s,s);Re(F)&&(e.data=Pr(F))}if(yn=!0,n)for(const F in n){const P=n[F],de=le(P)?P.bind(s,s):le(P.get)?P.get.bind(s,s):jt,Be=!le(P)&&le(P.set)?P.set.bind(s):jt,We=_e({get:de,set:Be});Object.defineProperty(i,F,{enumerable:!0,configurable:!0,get:()=>We.value,set:Oe=>We.value=Oe})}if(l)for(const F in l)th(l[F],i,s,F);if(a){const F=le(a)?a.call(s):a;Reflect.ownKeys(F).forEach(P=>{du(P,F[P])})}c&&qo(c,e,"c");function H(F,P){re(P)?P.forEach(de=>F(de.bind(s))):P&&F(P.bind(s))}if(H(Cu,u),H(Or,d),H(xu,f),H(ku,_),H(bu,v),H(yu,b),H(Du,G),H(Bu,X),H(Ru,ne),H(Eu,y),H($i,C),H(Mu,Q),re(pe))if(pe.length){const F=e.exposed||(e.exposed={});pe.forEach(P=>{Object.defineProperty(F,P,{get:()=>s[P],set:de=>s[P]=de,enumerable:!0})})}else e.exposed||(e.exposed={});N&&e.render===jt&&(e.render=N),oe!=null&&(e.inheritAttrs=oe),$&&(e.components=$),M&&(e.directives=M),Q&&Za(e)}function Ou(e,t,s=jt){re(e)&&(e=wn(e));for(const i in e){const r=e[i];let n;Re(r)?"default"in r?n=wi(r.from||i,r.default,!0):n=wi(r.from||i):n=wi(r),Ie(n)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>n.value,set:o=>n.value=o}):t[i]=n}}function qo(e,t,s){Yt(re(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,s)}function th(e,t,s,i){let r=i.includes(".")?Ja(s,i):()=>s[i];if(Ue(e)){const n=t[e];le(n)&&As(r,n)}else if(le(e))As(r,e.bind(s));else if(Re(e))if(re(e))e.forEach(n=>th(n,t,s,i));else{const n=le(e.handler)?e.handler.bind(s):t[e.handler];le(n)&&As(r,n,e)}}function sh(e){const t=e.type,{mixins:s,extends:i}=t,{mixins:r,optionsCache:n,config:{optionMergeStrategies:o}}=e.appContext,l=n.get(t);let a;return l?a=l:!r.length&&!s&&!i?a=t:(a={},r.length&&r.forEach(h=>pr(a,h,o,!0)),pr(a,t,o)),Re(t)&&n.set(t,a),a}function pr(e,t,s,i=!1){const{mixins:r,extends:n}=t;n&&pr(e,n,s,!0),r&&r.forEach(o=>pr(e,o,s,!0));for(const o in t)if(!(i&&o==="expose")){const l=Nu[o]||s&&s[o];e[o]=l?l(e[o],t[o]):t[o]}return e}const Nu={data:Yo,props:Xo,emits:Xo,methods:di,computed:di,beforeCreate:ut,created:ut,beforeMount:ut,mounted:ut,beforeUpdate:ut,updated:ut,beforeDestroy:ut,beforeUnmount:ut,destroyed:ut,unmounted:ut,activated:ut,deactivated:ut,errorCaptured:ut,serverPrefetch:ut,components:di,directives:di,watch:Hu,provide:Yo,inject:$u};function Yo(e,t){return t?e?function(){return ct(le(e)?e.call(this,this):e,le(t)?t.call(this,this):t)}:t:e}function $u(e,t){return di(wn(e),wn(t))}function wn(e){if(re(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function ut(e,t){return e?[...new Set([].concat(e,t))]:t}function di(e,t){return e?ct(Object.create(null),e,t):t}function Xo(e,t){return e?re(e)&&re(t)?[...new Set([...e,...t])]:ct(Object.create(null),jo(e),jo(t??{})):t}function Hu(e,t){if(!e)return t;if(!t)return e;const s=ct(Object.create(null),e);for(const i in t)s[i]=ut(e[i],t[i]);return s}function ih(){return{app:null,config:{isNativeTag:va,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Wu=0;function Fu(e,t){return function(i,r=null){le(i)||(i=ct({},i)),r!=null&&!Re(r)&&(r=null);const n=ih(),o=new WeakSet,l=[];let a=!1;const h=n.app={_uid:Wu++,_component:i,_props:r,_container:null,_context:n,_instance:null,version:Sd,get config(){return n.config},set config(c){},use(c,...u){return o.has(c)||(c&&le(c.install)?(o.add(c),c.install(h,...u)):le(c)&&(o.add(c),c(h,...u))),h},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),h},component(c,u){return u?(n.components[c]=u,h):n.components[c]},directive(c,u){return u?(n.directives[c]=u,h):n.directives[c]},mount(c,u,d){if(!a){const f=h._ceVNode||He(i,r);return f.appContext=n,d===!0?d="svg":d===!1&&(d=void 0),e(f,c,d),a=!0,h._container=c,c.__vue_app__=h,Hr(f.component)}},onUnmount(c){l.push(c)},unmount(){a&&(Yt(l,h._instance,16),e(null,h._container),delete h._container.__vue_app__)},provide(c,u){return n.provides[c]=u,h},runWithContext(c){const u=Os;Os=h;try{return c()}finally{Os=u}}};return h}}let Os=null;const zu=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Lt(t)}Modifiers`]||e[`${Es(t)}Modifiers`];function Ku(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||ke;let r=s;const n=t.startsWith("update:"),o=n&&zu(i,t.slice(7));o&&(o.trim&&(r=s.map(c=>Ue(c)?c.trim():c)),o.number&&(r=s.map(po)));let l,a=i[l=Vr(t)]||i[l=Vr(Lt(t))];!a&&n&&(a=i[l=Vr(Es(t))]),a&&Yt(a,e,6,r);const h=i[l+"Once"];if(h){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,Yt(h,e,6,r)}}const Uu=new WeakMap;function rh(e,t,s=!1){const i=s?Uu:t.emitsCache,r=i.get(e);if(r!==void 0)return r;const n=e.emits;let o={},l=!1;if(!le(e)){const a=h=>{const c=rh(h,t,!0);c&&(l=!0,ct(o,c))};!s&&t.mixins.length&&t.mixins.forEach(a),e.extends&&a(e.extends),e.mixins&&e.mixins.forEach(a)}return!n&&!l?(Re(e)&&i.set(e,null),null):(re(n)?n.forEach(a=>o[a]=null):ct(o,n),Re(e)&&i.set(e,o),o)}function Nr(e,t){return!e||!kr(t)?!1:(t=t.slice(2).replace(/Once$/,""),be(e,t[0].toLowerCase()+t.slice(1))||be(e,Es(t))||be(e,t))}function Go(e){const{type:t,vnode:s,proxy:i,withProxy:r,propsOptions:[n],slots:o,attrs:l,emit:a,render:h,renderCache:c,props:u,data:d,setupState:f,ctx:_,inheritAttrs:v}=e,b=fr(e);let m,y;try{if(s.shapeFlag&4){const C=r||i,N=C;m=Kt(h.call(N,C,c,u,f,d,_)),y=l}else{const C=t;m=Kt(C.length>1?C(u,{attrs:l,slots:o,emit:a}):C(u,null)),y=t.props?l:Vu(l)}}catch(C){Ei.length=0,Ir(C,e,1),m=He(xs)}let k=m;if(y&&v!==!1){const C=Object.keys(y),{shapeFlag:N}=k;C.length&&N&7&&(n&&C.some(fo)&&(y=ju(y,n)),k=ei(k,y,!1,!0))}return s.dirs&&(k=ei(k,null,!1,!0),k.dirs=k.dirs?k.dirs.concat(s.dirs):s.dirs),s.transition&&xo(k,s.transition),m=k,fr(b),m}const Vu=e=>{let t;for(const s in e)(s==="class"||s==="style"||kr(s))&&((t||(t={}))[s]=e[s]);return t},ju=(e,t)=>{const s={};for(const i in e)(!fo(i)||!(i.slice(9)in t))&&(s[i]=e[i]);return s};function qu(e,t,s){const{props:i,children:r,component:n}=e,{props:o,children:l,patchFlag:a}=t,h=n.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&a>=0){if(a&1024)return!0;if(a&16)return i?Jo(i,o,h):!!o;if(a&8){const c=t.dynamicProps;for(let u=0;u<c.length;u++){const d=c[u];if(o[d]!==i[d]&&!Nr(h,d))return!0}}}else return(r||l)&&(!l||!l.$stable)?!0:i===o?!1:i?o?Jo(i,o,h):!0:!!o;return!1}function Jo(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let r=0;r<i.length;r++){const n=i[r];if(t[n]!==e[n]&&!Nr(s,n))return!0}return!1}function Yu({vnode:e,parent:t},s){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i===e)(e=t.vnode).el=s,t=t.parent;else break}}const nh={},oh=()=>Object.create(nh),lh=e=>Object.getPrototypeOf(e)===nh;function Xu(e,t,s,i=!1){const r={},n=oh();e.propsDefaults=Object.create(null),ah(e,t,r,n);for(const o in e.propsOptions[0])o in r||(r[o]=void 0);s?e.props=i?r:Jc(r):e.type.props?e.props=r:e.props=n,e.attrs=n}function Gu(e,t,s,i){const{props:r,attrs:n,vnode:{patchFlag:o}}=e,l=ge(r),[a]=e.propsOptions;let h=!1;if((i||o>0)&&!(o&16)){if(o&8){const c=e.vnode.dynamicProps;for(let u=0;u<c.length;u++){let d=c[u];if(Nr(e.emitsOptions,d))continue;const f=t[d];if(a)if(be(n,d))f!==n[d]&&(n[d]=f,h=!0);else{const _=Lt(d);r[_]=Cn(a,l,_,f,e,!1)}else f!==n[d]&&(n[d]=f,h=!0)}}}else{ah(e,t,r,n)&&(h=!0);let c;for(const u in l)(!t||!be(t,u)&&((c=Es(u))===u||!be(t,c)))&&(a?s&&(s[u]!==void 0||s[c]!==void 0)&&(r[u]=Cn(a,l,u,void 0,e,!0)):delete r[u]);if(n!==l)for(const u in n)(!t||!be(t,u))&&(delete n[u],h=!0)}h&&ts(e.attrs,"set","")}function ah(e,t,s,i){const[r,n]=e.propsOptions;let o=!1,l;if(t)for(let a in t){if(Si(a))continue;const h=t[a];let c;r&&be(r,c=Lt(a))?!n||!n.includes(c)?s[c]=h:(l||(l={}))[c]=h:Nr(e.emitsOptions,a)||(!(a in i)||h!==i[a])&&(i[a]=h,o=!0)}if(n){const a=ge(s),h=l||ke;for(let c=0;c<n.length;c++){const u=n[c];s[u]=Cn(r,a,u,h[u],e,!be(h,u))}}return o}function Cn(e,t,s,i,r,n){const o=e[s];if(o!=null){const l=be(o,"default");if(l&&i===void 0){const a=o.default;if(o.type!==Function&&!o.skipFactory&&le(a)){const{propsDefaults:h}=r;if(s in h)i=h[s];else{const c=Hi(r);i=h[s]=a.call(null,t),c()}}else i=a;r.ce&&r.ce._setProp(s,i)}o[0]&&(n&&!l?i=!1:o[1]&&(i===""||i===Es(s))&&(i=!0))}return i}const Ju=new WeakMap;function hh(e,t,s=!1){const i=s?Ju:t.propsCache,r=i.get(e);if(r)return r;const n=e.props,o={},l=[];let a=!1;if(!le(e)){const c=u=>{a=!0;const[d,f]=hh(u,t,!0);ct(o,d),f&&l.push(...f)};!s&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!n&&!a)return Re(e)&&i.set(e,Xs),Xs;if(re(n))for(let c=0;c<n.length;c++){const u=Lt(n[c]);Zo(u)&&(o[u]=ke)}else if(n)for(const c in n){const u=Lt(c);if(Zo(u)){const d=n[c],f=o[u]=re(d)||le(d)?{type:d}:ct({},d),_=f.type;let v=!1,b=!0;if(re(_))for(let m=0;m<_.length;++m){const y=_[m],k=le(y)&&y.name;if(k==="Boolean"){v=!0;break}else k==="String"&&(b=!1)}else v=le(_)&&_.name==="Boolean";f[0]=v,f[1]=b,(v||be(f,"default"))&&l.push(u)}}const h=[o,l];return Re(e)&&i.set(e,h),h}function Zo(e){return e[0]!=="$"&&!Si(e)}const ko=e=>e==="_"||e==="_ctx"||e==="$stable",Eo=e=>re(e)?e.map(Kt):[Kt(e)],Zu=(e,t,s)=>{if(t._n)return t;const i=uu((...r)=>Eo(t(...r)),s);return i._c=!1,i},ch=(e,t,s)=>{const i=e._ctx;for(const r in e){if(ko(r))continue;const n=e[r];if(le(n))t[r]=Zu(r,n,i);else if(n!=null){const o=Eo(n);t[r]=()=>o}}},uh=(e,t)=>{const s=Eo(t);e.slots.default=()=>s},dh=(e,t,s)=>{for(const i in t)(s||!ko(i))&&(e[i]=t[i])},Qu=(e,t,s)=>{const i=e.slots=oh();if(e.vnode.shapeFlag&32){const r=t._;r?(dh(i,t,s),s&&wa(i,"_",r,!0)):ch(t,i)}else t&&uh(e,t)},ed=(e,t,s)=>{const{vnode:i,slots:r}=e;let n=!0,o=ke;if(i.shapeFlag&32){const l=t._;l?s&&l===1?n=!1:dh(r,t,s):(n=!t.$stable,ch(t,r)),o=t}else t&&(uh(e,t),o={default:1});if(n)for(const l in r)!ko(l)&&o[l]==null&&delete r[l]},Ct=nd;function td(e){return sd(e)}function sd(e,t){const s=Dr();s.__VUE__=!0;const{insert:i,remove:r,patchProp:n,createElement:o,createText:l,createComment:a,setText:h,setElementText:c,parentNode:u,nextSibling:d,setScopeId:f=jt,insertStaticContent:_}=e,v=(g,S,x,I=null,D=null,T=null,V=void 0,K=null,z=!!S.dynamicChildren)=>{if(g===S)return;g&&!ni(g,S)&&(I=mt(g),Oe(g,D,T,!0),g=null),S.patchFlag===-2&&(z=!1,S.dynamicChildren=null);const{type:L,ref:ee,shapeFlag:q}=S;switch(L){case $r:b(g,S,x,I);break;case xs:m(g,S,x,I);break;case er:g==null&&y(S,x,I,V);break;case ye:$(g,S,x,I,D,T,V,K,z);break;default:q&1?N(g,S,x,I,D,T,V,K,z):q&6?M(g,S,x,I,D,T,V,K,z):(q&64||q&128)&&L.process(g,S,x,I,D,T,V,K,z,Rt)}ee!=null&&D?Ci(ee,g&&g.ref,T,S||g,!S):ee==null&&g&&g.ref!=null&&Ci(g.ref,null,T,g,!0)},b=(g,S,x,I)=>{if(g==null)i(S.el=l(S.children),x,I);else{const D=S.el=g.el;S.children!==g.children&&h(D,S.children)}},m=(g,S,x,I)=>{g==null?i(S.el=a(S.children||""),x,I):S.el=g.el},y=(g,S,x,I)=>{[g.el,g.anchor]=_(g.children,S,x,I,g.el,g.anchor)},k=({el:g,anchor:S},x,I)=>{let D;for(;g&&g!==S;)D=d(g),i(g,x,I),g=D;i(S,x,I)},C=({el:g,anchor:S})=>{let x;for(;g&&g!==S;)x=d(g),r(g),g=x;r(S)},N=(g,S,x,I,D,T,V,K,z)=>{if(S.type==="svg"?V="svg":S.type==="math"&&(V="mathml"),g==null)X(S,x,I,D,T,V,K,z);else{const L=g.el&&g.el._isVueCE?g.el:null;try{L&&L._beginPatch(),Q(g,S,D,T,V,K,z)}finally{L&&L._endPatch()}}},X=(g,S,x,I,D,T,V,K)=>{let z,L;const{props:ee,shapeFlag:q,transition:J,dirs:te}=g;if(z=g.el=o(g.type,T,ee&&ee.is,ee),q&8?c(z,g.children):q&16&&G(g.children,z,null,I,D,Jr(g,T),V,K),te&&Ms(g,null,I,"created"),ne(z,g,g.scopeId,V,I),ee){for(const Ce in ee)Ce!=="value"&&!Si(Ce)&&n(z,Ce,null,ee[Ce],T,I);"value"in ee&&n(z,"value",null,ee.value,T),(L=ee.onVnodeBeforeMount)&&$t(L,I,g)}te&&Ms(g,null,I,"beforeMount");const ce=id(D,J);ce&&J.beforeEnter(z),i(z,S,x),((L=ee&&ee.onVnodeMounted)||ce||te)&&Ct(()=>{L&&$t(L,I,g),ce&&J.enter(z),te&&Ms(g,null,I,"mounted")},D)},ne=(g,S,x,I,D)=>{if(x&&f(g,x),I)for(let T=0;T<I.length;T++)f(g,I[T]);if(D){let T=D.subTree;if(S===T||gh(T.type)&&(T.ssContent===S||T.ssFallback===S)){const V=D.vnode;ne(g,V,V.scopeId,V.slotScopeIds,D.parent)}}},G=(g,S,x,I,D,T,V,K,z=0)=>{for(let L=z;L<g.length;L++){const ee=g[L]=K?Ss(g[L]):Kt(g[L]);v(null,ee,S,x,I,D,T,V,K)}},Q=(g,S,x,I,D,T,V)=>{const K=S.el=g.el;let{patchFlag:z,dynamicChildren:L,dirs:ee}=S;z|=g.patchFlag&16;const q=g.props||ke,J=S.props||ke;let te;if(x&&Rs(x,!1),(te=J.onVnodeBeforeUpdate)&&$t(te,x,S,g),ee&&Ms(S,g,x,"beforeUpdate"),x&&Rs(x,!0),(q.innerHTML&&J.innerHTML==null||q.textContent&&J.textContent==null)&&c(K,""),L?pe(g.dynamicChildren,L,K,x,I,Jr(S,D),T):V||P(g,S,K,null,x,I,Jr(S,D),T,!1),z>0){if(z&16)oe(K,q,J,x,D);else if(z&2&&q.class!==J.class&&n(K,"class",null,J.class,D),z&4&&n(K,"style",q.style,J.style,D),z&8){const ce=S.dynamicProps;for(let Ce=0;Ce<ce.length;Ce++){const me=ce[Ce],w=q[me],O=J[me];(O!==w||me==="value")&&n(K,me,w,O,D,x)}}z&1&&g.children!==S.children&&c(K,S.children)}else!V&&L==null&&oe(K,q,J,x,D);((te=J.onVnodeUpdated)||ee)&&Ct(()=>{te&&$t(te,x,S,g),ee&&Ms(S,g,x,"updated")},I)},pe=(g,S,x,I,D,T,V)=>{for(let K=0;K<S.length;K++){const z=g[K],L=S[K],ee=z.el&&(z.type===ye||!ni(z,L)||z.shapeFlag&198)?u(z.el):x;v(z,L,ee,null,I,D,T,V,!0)}},oe=(g,S,x,I,D)=>{if(S!==x){if(S!==ke)for(const T in S)!Si(T)&&!(T in x)&&n(g,T,S[T],null,D,I);for(const T in x){if(Si(T))continue;const V=x[T],K=S[T];V!==K&&T!=="value"&&n(g,T,K,V,D,I)}"value"in x&&n(g,"value",S.value,x.value,D)}},$=(g,S,x,I,D,T,V,K,z)=>{const L=S.el=g?g.el:l(""),ee=S.anchor=g?g.anchor:l("");let{patchFlag:q,dynamicChildren:J,slotScopeIds:te}=S;te&&(K=K?K.concat(te):te),g==null?(i(L,x,I),i(ee,x,I),G(S.children||[],x,ee,D,T,V,K,z)):q>0&&q&64&&J&&g.dynamicChildren&&g.dynamicChildren.length===J.length?(pe(g.dynamicChildren,J,x,D,T,V,K),(S.key!=null||D&&S===D.subTree)&&fh(g,S,!0)):P(g,S,x,ee,D,T,V,K,z)},M=(g,S,x,I,D,T,V,K,z)=>{S.slotScopeIds=K,g==null?S.shapeFlag&512?D.ctx.activate(S,x,I,V,z):A(S,x,I,D,T,V,z):U(g,S,z)},A=(g,S,x,I,D,T,V)=>{const K=g.component=dd(g,I,D);if(Qa(g)&&(K.ctx.renderer=Rt),fd(K,!1,V),K.asyncDep){if(D&&D.registerDep(K,H,V),!g.el){const z=K.subTree=He(xs);m(null,z,S,x),g.placeholder=z.el}}else H(K,g,S,x,D,T,V)},U=(g,S,x)=>{const I=S.component=g.component;if(qu(g,S,x))if(I.asyncDep&&!I.asyncResolved){F(I,S,x);return}else I.next=S,I.update();else S.el=g.el,I.vnode=S},H=(g,S,x,I,D,T,V)=>{const K=()=>{if(g.isMounted){let{next:q,bu:J,u:te,parent:ce,vnode:Ce}=g;{const we=_h(g);if(we){q&&(q.el=Ce.el,F(g,q,V)),we.asyncDep.then(()=>{g.isUnmounted||K()});return}}let me=q,w;Rs(g,!1),q?(q.el=Ce.el,F(g,q,V)):q=Ce,J&&Qi(J),(w=q.props&&q.props.onVnodeBeforeUpdate)&&$t(w,ce,q,Ce),Rs(g,!0);const O=Go(g),fe=g.subTree;g.subTree=O,v(fe,O,u(fe.el),mt(fe),g,D,T),q.el=O.el,me===null&&Yu(g,O.el),te&&Ct(te,D),(w=q.props&&q.props.onVnodeUpdated)&&Ct(()=>$t(w,ce,q,Ce),D)}else{let q;const{el:J,props:te}=S,{bm:ce,m:Ce,parent:me,root:w,type:O}=g,fe=xi(S);Rs(g,!1),ce&&Qi(ce),!fe&&(q=te&&te.onVnodeBeforeMount)&&$t(q,me,S),Rs(g,!0);{w.ce&&w.ce._def.shadowRoot!==!1&&w.ce._injectChildStyle(O);const we=g.subTree=Go(g);v(null,we,x,I,g,D,T),S.el=we.el}if(Ce&&Ct(Ce,D),!fe&&(q=te&&te.onVnodeMounted)){const we=S;Ct(()=>$t(q,me,we),D)}(S.shapeFlag&256||me&&xi(me.vnode)&&me.vnode.shapeFlag&256)&&g.a&&Ct(g.a,D),g.isMounted=!0,S=x=I=null}};g.scope.on();const z=g.effect=new Ba(K);g.scope.off();const L=g.update=z.run.bind(z),ee=g.job=z.runIfDirty.bind(z);ee.i=g,ee.id=g.uid,z.scheduler=()=>Co(ee),Rs(g,!0),L()},F=(g,S,x)=>{S.component=g;const I=g.vnode.props;g.vnode=S,g.next=null,Gu(g,S.props,I,x),ed(g,S.children,x),ns(),zo(g),os()},P=(g,S,x,I,D,T,V,K,z=!1)=>{const L=g&&g.children,ee=g?g.shapeFlag:0,q=S.children,{patchFlag:J,shapeFlag:te}=S;if(J>0){if(J&128){Be(L,q,x,I,D,T,V,K,z);return}else if(J&256){de(L,q,x,I,D,T,V,K,z);return}}te&8?(ee&16&&Fe(L,D,T),q!==L&&c(x,q)):ee&16?te&16?Be(L,q,x,I,D,T,V,K,z):Fe(L,D,T,!0):(ee&8&&c(x,""),te&16&&G(q,x,I,D,T,V,K,z))},de=(g,S,x,I,D,T,V,K,z)=>{g=g||Xs,S=S||Xs;const L=g.length,ee=S.length,q=Math.min(L,ee);let J;for(J=0;J<q;J++){const te=S[J]=z?Ss(S[J]):Kt(S[J]);v(g[J],te,x,null,D,T,V,K,z)}L>ee?Fe(g,D,T,!0,!1,q):G(S,x,I,D,T,V,K,z,q)},Be=(g,S,x,I,D,T,V,K,z)=>{let L=0;const ee=S.length;let q=g.length-1,J=ee-1;for(;L<=q&&L<=J;){const te=g[L],ce=S[L]=z?Ss(S[L]):Kt(S[L]);if(ni(te,ce))v(te,ce,x,null,D,T,V,K,z);else break;L++}for(;L<=q&&L<=J;){const te=g[q],ce=S[J]=z?Ss(S[J]):Kt(S[J]);if(ni(te,ce))v(te,ce,x,null,D,T,V,K,z);else break;q--,J--}if(L>q){if(L<=J){const te=J+1,ce=te<ee?S[te].el:I;for(;L<=J;)v(null,S[L]=z?Ss(S[L]):Kt(S[L]),x,ce,D,T,V,K,z),L++}}else if(L>J)for(;L<=q;)Oe(g[L],D,T,!0),L++;else{const te=L,ce=L,Ce=new Map;for(L=ce;L<=J;L++){const Ve=S[L]=z?Ss(S[L]):Kt(S[L]);Ve.key!=null&&Ce.set(Ve.key,L)}let me,w=0;const O=J-ce+1;let fe=!1,we=0;const Ge=new Array(O);for(L=0;L<O;L++)Ge[L]=0;for(L=te;L<=q;L++){const Ve=g[L];if(w>=O){Oe(Ve,D,T,!0);continue}let ie;if(Ve.key!=null)ie=Ce.get(Ve.key);else for(me=ce;me<=J;me++)if(Ge[me-ce]===0&&ni(Ve,S[me])){ie=me;break}ie===void 0?Oe(Ve,D,T,!0):(Ge[ie-ce]=L+1,ie>=we?we=ie:fe=!0,v(Ve,S[ie],x,null,D,T,V,K,z),w++)}const It=fe?rd(Ge):Xs;for(me=It.length-1,L=O-1;L>=0;L--){const Ve=ce+L,ie=S[Ve],Se=S[Ve+1],Fs=Ve+1<ee?Se.el||ph(Se):I;Ge[L]===0?v(null,ie,x,Fs,D,T,V,K,z):fe&&(me<0||L!==It[me]?We(ie,x,Fs,2):me--)}}},We=(g,S,x,I,D=null)=>{const{el:T,type:V,transition:K,children:z,shapeFlag:L}=g;if(L&6){We(g.component.subTree,S,x,I);return}if(L&128){g.suspense.move(S,x,I);return}if(L&64){V.move(g,S,x,Rt);return}if(V===ye){i(T,S,x);for(let q=0;q<z.length;q++)We(z[q],S,x,I);i(g.anchor,S,x);return}if(V===er){k(g,S,x);return}if(I!==2&&L&1&&K)if(I===0)K.beforeEnter(T),i(T,S,x),Ct(()=>K.enter(T),D);else{const{leave:q,delayLeave:J,afterLeave:te}=K,ce=()=>{g.ctx.isUnmounted?r(T):i(T,S,x)},Ce=()=>{T._isLeaving&&T[Su](!0),q(T,()=>{ce(),te&&te()})};J?J(T,ce,Ce):Ce()}else i(T,S,x)},Oe=(g,S,x,I=!1,D=!1)=>{const{type:T,props:V,ref:K,children:z,dynamicChildren:L,shapeFlag:ee,patchFlag:q,dirs:J,cacheIndex:te}=g;if(q===-2&&(D=!1),K!=null&&(ns(),Ci(K,null,x,g,!0),os()),te!=null&&(S.renderCache[te]=void 0),ee&256){S.ctx.deactivate(g);return}const ce=ee&1&&J,Ce=!xi(g);let me;if(Ce&&(me=V&&V.onVnodeBeforeUnmount)&&$t(me,S,g),ee&6)vt(g.component,x,I);else{if(ee&128){g.suspense.unmount(x,I);return}ce&&Ms(g,null,S,"beforeUnmount"),ee&64?g.type.remove(g,S,x,Rt,I):L&&!L.hasOnce&&(T!==ye||q>0&&q&64)?Fe(L,S,x,!1,!0):(T===ye&&q&384||!D&&ee&16)&&Fe(z,S,x),I&&it(g)}(Ce&&(me=V&&V.onVnodeUnmounted)||ce)&&Ct(()=>{me&&$t(me,S,g),ce&&Ms(g,null,S,"unmounted")},x)},it=g=>{const{type:S,el:x,anchor:I,transition:D}=g;if(S===ye){Xe(x,I);return}if(S===er){C(g);return}const T=()=>{r(x),D&&!D.persisted&&D.afterLeave&&D.afterLeave()};if(g.shapeFlag&1&&D&&!D.persisted){const{leave:V,delayLeave:K}=D,z=()=>V(x,T);K?K(g.el,T,z):z()}else T()},Xe=(g,S)=>{let x;for(;g!==S;)x=d(g),r(g),g=x;r(S)},vt=(g,S,x)=>{const{bum:I,scope:D,job:T,subTree:V,um:K,m:z,a:L}=g;Qo(z),Qo(L),I&&Qi(I),D.stop(),T&&(T.flags|=8,Oe(V,g,S,x)),K&&Ct(K,S),Ct(()=>{g.isUnmounted=!0},S)},Fe=(g,S,x,I=!1,D=!1,T=0)=>{for(let V=T;V<g.length;V++)Oe(g[V],S,x,I,D)},mt=g=>{if(g.shapeFlag&6)return mt(g.component.subTree);if(g.shapeFlag&128)return g.suspense.next();const S=d(g.anchor||g.el),x=S&&S[vu];return x?d(x):S};let Jt=!1;const bt=(g,S,x)=>{let I;g==null?S._vnode&&(Oe(S._vnode,null,null,!0),I=S._vnode.component):v(S._vnode||null,g,S,null,null,null,x),S._vnode=g,Jt||(Jt=!0,zo(I),ja(),Jt=!1)},Rt={p:v,um:Oe,m:We,r:it,mt:A,mc:G,pc:P,pbc:pe,n:mt,o:e};return{render:bt,hydrate:void 0,createApp:Fu(bt)}}function Jr({type:e,props:t},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function Rs({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function id(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function fh(e,t,s=!1){const i=e.children,r=t.children;if(re(i)&&re(r))for(let n=0;n<i.length;n++){const o=i[n];let l=r[n];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=r[n]=Ss(r[n]),l.el=o.el),!s&&l.patchFlag!==-2&&fh(o,l)),l.type===$r&&(l.patchFlag!==-1?l.el=o.el:l.__elIndex=n+(e.type===ye?1:0)),l.type===xs&&!l.el&&(l.el=o.el)}}function rd(e){const t=e.slice(),s=[0];let i,r,n,o,l;const a=e.length;for(i=0;i<a;i++){const h=e[i];if(h!==0){if(r=s[s.length-1],e[r]<h){t[i]=r,s.push(i);continue}for(n=0,o=s.length-1;n<o;)l=n+o>>1,e[s[l]]<h?n=l+1:o=l;h<e[s[n]]&&(n>0&&(t[i]=s[n-1]),s[n]=i)}}for(n=s.length,o=s[n-1];n-- >0;)s[n]=o,o=t[o];return s}function _h(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:_h(t)}function Qo(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function ph(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?ph(t.subTree):null}const gh=e=>e.__isSuspense;function nd(e,t){t&&t.pendingBranch?re(e)?t.effects.push(...e):t.effects.push(e):cu(e)}const ye=Symbol.for("v-fgt"),$r=Symbol.for("v-txt"),xs=Symbol.for("v-cmt"),er=Symbol.for("v-stc"),Ei=[];let Et=null;function R(e=!1){Ei.push(Et=e?null:[])}function od(){Ei.pop(),Et=Ei[Ei.length-1]||null}let Pi=1;function gr(e,t=!1){Pi+=e,e<0&&Et&&t&&(Et.hasOnce=!0)}function vh(e){return e.dynamicChildren=Pi>0?Et||Xs:null,od(),Pi>0&&Et&&Et.push(e),e}function B(e,t,s,i,r,n){return vh(p(e,t,s,i,r,n,!0))}function tr(e,t,s,i,r){return vh(He(e,t,s,i,r,!0))}function vr(e){return e?e.__v_isVNode===!0:!1}function ni(e,t){return e.type===t.type&&e.key===t.key}const mh=({key:e})=>e??null,sr=({ref:e,ref_key:t,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?Ue(e)||Ie(e)||le(e)?{i:kt,r:e,k:t,f:!!s}:e:null);function p(e,t=null,s=null,i=0,r=null,n=e===ye?0:1,o=!1,l=!1){const a={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&mh(t),ref:t&&sr(t),scopeId:Ya,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:kt};return l?(Ro(a,s),n&128&&e.normalize(a)):s&&(a.shapeFlag|=Ue(s)?8:16),Pi>0&&!o&&Et&&(a.patchFlag>0||n&6)&&a.patchFlag!==32&&Et.push(a),a}const He=ld;function ld(e,t=null,s=null,i=0,r=null,n=!1){if((!e||e===Pu)&&(e=xs),vr(e)){const l=ei(e,t,!0);return s&&Ro(l,s),Pi>0&&!n&&Et&&(l.shapeFlag&6?Et[Et.indexOf(e)]=l:Et.push(l)),l.patchFlag=-2,l}if(md(e)&&(e=e.__vccOpts),t){t=ad(t);let{class:l,style:a}=t;l&&!Ue(l)&&(t.class=ve(l)),Re(a)&&(Lr(a)&&!re(a)&&(a=ct({},a)),t.style=Ut(a))}const o=Ue(e)?1:gh(e)?128:mu(e)?64:Re(e)?4:le(e)?2:0;return p(e,t,s,i,r,o,n,!0)}function ad(e){return e?Lr(e)||lh(e)?ct({},e):e:null}function ei(e,t,s=!1,i=!1){const{props:r,ref:n,patchFlag:o,children:l,transition:a}=e,h=t?hd(r||{},t):r,c={__v_isVNode:!0,__v_skip:!0,type:e.type,props:h,key:h&&mh(h),ref:t&&t.ref?s&&n?re(n)?n.concat(sr(t)):[n,sr(t)]:sr(t):n,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ye?o===-1?16:o|16:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:a,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ei(e.ssContent),ssFallback:e.ssFallback&&ei(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return a&&i&&xo(c,a.clone(c)),c}function xt(e=" ",t=0){return He($r,null,e,t)}function Mo(e,t){const s=He(er,null,e);return s.staticCount=t,s}function Z(e="",t=!1){return t?(R(),tr(xs,null,e)):He(xs,null,e)}function Kt(e){return e==null||typeof e=="boolean"?He(xs):re(e)?He(ye,null,e.slice()):vr(e)?Ss(e):He($r,null,String(e))}function Ss(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:ei(e)}function Ro(e,t){let s=0;const{shapeFlag:i}=e;if(t==null)t=null;else if(re(t))s=16;else if(typeof t=="object")if(i&65){const r=t.default;r&&(r._c&&(r._d=!1),Ro(e,r()),r._c&&(r._d=!0));return}else{s=32;const r=t._;!r&&!lh(t)?t._ctx=kt:r===3&&kt&&(kt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else le(t)?(t={default:t,_ctx:kt},s=32):(t=String(t),i&64?(s=16,t=[xt(t)]):s=8);e.children=t,e.shapeFlag|=s}function hd(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const r in i)if(r==="class")t.class!==i.class&&(t.class=ve([t.class,i.class]));else if(r==="style")t.style=Ut([t.style,i.style]);else if(kr(r)){const n=t[r],o=i[r];o&&n!==o&&!(re(n)&&n.includes(o))&&(t[r]=n?[].concat(n,o):o)}else r!==""&&(t[r]=i[r])}return t}function $t(e,t,s,i=null){Yt(e,t,7,[s,i])}const cd=ih();let ud=0;function dd(e,t,s){const i=e.type,r=(t?t.appContext:e.appContext)||cd,n={uid:ud++,vnode:e,type:i,parent:t,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ea(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(r.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:hh(i,r),emitsOptions:rh(i,r),emit:null,emitted:null,propsDefaults:ke,inheritAttrs:i.inheritAttrs,ctx:ke,data:ke,props:ke,attrs:ke,slots:ke,refs:ke,setupState:ke,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=t?t.root:n,n.emit=Ku.bind(null,n),e.ce&&e.ce(n),n}let ht=null;const Sh=()=>ht||kt;let mr,xn;{const e=Dr(),t=(s,i)=>{let r;return(r=e[s])||(r=e[s]=[]),r.push(i),n=>{r.length>1?r.forEach(o=>o(n)):r[0](n)}};mr=t("__VUE_INSTANCE_SETTERS__",s=>ht=s),xn=t("__VUE_SSR_SETTERS__",s=>Li=s)}const Hi=e=>{const t=ht;return mr(e),e.scope.on(),()=>{e.scope.off(),mr(t)}},el=()=>{ht&&ht.scope.off(),mr(null)};function bh(e){return e.vnode.shapeFlag&4}let Li=!1;function fd(e,t=!1,s=!1){t&&xn(t);const{props:i,children:r}=e.vnode,n=bh(e);Xu(e,i,n,t),Qu(e,r,s||t);const o=n?_d(e,t):void 0;return t&&xn(!1),o}function _d(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Iu);const{setup:i}=s;if(i){ns();const r=e.setupContext=i.length>1?gd(e):null,n=Hi(e),o=Ni(i,e,0,[e.props,r]),l=Sa(o);if(os(),n(),(l||e.sp)&&!xi(e)&&Za(e),l){if(o.then(el,el),t)return o.then(a=>{tl(e,a)}).catch(a=>{Ir(a,e,0)});e.asyncDep=o}else tl(e,o)}else yh(e)}function tl(e,t,s){le(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Re(t)&&(e.setupState=Ka(t)),yh(e)}function yh(e,t,s){const i=e.type;e.render||(e.render=i.render||jt);{const r=Hi(e);ns();try{Au(e)}finally{os(),r()}}}const pd={get(e,t){return at(e,"get",""),e[t]}};function gd(e){const t=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,pd),slots:e.slots,emit:e.emit,expose:t}}function Hr(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Ka(wo(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in ki)return ki[s](e)},has(t,s){return s in t||s in ki}})):e.proxy}function vd(e,t=!0){return le(e)?e.displayName||e.name:e.name||t&&e.__name}function md(e){return le(e)&&"__vccOpts"in e}const _e=(e,t)=>nu(e,t,Li);function Je(e,t,s){try{gr(-1);const i=arguments.length;return i===2?Re(t)&&!re(t)?vr(t)?He(e,null,[t]):He(e,t):He(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):i===3&&vr(s)&&(s=[s]),He(e,t,s))}finally{gr(1)}}const Sd="3.5.26";/**
* @vue/runtime-dom v3.5.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let kn;const sl=typeof window<"u"&&window.trustedTypes;if(sl)try{kn=sl.createPolicy("vue",{createHTML:e=>e})}catch{}const wh=kn?e=>kn.createHTML(e):e=>e,bd="http://www.w3.org/2000/svg",yd="http://www.w3.org/1998/Math/MathML",es=typeof document<"u"?document:null,il=es&&es.createElement("template"),wd={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const r=t==="svg"?es.createElementNS(bd,e):t==="mathml"?es.createElementNS(yd,e):s?es.createElement(e,{is:s}):es.createElement(e);return e==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:e=>es.createTextNode(e),createComment:e=>es.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>es.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,i,r,n){const o=s?s.previousSibling:t.lastChild;if(r&&(r===n||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),s),!(r===n||!(r=r.nextSibling)););else{il.innerHTML=wh(i==="svg"?`<svg>${e}</svg>`:i==="mathml"?`<math>${e}</math>`:e);const l=il.content;if(i==="svg"||i==="mathml"){const a=l.firstChild;for(;a.firstChild;)l.appendChild(a.firstChild);l.removeChild(a)}t.insertBefore(l,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},Cd=Symbol("_vtc");function xd(e,t,s){const i=e[Cd];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}const rl=Symbol("_vod"),kd=Symbol("_vsh"),Ed=Symbol(""),Md=/(?:^|;)\s*display\s*:/;function Rd(e,t,s){const i=e.style,r=Ue(s);let n=!1;if(s&&!r){if(t)if(Ue(t))for(const o of t.split(";")){const l=o.slice(0,o.indexOf(":")).trim();s[l]==null&&ir(i,l,"")}else for(const o in t)s[o]==null&&ir(i,o,"");for(const o in s)o==="display"&&(n=!0),ir(i,o,s[o])}else if(r){if(t!==s){const o=i[Ed];o&&(s+=";"+o),i.cssText=s,n=Md.test(s)}}else t&&e.removeAttribute("style");rl in e&&(e[rl]=n?i.display:"",e[kd]&&(i.display="none"))}const nl=/\s*!important$/;function ir(e,t,s){if(re(s))s.forEach(i=>ir(e,t,i));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const i=Bd(e,t);nl.test(s)?e.setProperty(Es(i),s.replace(nl,""),"important"):e[i]=s}}const ol=["Webkit","Moz","ms"],Zr={};function Bd(e,t){const s=Zr[t];if(s)return s;let i=Lt(t);if(i!=="filter"&&i in e)return Zr[t]=i;i=Br(i);for(let r=0;r<ol.length;r++){const n=ol[r]+i;if(n in e)return Zr[t]=n}return t}const ll="http://www.w3.org/1999/xlink";function al(e,t,s,i,r,n=Dc(t)){i&&t.startsWith("xlink:")?s==null?e.removeAttributeNS(ll,t.slice(6,t.length)):e.setAttributeNS(ll,t,s):s==null||n&&!Ca(s)?e.removeAttribute(t):e.setAttribute(t,n?"":ks(s)?String(s):s)}function hl(e,t,s,i,r){if(t==="innerHTML"||t==="textContent"){s!=null&&(e[t]=t==="innerHTML"?wh(s):s);return}const n=e.tagName;if(t==="value"&&n!=="PROGRESS"&&!n.includes("-")){const l=n==="OPTION"?e.getAttribute("value")||"":e.value,a=s==null?e.type==="checkbox"?"on":"":String(s);(l!==a||!("_value"in e))&&(e.value=a),s==null&&e.removeAttribute(t),e._value=s;return}let o=!1;if(s===""||s==null){const l=typeof e[t];l==="boolean"?s=Ca(s):s==null&&l==="string"?(s="",o=!0):l==="number"&&(s=0,o=!0)}try{e[t]=s}catch{}o&&e.removeAttribute(r||t)}function qs(e,t,s,i){e.addEventListener(t,s,i)}function Dd(e,t,s,i){e.removeEventListener(t,s,i)}const cl=Symbol("_vei");function Td(e,t,s,i,r=null){const n=e[cl]||(e[cl]={}),o=n[t];if(i&&o)o.value=i;else{const[l,a]=Pd(t);if(i){const h=n[t]=Ad(i,r);qs(e,l,h,a)}else o&&(Dd(e,l,o,a),n[t]=void 0)}}const ul=/(?:Once|Passive|Capture)$/;function Pd(e){let t;if(ul.test(e)){t={};let i;for(;i=e.match(ul);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Es(e.slice(2)),t]}let Qr=0;const Ld=Promise.resolve(),Id=()=>Qr||(Ld.then(()=>Qr=0),Qr=Date.now());function Ad(e,t){const s=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=s.attached)return;Yt(Od(i,s.value),t,5,[i])};return s.value=e,s.attached=Id(),s}function Od(e,t){if(re(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(i=>r=>!r._stopped&&i&&i(r))}else return t}const dl=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Nd=(e,t,s,i,r,n)=>{const o=r==="svg";t==="class"?xd(e,i,o):t==="style"?Rd(e,s,i):kr(t)?fo(t)||Td(e,t,s,i,n):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):$d(e,t,i,o))?(hl(e,t,i),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&al(e,t,i,o,n,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!Ue(i))?hl(e,Lt(t),i,n,t):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),al(e,t,i,o))};function $d(e,t,s,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in e&&dl(t)&&le(s));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="sandbox"&&e.tagName==="IFRAME"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const r=e.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return dl(t)&&Ue(s)?!1:t in e}const fl=e=>{const t=e.props["onUpdate:modelValue"]||!1;return re(t)?s=>Qi(t,s):t};function Hd(e){e.target.composing=!0}function _l(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const en=Symbol("_assign");function pl(e,t,s){return t&&(e=e.trim()),s&&(e=po(e)),e}const Ch={created(e,{modifiers:{lazy:t,trim:s,number:i}},r){e[en]=fl(r);const n=i||r.props&&r.props.type==="number";qs(e,t?"change":"input",o=>{o.target.composing||e[en](pl(e.value,s,n))}),(s||n)&&qs(e,"change",()=>{e.value=pl(e.value,s,n)}),t||(qs(e,"compositionstart",Hd),qs(e,"compositionend",_l),qs(e,"change",_l))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:i,trim:r,number:n}},o){if(e[en]=fl(o),e.composing)return;const l=(n||e.type==="number")&&!/^0\d/.test(e.value)?po(e.value):e.value,a=t??"";l!==a&&(document.activeElement===e&&e.type!=="range"&&(i&&t===s||r&&e.value.trim()===a)||(e.value=a))}},Wd=["ctrl","shift","alt","meta"],Fd={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Wd.some(s=>e[`${s}Key`]&&!t.includes(s))},fi=(e,t)=>{const s=e._withMods||(e._withMods={}),i=t.join(".");return s[i]||(s[i]=((r,...n)=>{for(let o=0;o<t.length;o++){const l=Fd[t[o]];if(l&&l(r,t))return}return e(r,...n)}))},zd={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},gl=(e,t)=>{const s=e._withKeys||(e._withKeys={}),i=t.join(".");return s[i]||(s[i]=(r=>{if(!("key"in r))return;const n=Es(r.key);if(t.some(o=>o===n||zd[o]===n))return e(r)}))},Kd=ct({patchProp:Nd},wd);let vl;function Ud(){return vl||(vl=td(Kd))}const Vd=((...e)=>{const t=Ud().createApp(...e),{mount:s}=t;return t.mount=i=>{const r=qd(i);if(!r)return;const n=t._component;!le(n)&&!n.render&&!n.template&&(n.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=s(r,!1,jd(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},t});function jd(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function qd(e){return Ue(e)?document.querySelector(e):e}/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let xh;const Wr=e=>xh=e,kh=Symbol();function En(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var Mi;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(Mi||(Mi={}));function Yd(){const e=Ma(!0),t=e.run(()=>ue({}));let s=[],i=[];const r=wo({install(n){Wr(r),r._a=n,n.provide(kh,r),n.config.globalProperties.$pinia=r,i.forEach(o=>s.push(o)),i=[]},use(n){return this._a?s.push(n):i.push(n),this},_p:s,_a:null,_e:e,_s:new Map,state:t});return r}const Eh=()=>{};function ml(e,t,s,i=Eh){e.push(t);const r=()=>{const n=e.indexOf(t);n>-1&&(e.splice(n,1),i())};return!s&&Ra()&&Tc(r),r}function Ks(e,...t){e.slice().forEach(s=>{s(...t)})}const Xd=e=>e(),Sl=Symbol(),tn=Symbol();function Mn(e,t){e instanceof Map&&t instanceof Map?t.forEach((s,i)=>e.set(i,s)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const s in t){if(!t.hasOwnProperty(s))continue;const i=t[s],r=e[s];En(r)&&En(i)&&e.hasOwnProperty(s)&&!Ie(i)&&!rs(i)?e[s]=Mn(r,i):e[s]=i}return e}const Gd=Symbol();function Jd(e){return!En(e)||!e.hasOwnProperty(Gd)}const{assign:gs}=Object;function Zd(e){return!!(Ie(e)&&e.effect)}function Qd(e,t,s,i){const{state:r,actions:n,getters:o}=t,l=s.state.value[e];let a;function h(){l||(s.state.value[e]=r?r():{});const c=tu(s.state.value[e]);return gs(c,n,Object.keys(o||{}).reduce((u,d)=>(u[d]=wo(_e(()=>{Wr(s);const f=s._s.get(e);return o[d].call(f,f)})),u),{}))}return a=Mh(e,h,t,s,i,!0),a}function Mh(e,t,s={},i,r,n){let o;const l=gs({actions:{}},s),a={deep:!0};let h,c,u=[],d=[],f;const _=i.state.value[e];!n&&!_&&(i.state.value[e]={}),ue({});let v;function b(G){let Q;h=c=!1,typeof G=="function"?(G(i.state.value[e]),Q={type:Mi.patchFunction,storeId:e,events:f}):(Mn(i.state.value[e],G),Q={type:Mi.patchObject,payload:G,storeId:e,events:f});const pe=v=Symbol();Qs().then(()=>{v===pe&&(h=!0)}),c=!0,Ks(u,Q,i.state.value[e])}const m=n?function(){const{state:Q}=s,pe=Q?Q():{};this.$patch(oe=>{gs(oe,pe)})}:Eh;function y(){o.stop(),u=[],d=[],i._s.delete(e)}const k=(G,Q="")=>{if(Sl in G)return G[tn]=Q,G;const pe=function(){Wr(i);const oe=Array.from(arguments),$=[],M=[];function A(F){$.push(F)}function U(F){M.push(F)}Ks(d,{args:oe,name:pe[tn],store:N,after:A,onError:U});let H;try{H=G.apply(this&&this.$id===e?this:N,oe)}catch(F){throw Ks(M,F),F}return H instanceof Promise?H.then(F=>(Ks($,F),F)).catch(F=>(Ks(M,F),Promise.reject(F))):(Ks($,H),H)};return pe[Sl]=!0,pe[tn]=Q,pe},C={_p:i,$id:e,$onAction:ml.bind(null,d),$patch:b,$reset:m,$subscribe(G,Q={}){const pe=ml(u,G,Q.detached,()=>oe()),oe=o.run(()=>As(()=>i.state.value[e],$=>{(Q.flush==="sync"?c:h)&&G({storeId:e,type:Mi.direct,events:f},$)},gs({},a,Q)));return pe},$dispose:y},N=Pr(C);i._s.set(e,N);const ne=(i._a&&i._a.runWithContext||Xd)(()=>i._e.run(()=>(o=Ma()).run(()=>t({action:k}))));for(const G in ne){const Q=ne[G];if(Ie(Q)&&!Zd(Q)||rs(Q))n||(_&&Jd(Q)&&(Ie(Q)?Q.value=_[G]:Mn(Q,_[G])),i.state.value[e][G]=Q);else if(typeof Q=="function"){const pe=k(Q,G);ne[G]=pe,l.actions[G]=Q}}return gs(N,ne),gs(ge(N),ne),Object.defineProperty(N,"$state",{get:()=>i.state.value[e],set:G=>{b(Q=>{gs(Q,G)})}}),i._p.forEach(G=>{gs(N,o.run(()=>G({store:N,app:i._a,pinia:i,options:l})))}),_&&n&&s.hydrate&&s.hydrate(N.$state,_),h=!0,c=!0,N}/*! #__NO_SIDE_EFFECTS__ */function ef(e,t,s){let i,r;const n=typeof t=="function";i=e,r=n?s:t;function o(l,a){const h=fu();return l=l||(h?wi(kh,null):null),l&&Wr(l),l=xh,l._s.has(i)||(n?Mh(i,t,r,l):Qd(i,r,l)),l._s.get(i)}return o.$id=i,o}const tf="/logo.png",hs=ef("monitor",()=>{const e=ue("disconnected"),t=ue(null),s=ue(0),i=5,r=2e3,n=ue([]),o=ue([]),l=ue(null),a=ue("local"),h=ue(!0),c=ue(!1),u=ue(!1),d=ue(!1),f=ue(new Set),_=ue(new Map),v=ue(new Set),b=ue([]),m=ue(null),y=ue(new Map),k=ue(null),C=ue({eventTypes:[],sessionIds:[],searchQuery:"",timeRange:{start:null,end:null}}),N=_e(()=>l.value&&n.value.find(w=>w.sessionId===l.value)||null),X=_e(()=>{let w=[...o.value];if(l.value&&(w=w.filter(O=>O.sessionId===l.value)),C.value.eventTypes.length>0&&(w=w.filter(O=>C.value.eventTypes.includes(O.eventType))),C.value.searchQuery){const O=C.value.searchQuery.toLowerCase();w=w.filter(fe=>[fe.eventType,fe.data.toolName,fe.data.message,JSON.stringify(fe.data.toolInput)].filter(Boolean).join(" ").toLowerCase().includes(O))}return C.value.timeRange.start&&(w=w.filter(O=>O.timestamp>=C.value.timeRange.start)),C.value.timeRange.end&&(w=w.filter(O=>O.timestamp<=C.value.timeRange.end)),w.sort((O,fe)=>O.timestamp-fe.timestamp)}),ne=_e(()=>n.value.filter(w=>w.status==="active"));function G(w,O){const fe=O.find(we=>we.sessionId===w);if(!fe)return!1;for(const we of fe.childSessionIds){const Ge=O.find(It=>It.sessionId===we);if((Ge==null?void 0:Ge.status)==="active"||G(we,O))return!0}return!1}const Q=_e(()=>{let w=n.value;c.value||(w=w.filter(ie=>!f.value.has(ie.sessionId))),u.value&&(w=w.filter(ie=>ie.status!=="active"));const O=new Set(w.map(ie=>ie.sessionId)),fe=w.filter(ie=>!ie.parentSessionId||!O.has(ie.parentSessionId)),we=new Map;w.forEach(ie=>{if(ie.parentSessionId&&O.has(ie.parentSessionId)){const Se=we.get(ie.parentSessionId)||[];Se.push(ie),we.set(ie.parentSessionId,Se)}});const Ge=fe.filter(ie=>ie.isPinned===!0||ie.isUserInitiated===!0||ie.isUserInitiated===void 0&&!ie.parentSessionId||ie.status==="active"||G(ie.sessionId,w));Ge.sort((ie,Se)=>ie.status==="active"&&Se.status!=="active"?-1:Se.status==="active"&&ie.status!=="active"?1:Se.startTime-ie.startTime);const It=new Set(Ge.map(ie=>ie.sessionId)),Ve=fe.filter(ie=>!It.has(ie.sessionId));return{rootSessions:fe,primarySessions:Ge,otherSessions:Ve,childMap:we}}),pe=_e(()=>o.value.filter(w=>w.eventType==="tool_call"||w.eventType==="tool_result")),oe=_e(()=>{const w={input:0,output:0,cacheRead:0,cacheWrite:0};return n.value.forEach(O=>{var fe,we,Ge,It;w.input+=((fe=O.tokenUsage)==null?void 0:fe.totalInput)||0,w.output+=((we=O.tokenUsage)==null?void 0:we.totalOutput)||0,w.cacheRead+=((Ge=O.tokenUsage)==null?void 0:Ge.totalCacheRead)||0,w.cacheWrite+=((It=O.tokenUsage)==null?void 0:It.totalCacheCreation)||0}),w});function $(){var O;if(((O=t.value)==null?void 0:O.readyState)===WebSocket.OPEN)return;e.value="connecting";const w=`ws://${window.location.hostname}:3848`;t.value=new WebSocket(w),t.value.onopen=()=>{e.value="connected",s.value=0,A({type:"subscribe"}),A({type:"get_sessions"}),A({type:"get_all_recent_events",limit:200}),A({type:"get_wrappers"})},t.value.onmessage=fe=>{try{const we=JSON.parse(fe.data);U(we)}catch(we){console.error("Failed to parse WebSocket message:",we)}},t.value.onclose=()=>{e.value="disconnected",t.value=null,s.value<i&&(s.value++,setTimeout($,r*s.value))},t.value.onerror=fe=>{console.error("WebSocket error:",fe)}}function M(){t.value&&(t.value.close(),t.value=null),e.value="disconnected"}function A(w){var O;((O=t.value)==null?void 0:O.readyState)===WebSocket.OPEN&&t.value.send(JSON.stringify(w))}function U(w){switch(w.type){case"sessions":n.value=w.sessions;break;case"session_update":const O=n.value.findIndex(Se=>Se.sessionId===w.session.sessionId);O>=0?n.value[O]=w.session:n.value.push(w.session);break;case"event":console.log(`[Monitor] Received real-time event: ${w.event.eventType} (session: ${w.event.sessionId})`),o.value.push(w.event),o.value.length>1e3&&(o.value=o.value.slice(-1e3));break;case"events":const fe=new Set(o.value.map(Se=>Se.id)),we=w.events.filter(Se=>!fe.has(Se.id));o.value=[...o.value,...we].sort((Se,Fs)=>Se.timestamp-Fs.timestamp);break;case"all_events":console.log(`[Monitor] Received ${w.events.length} events from get_all_recent_events`);const Ge=new Set(o.value.map(Se=>Se.id)),It=w.events.filter(Se=>!Ge.has(Se.id));o.value=[...o.value,...It].sort((Se,Fs)=>Se.timestamp-Fs.timestamp),console.log(`[Monitor] Total events now: ${o.value.length}`);break;case"event_detail":_.value.set(w.event.id,w.event),v.value.delete(w.event.id);break;case"sessions_updated":n.value=w.sessions;break;case"error":console.error("Server error:",w.message);break;case"wrappers":b.value=w.wrappers;break;case"wrapper_connected":console.log(`[Monitor] Wrapper connected: ${w.wrapperId}`),b.value.push({wrapperId:w.wrapperId,state:w.state,claudeSessionId:null}),y.value.set(w.wrapperId,[]);break;case"wrapper_disconnected":console.log(`[Monitor] Wrapper disconnected: ${w.wrapperId}`),b.value=b.value.filter(Se=>Se.wrapperId!==w.wrapperId),y.value.delete(w.wrapperId),m.value===w.wrapperId&&(m.value=null);break;case"wrapper_state":console.log(`[Monitor] Wrapper ${w.wrapperId} state: ${w.state}`);const Ve=b.value.findIndex(Se=>Se.wrapperId===w.wrapperId);Ve>=0&&(b.value[Ve].state=w.state,w.claudeSessionId&&(b.value[Ve].claudeSessionId=w.claudeSessionId));break;case"wrapper_output":const ie=y.value.get(w.wrapperId);if(ie){const Se=w.data;ie.push(Se),ie.length>500&&ie.splice(0,ie.length-500),k.value={wrapperId:w.wrapperId,data:Se}}break;case"wrapper_spawned":console.log("[Monitor] Wrapper spawn result:",w),w.success&&w.wrapperId?m.value=w.wrapperId:w.error&&console.error(`[Monitor] Failed to spawn wrapper: ${w.error}`);break}}function H(w){l.value=w,w&&A({type:"get_events",sessionId:w,limit:500})}function F(w,O){C.value[w]=O}function P(w){const O=C.value.eventTypes.indexOf(w);O>=0?C.value.eventTypes.splice(O,1):C.value.eventTypes.push(w)}function de(){C.value={eventTypes:[],sessionIds:[],searchQuery:"",timeRange:{start:null,end:null}}}function Be(w){h.value=w}function We(){o.value=[]}function Oe(w){f.value.add(w),A({type:"hide_session",sessionId:w})}function it(w){n.value=n.value.filter(O=>O.sessionId!==w),o.value=o.value.filter(O=>O.sessionId!==w),f.value.delete(w),l.value===w&&(l.value=null),A({type:"delete_session",sessionId:w})}function Xe(){Q.value.rootSessions.map(O=>O.sessionId).forEach(O=>f.value.add(O)),A({type:"hide_all_sessions"})}function vt(){const w=Q.value.rootSessions.map(O=>O.sessionId);n.value=n.value.filter(O=>!w.includes(O.sessionId)),o.value=o.value.filter(O=>!w.includes(O.sessionId)),w.forEach(O=>f.value.delete(O)),l.value=null,A({type:"delete_all_sessions"})}function Fe(w){f.value.delete(w),A({type:"unhide_session",sessionId:w})}function mt(){c.value=!c.value}function Jt(){u.value=!u.value}function bt(w){d.value=w}function Rt(w,O){A({type:"set_parent",sessionId:w,parentSessionId:O})}function ds(w){A({type:"toggle_pin",sessionId:w})}function g(w,O){A({type:"set_user_initiated",sessionId:w,isUserInitiated:O})}function S(w,O){A({type:"rename_session",sessionId:w,label:O})}const x=ue(null);function I(w){x.value=w}function D(w,O){_.value.has(O)||v.value.has(O)||(v.value.add(O),A({type:"get_event_detail",sessionId:w,eventId:O}))}function T(w){return _.value.get(w)}function V(w){m.value=w}function K(w,O){A({type:"inject_input",wrapperId:w,input:O})}function z(w,O,fe){A({type:"resize_wrapper",wrapperId:w,cols:O,rows:fe})}function L(w){const O=y.value.get(w);return O?O.join(""):""}function ee(w){const O=y.value.get(w);return O?O.join(""):""}function q(w){const O=y.value.get(w);return O?[...O]:[]}function J(w={}){A({type:"spawn_wrapper",cwd:w.cwd,args:w.args,cols:w.cols,rows:w.rows})}function te(w){A({type:"kill_wrapper",wrapperId:w})}const ce=_e(()=>m.value&&b.value.find(w=>w.wrapperId===m.value)||null),Ce=_e(()=>b.value.filter(w=>w.state!=="ended")),me=_e(()=>b.value.filter(w=>w.state==="waiting_input"));return{connectionStatus:e,sessions:n,events:o,selectedSessionId:l,mode:a,autoScroll:h,filters:C,showHidden:c,showInactiveOnly:u,ctrlPressed:d,hiddenSessionIds:f,draggedSessionId:x,eventDetails:_,loadingDetails:v,wrappers:b,selectedWrapperId:m,wrapperOutputBuffers:y,selectedSession:N,filteredEvents:X,activeSessions:ne,sessionHierarchy:Q,toolEvents:pe,tokenTotals:oe,selectedWrapper:ce,activeWrappers:Ce,wrappersWaitingInput:me,connect:$,disconnect:M,send:A,selectSession:H,setFilter:F,toggleEventTypeFilter:P,clearFilters:de,setAutoScroll:Be,clearEvents:We,hideSession:Oe,deleteSession:it,hideAllSessions:Xe,deleteAllSessions:vt,unhideSession:Fe,toggleShowHidden:mt,toggleShowInactive:Jt,setCtrlPressed:bt,setSessionParent:Rt,toggleSessionPin:ds,setUserInitiated:g,renameSession:S,setDraggedSession:I,requestEventDetail:D,getEventDetail:T,selectWrapper:V,injectInput:K,resizeWrapper:z,getWrapperOutput:L,getRawWrapperOutput:ee,getWrapperOutputChunks:q,lastWrapperOutput:k,spawnWrapper:J,killWrapper:te}}),sf={class:"px-3 py-2 border-b border-slate-700 text-xs text-monitor-text-muted"},rf={class:"text-monitor-text-primary font-medium"},nf={key:0,class:"ml-2 text-monitor-accent-purple"},of={key:1,class:"ml-2 text-monitor-accent-cyan"},lf={key:0,class:"px-3 py-2 border-b border-slate-700"},af={class:"flex items-center space-x-2"},hf={key:0,class:"ml-auto text-xs text-monitor-text-muted"},cf={key:2,class:"border-t border-slate-700 my-1"},uf={key:5,class:"border-t border-slate-700 my-1"},df={key:6,class:"relative group"},ff={class:"absolute left-full top-0 ml-1 bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 min-w-48 hidden group-hover:block max-h-64 overflow-y-auto"},_f=["onClick"],pf={key:0,class:"ml-1 text-xs text-monitor-accent-purple"},gf={key:1,class:"ml-1 text-xs text-monitor-accent-cyan"},vf={key:0,class:"px-3 py-2 text-sm text-monitor-text-muted italic"},mf=Gt({__name:"ContextMenu",props:{x:{},y:{},session:{},allSessions:{}},emits:["close","setParent","togglePin","setUserInitiated","rename"],setup(e,{emit:t}){const s=e,i=t,r=ue(!1),n=ue(""),o=ue(null);function l(){n.value=s.session.label||"",r.value=!0,Qs(()=>{var _,v;(_=o.value)==null||_.focus(),(v=o.value)==null||v.select()})}function a(){i("rename",s.session.sessionId,n.value),i("close")}function h(){r.value=!1,n.value=""}function c(_,v){const b=s.allSessions.find(m=>m.sessionId===_);return b?b.parentSessionId===v?!0:b.parentSessionId?c(b.parentSessionId,v):!1:!1}const u=_e(()=>s.allSessions.filter(_=>_.sessionId!==s.session.sessionId&&!c(_.sessionId,s.session.sessionId)&&!s.session.childSessionIds.includes(_.sessionId)).sort((_,v)=>v.startTime-_.startTime));function d(_){i("close")}function f(_){_.key==="Escape"&&i("close")}return Or(()=>{setTimeout(()=>{document.addEventListener("click",d),document.addEventListener("keydown",f)},10)}),$i(()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",f)}),(_,v)=>(R(),B("div",{class:"fixed bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 min-w-52 z-50",style:Ut({left:e.x+"px",top:e.y+"px"}),onClick:v[4]||(v[4]=fi(()=>{},["stop"]))},[p("div",sf,[p("span",rf,j(e.session.sessionId.slice(0,8)),1),e.session.agentType?(R(),B("span",nf,"("+j(e.session.agentType)+")",1)):Z("",!0),e.session.label?(R(),B("span",of,'"'+j(e.session.label)+'"',1)):Z("",!0)]),r.value?(R(),B("div",lf,[p("div",af,[Xa(p("input",{ref_key:"renameInputRef",ref:o,"onUpdate:modelValue":v[0]||(v[0]=b=>n.value=b),type:"text",class:"flex-1 px-2 py-1 text-sm bg-slate-700 border border-slate-600 rounded focus:outline-none focus:ring-1 focus:ring-monitor-accent-cyan",placeholder:"Enter label (empty to clear)",onKeydown:[gl(a,["enter"]),gl(h,["escape"])]},null,544),[[Ch,n.value]]),p("button",{class:"px-2 py-1 text-xs bg-monitor-accent-cyan text-slate-900 rounded hover:bg-cyan-400 transition-colors",onClick:a}," OK "),p("button",{class:"px-2 py-1 text-xs bg-slate-600 text-white rounded hover:bg-slate-500 transition-colors",onClick:h}," Cancel ")])])):Z("",!0),r.value?Z("",!0):(R(),B("button",{key:1,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:l},[v[5]||(v[5]=p("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)),v[6]||(v[6]=p("span",null,"Rename",-1)),e.session.label?(R(),B("span",hf,' "'+j(e.session.label)+'" ',1)):Z("",!0)])),r.value?Z("",!0):(R(),B("div",cf)),r.value?Z("",!0):(R(),B("button",{key:3,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:v[1]||(v[1]=b=>{i("togglePin",e.session.sessionId),i("close")})},[v[7]||(v[7]=p("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[p("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})],-1)),p("span",{class:ve(e.session.isPinned?"text-monitor-accent-cyan":"")},j(e.session.isPinned?"Unpin Session":"Pin to Top"),3)])),r.value?Z("",!0):(R(),B("button",{key:4,class:"w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",onClick:v[2]||(v[2]=b=>{i("setUserInitiated",e.session.sessionId,!e.session.isUserInitiated),i("close")})},[v[8]||(v[8]=p("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),p("span",{class:ve(e.session.isUserInitiated?"text-monitor-accent-cyan":"")},j(e.session.isUserInitiated?"Mark as Sub-Agent":"Mark as Primary"),3)])),r.value?Z("",!0):(R(),B("div",uf)),r.value?Z("",!0):(R(),B("div",df,[v[11]||(v[11]=Mo('<button class="w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center justify-between"><span class="flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg> Set Parent </span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>',1)),p("div",ff,[p("button",{class:ve(["w-full px-3 py-2 text-left text-sm hover:bg-slate-700 text-monitor-text-muted flex items-center",{"text-monitor-accent-cyan":!e.session.parentSessionId}]),onClick:v[3]||(v[3]=b=>{i("setParent",e.session.sessionId,null),i("close")})},[...v[9]||(v[9]=[p("svg",{class:"w-3 h-3 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),xt(" (No Parent - Root) ",-1)])],2),v[10]||(v[10]=p("div",{class:"border-t border-slate-700 my-1"},null,-1)),(R(!0),B(ye,null,_t(u.value,b=>(R(),B("button",{key:b.sessionId,class:ve(["w-full px-3 py-2 text-left text-sm hover:bg-slate-700 flex items-center",{"text-monitor-accent-cyan":e.session.parentSessionId===b.sessionId}]),onClick:m=>{i("setParent",e.session.sessionId,b.sessionId),i("close")}},[p("span",{class:ve(["w-2 h-2 rounded-full mr-2",{"bg-green-500":b.status==="active","bg-gray-500":b.status==="completed","bg-red-500":b.status==="error"}])},null,2),p("span",null,j(b.sessionId.slice(0,8)),1),b.agentType?(R(),B("span",pf," ("+j(b.agentType)+") ",1)):Z("",!0),b.isUserInitiated?(R(),B("span",gf," (primary) ")):Z("",!0)],10,_f))),128)),u.value.length===0?(R(),B("div",vf," No eligible parents ")):Z("",!0)])]))],4))}}),Rh=Gt({name:"SessionChild",props:{session:{type:Object,required:!0},depth:{type:Number,required:!0},getChildSessions:{type:Function,required:!0},getTotalChildCount:{type:Function,required:!0},isExpanded:{type:Function,required:!0},toggleExpand:{type:Function,required:!0},selectSession:{type:Function,required:!0},selectedId:{type:String,default:null},formatDuration:{type:Function,required:!0},onContextMenu:{type:Function,required:!0}},render(){const{session:e,depth:t,getChildSessions:s,getTotalChildCount:i,isExpanded:r,toggleExpand:n,selectSession:o,selectedId:l,formatDuration:a,onContextMenu:h}=this,c=i(e.sessionId),u=s(e.sessionId),d=r(e.sessionId);hs();const f=["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group mb-1",l===e.sessionId?"bg-slate-700 border-l-monitor-accent-purple ring-1 ring-monitor-accent-purple/30":"bg-monitor-bg-tertiary hover:bg-slate-700/50 border-l-monitor-accent-purple/50"];return Je("div",{class:"ml-3"},[Je("div",{class:f,onClick:()=>o(e.sessionId),onContextmenu:_=>{_.preventDefault(),h(e,_)}},[Je("div",{class:"p-2"},[Je("div",{class:"flex items-center justify-between"},[Je("div",{class:"flex items-center space-x-2"},[c>0?Je("button",{class:"w-4 h-4 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:_=>{_.stopPropagation(),n(e.sessionId,_)}},[Je("svg",{class:["w-2.5 h-2.5 transition-transform text-monitor-text-muted",d?"rotate-90":""],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[Je("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})])]):Je("span",{class:"w-4"}),Je("svg",{class:"w-3 h-3 text-monitor-accent-purple",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[Je("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),Je("span",{class:["w-1.5 h-1.5 rounded-full",e.status==="active"?"bg-purple-400 animate-pulse-dot":"",e.status==="completed"?"bg-gray-500":"",e.status==="error"?"bg-red-500":""]}),e.label?Je("span",{class:"text-xs font-medium text-monitor-accent-cyan"},e.label):Je("span",{class:"text-xs font-medium text-monitor-text-secondary"},e.sessionId.slice(0,8)),e.agentType?Je("span",{class:"px-1 py-0.5 text-xs rounded bg-monitor-accent-purple/20 text-monitor-accent-purple"},e.agentType):null,c>0?Je("span",{class:"px-1 py-0.5 text-xs rounded bg-slate-600 text-monitor-text-muted"},`+${c}`):null]),Je("span",{class:"text-xs text-monitor-text-muted"},a(e.startTime,e.endTime))])])]),d?u.map(_=>Je(Rh,{key:_.sessionId,session:_,depth:t+1,getChildSessions:s,getTotalChildCount:i,isExpanded:r,toggleExpand:n,selectSession:o,selectedId:l,formatDuration:a,onContextMenu:h})):null])}}),Sf=Gt({name:"SessionList",components:{SessionChild:Rh,ContextMenu:mf},setup(){const e=hs(),t=ue({visible:!1,x:0,y:0,session:null});function s(v,b){t.value={visible:!0,x:b.clientX,y:b.clientY,session:v}}function i(){t.value.visible=!1,t.value.session=null}function r(){e.ctrlPressed?e.deleteAllSessions():e.hideAllSessions()}const n=ue(new Set),o=_e(()=>e.sessionHierarchy),l=_e(()=>e.selectedSessionId);function a(v){return o.value.childMap.get(v)||[]}function h(v){const b=a(v);let m=b.length;for(const y of b)m+=h(y.sessionId);return m}function c(v){return n.value.has(v)}function u(v,b){b.stopPropagation(),n.value.has(v)?n.value.delete(v):n.value.add(v)}function d(v,b){const m=(b||Date.now())-v,y=Math.floor(m/1e3),k=Math.floor(y/60),C=Math.floor(k/60);return C>0?`${C}h ${k%60}m`:k>0?`${k}m ${y%60}s`:`${y}s`}function f(v,b=30){if(v.length<=b)return v;const m=v.split("/");return m.length<=2?v.slice(-b):".../"+m.slice(-2).join("/")}function _(v){l.value===v?e.selectSession(null):(e.selectSession(v),n.value.add(v))}return{store:e,hierarchy:o,selectedId:l,contextMenu:t,getChildSessions:a,getTotalChildCount:h,isExpanded:c,toggleExpand:u,formatDuration:d,truncatePath:f,selectSession:_,handleClearAll:r,showContextMenu:s,closeContextMenu:i}}}),Bh=(e,t)=>{const s=e.__vccOpts||e;for(const[i,r]of t)s[i]=r;return s},bf={class:"flex flex-col h-full"},yf={class:"px-3 py-2 border-b border-slate-700 space-y-2"},wf=["title"],Cf={class:"flex items-center justify-between text-xs"},xf={class:"flex items-center space-x-2 cursor-pointer"},kf=["checked"],Ef={class:"flex items-center space-x-2 cursor-pointer"},Mf=["checked"],Rf={class:"flex-1 overflow-y-auto"},Bf={key:0,class:"p-2 border-b border-slate-600"},Df={class:"space-y-1"},Tf=["onClick","onContextmenu"],Pf={key:0,class:"absolute -top-1 -right-1 w-4 h-4 bg-monitor-accent-cyan rounded-full flex items-center justify-center shadow"},Lf={class:"p-3"},If={class:"flex items-center justify-between mb-2"},Af={class:"flex items-center space-x-2"},Of=["onClick"],Nf={key:1,class:"w-5"},$f={key:2,class:"text-sm font-medium text-monitor-accent-cyan"},Hf={key:3,class:"text-sm font-medium text-monitor-text-primary"},Wf={key:4,class:"px-1.5 py-0.5 text-xs rounded-full bg-monitor-accent-purple/20 text-monitor-accent-purple"},Ff={class:"text-xs text-monitor-text-muted"},zf={class:"text-xs text-monitor-text-muted pl-7"},Kf={class:"flex items-center"},Uf={key:1,class:"p-2"},Vf={class:"space-y-1"},jf=["onClick","onContextmenu"],qf={class:"p-2"},Yf={class:"flex items-center justify-between"},Xf={class:"flex items-center space-x-2"},Gf=["onClick"],Jf={key:1,class:"w-4"},Zf={key:2,class:"text-xs text-monitor-accent-cyan"},Qf={key:3,class:"text-xs text-monitor-text-secondary"},e_={key:4,class:"px-1 py-0.5 text-xs rounded bg-slate-600 text-monitor-text-muted"},t_={class:"text-xs text-monitor-text-muted"},s_={key:2,class:"text-monitor-text-muted text-sm p-4 text-center"};function i_(e,t,s,i,r,n){const o=Uo("SessionChild"),l=Uo("ContextMenu");return R(),B("div",bf,[p("div",yf,[p("button",{onClick:t[0]||(t[0]=(...a)=>e.handleClearAll&&e.handleClearAll(...a)),class:ve(["w-full px-3 py-1.5 text-xs font-medium rounded transition-colors",e.store.ctrlPressed?"bg-red-600 hover:bg-red-700 text-white":"bg-slate-600 hover:bg-slate-700 text-white"]),title:e.store.ctrlPressed?"Delete All Sessions (Ctrl held)":"Hide All Sessions"},j(e.store.ctrlPressed?"Delete All":"Hide All"),11,wf),p("div",Cf,[p("label",xf,[p("input",{type:"checkbox",checked:e.store.showHidden,onChange:t[1]||(t[1]=a=>e.store.toggleShowHidden()),class:"w-3 h-3 rounded bg-slate-700 border-slate-600 text-monitor-accent-cyan focus:ring-monitor-accent-cyan focus:ring-offset-0"},null,40,kf),t[7]||(t[7]=p("span",{class:"text-monitor-text-secondary"},"Show Hidden",-1))]),p("label",Ef,[p("input",{type:"checkbox",checked:e.store.showInactiveOnly,onChange:t[2]||(t[2]=a=>e.store.toggleShowInactive()),class:"w-3 h-3 rounded bg-slate-700 border-slate-600 text-monitor-accent-cyan focus:ring-monitor-accent-cyan focus:ring-offset-0"},null,40,Mf),t[8]||(t[8]=p("span",{class:"text-monitor-text-secondary"},"Inactive Only",-1))])])]),p("div",Rf,[e.hierarchy.primarySessions.length>0?(R(),B("div",Bf,[t[13]||(t[13]=p("div",{class:"text-xs font-semibold text-monitor-accent-cyan uppercase tracking-wide mb-2 flex items-center"},[p("svg",{class:"w-3 h-3 mr-1.5",fill:"currentColor",viewBox:"0 0 20 20"},[p("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})]),xt(" Primary Sessions ")],-1)),p("div",Df,[(R(!0),B(ye,null,_t(e.hierarchy.primarySessions,a=>(R(),B(ye,{key:a.sessionId},[p("div",{class:ve(["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group",[e.selectedId===a.sessionId?"bg-slate-700 border-l-monitor-accent-cyan ring-1 ring-monitor-accent-cyan/30":"bg-slate-800 hover:bg-slate-700/70 border-l-monitor-accent-cyan/70",a.isPinned?"shadow-lg shadow-cyan-500/5":""]]),onClick:h=>e.selectSession(a.sessionId),onContextmenu:fi(h=>e.showContextMenu(a,h),["prevent"])},[a.isPinned?(R(),B("div",Pf,[...t[9]||(t[9]=[p("svg",{class:"w-2.5 h-2.5 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[p("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})],-1)])])):Z("",!0),p("div",Lf,[p("div",If,[p("div",Af,[e.getTotalChildCount(a.sessionId)>0?(R(),B("button",{key:0,class:"w-5 h-5 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:fi(h=>e.toggleExpand(a.sessionId,h),["stop"])},[(R(),B("svg",{class:ve(["w-3 h-3 transition-transform text-monitor-text-muted",{"rotate-90":e.isExpanded(a.sessionId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[10]||(t[10]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,Of)):(R(),B("span",Nf)),t[11]||(t[11]=p("svg",{class:"w-4 h-4 text-monitor-accent-cyan",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),p("span",{class:ve(["w-2 h-2 rounded-full",{"bg-green-500 animate-pulse-dot":a.status==="active","bg-gray-500":a.status==="completed","bg-red-500":a.status==="error"}])},null,2),a.label?(R(),B("span",$f,j(a.label),1)):(R(),B("span",Hf,j(a.sessionId.slice(0,8)),1)),e.getTotalChildCount(a.sessionId)>0?(R(),B("span",Wf,j(e.getTotalChildCount(a.sessionId))+" agents ",1)):Z("",!0)]),p("span",Ff,j(e.formatDuration(a.startTime,a.endTime)),1)]),p("div",zf,[p("div",Kf,[t[12]||(t[12]=p("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})],-1)),xt(" "+j(e.truncatePath(a.workingDirectory)),1)])])])],42,Tf),e.isExpanded(a.sessionId)?(R(!0),B(ye,{key:0},_t(e.getChildSessions(a.sessionId),h=>(R(),tr(o,{key:h.sessionId,session:h,depth:1,"get-child-sessions":e.getChildSessions,"get-total-child-count":e.getTotalChildCount,"is-expanded":e.isExpanded,"toggle-expand":e.toggleExpand,"select-session":e.selectSession,"selected-id":e.selectedId,"format-duration":e.formatDuration,"on-context-menu":e.showContextMenu},null,8,["session","get-child-sessions","get-total-child-count","is-expanded","toggle-expand","select-session","selected-id","format-duration","on-context-menu"]))),128)):Z("",!0)],64))),128))])])):Z("",!0),e.hierarchy.otherSessions.length>0?(R(),B("div",Uf,[t[15]||(t[15]=p("div",{class:"text-xs font-semibold text-monitor-text-muted uppercase tracking-wide mb-2"}," Other Sessions ",-1)),p("div",Vf,[(R(!0),B(ye,null,_t(e.hierarchy.otherSessions,a=>(R(),B(ye,{key:a.sessionId},[p("div",{class:ve(["rounded-lg cursor-pointer transition-all duration-200 border-l-4 relative group",[e.selectedId===a.sessionId?"bg-slate-700 border-l-slate-400 ring-1 ring-slate-400/30":"bg-monitor-bg-tertiary hover:bg-slate-700/50 border-l-slate-600",e.store.hiddenSessionIds.has(a.sessionId)?"opacity-50":""]]),onClick:h=>e.selectSession(a.sessionId),onContextmenu:fi(h=>e.showContextMenu(a,h),["prevent"])},[p("div",qf,[p("div",Yf,[p("div",Xf,[e.getTotalChildCount(a.sessionId)>0?(R(),B("button",{key:0,class:"w-4 h-4 flex items-center justify-center rounded hover:bg-slate-600 transition-colors",onClick:fi(h=>e.toggleExpand(a.sessionId,h),["stop"])},[(R(),B("svg",{class:ve(["w-2.5 h-2.5 transition-transform text-monitor-text-muted",{"rotate-90":e.isExpanded(a.sessionId)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[14]||(t[14]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,Gf)):(R(),B("span",Jf)),p("span",{class:ve(["w-1.5 h-1.5 rounded-full",{"bg-green-500 animate-pulse-dot":a.status==="active","bg-gray-500":a.status==="completed","bg-red-500":a.status==="error"}])},null,2),a.label?(R(),B("span",Zf,j(a.label),1)):(R(),B("span",Qf,j(a.sessionId.slice(0,8)),1)),a.agentType?(R(),B("span",e_,j(a.agentType),1)):Z("",!0)]),p("span",t_,j(e.formatDuration(a.startTime,a.endTime)),1)])])],42,jf),e.isExpanded(a.sessionId)?(R(!0),B(ye,{key:0},_t(e.getChildSessions(a.sessionId),h=>(R(),tr(o,{key:h.sessionId,session:h,depth:1,"get-child-sessions":e.getChildSessions,"get-total-child-count":e.getTotalChildCount,"is-expanded":e.isExpanded,"toggle-expand":e.toggleExpand,"select-session":e.selectSession,"selected-id":e.selectedId,"format-duration":e.formatDuration,"on-context-menu":e.showContextMenu},null,8,["session","get-child-sessions","get-total-child-count","is-expanded","toggle-expand","select-session","selected-id","format-duration","on-context-menu"]))),128)):Z("",!0)],64))),128))])])):Z("",!0),e.hierarchy.primarySessions.length===0&&e.hierarchy.otherSessions.length===0?(R(),B("div",s_," No sessions ")):Z("",!0)]),e.contextMenu.visible&&e.contextMenu.session?(R(),tr(l,{key:0,x:e.contextMenu.x,y:e.contextMenu.y,session:e.contextMenu.session,"all-sessions":e.store.sessions,onClose:e.closeContextMenu,onSetParent:t[3]||(t[3]=(a,h)=>e.store.setSessionParent(a,h)),onTogglePin:t[4]||(t[4]=a=>e.store.toggleSessionPin(a)),onSetUserInitiated:t[5]||(t[5]=(a,h)=>e.store.setUserInitiated(a,h)),onRename:t[6]||(t[6]=(a,h)=>e.store.renameSession(a,h))},null,8,["x","y","session","all-sessions","onClose"])):Z("",!0)])}const r_=Bh(Sf,[["render",i_]]),n_={class:"h-full flex flex-col"},o_={class:"p-3 border-b border-slate-700 flex items-center justify-between"},l_={class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"},a_={class:"text-monitor-text-muted ml-2"},h_={class:"flex items-center space-x-3"},c_={key:0,class:"text-monitor-text-muted text-sm p-4 text-center"},u_={key:1},d_=["onClick"],f_={class:"text-xs text-monitor-text-muted font-mono w-24 flex-shrink-0"},__=["d"],p_={key:0,class:"px-1.5 py-0.5 text-xs rounded bg-purple-500/20 text-purple-400 mr-2 flex-shrink-0"},g_={class:"text-sm text-monitor-text-primary truncate flex-1"},v_={key:0,class:"px-3 pb-3 border-t border-slate-700"},m_={class:"text-xs text-monitor-text-muted py-2 flex items-center space-x-4"},S_={key:0,class:"mt-2"},b_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-48 max-w-full"},y_={key:1,class:"mt-2"},w_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-48 max-w-full"},C_={key:2,class:"mt-2"},x_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-96 max-w-full bg-cyan-900/20 border-l-2 border-cyan-500"},k_={key:3,class:"mt-2"},E_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-h-96 max-w-full bg-green-900/20 border-l-2 border-green-500"},M_={key:4,class:"mt-2"},R_={class:"code-block text-xs overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-w-full"},B_={key:5,class:"mt-2"},D_={class:"code-block text-xs text-red-300 overflow-y-auto overflow-x-hidden whitespace-pre-wrap word-wrap-break max-w-full"},T_={key:6,class:"mt-2 flex items-center space-x-4 text-xs"},P_={class:"text-green-400"},L_={class:"text-blue-400"},I_={key:0,class:"text-purple-400"},A_={key:7,class:"mt-3 flex items-center text-xs text-monitor-text-secondary"},O_={key:8,class:"mt-3"},N_={class:"text-xs text-monitor-text-secondary mb-1 flex items-center"},$_={class:"space-y-2 max-h-64 overflow-y-auto"},H_={class:"whitespace-pre-wrap text-purple-200"},W_={key:9,class:"mt-3"},F_=["onClick"],z_=Gt({__name:"EventStream",setup(e){const t=hs(),s=ue(null),i=_e(()=>t.filteredEvents),r=_e(()=>t.autoScroll),n=ue(new Set);function o(b){n.value.has(b.id)?n.value.delete(b.id):(n.value.add(b.id),t.requestEventDetail(b.sessionId,b.id))}function l(b){return t.getEventDetail(b)||i.value.find(m=>m.id===b)}function a(b){const m=new Date(b),y=m.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),k=String(m.getMilliseconds()).padStart(3,"0");return`${y}.${k}`}function h(b){const m={session_start:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z",session_end:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z M9 10h6v4H9v-4z",tool_call:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",tool_result:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",user_prompt:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",message:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z",notification:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9",thinking:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z",error:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",agent_spawn:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",agent_complete:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z",subagent_start:"M13 10V3L4 14h7v7l9-11h-7z",subagent_stop:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"};return m[b]||m.message}function c(b){const m=b.toLowerCase();return m.includes("read")?"tool-badge-read":m.includes("write")?"tool-badge-write":m.includes("bash")?"tool-badge-bash":m.includes("edit")?"tool-badge-edit":"tool-badge-other"}function u(b){try{return JSON.stringify(b,null,2)}catch{return String(b)}}function d(b){var y;let m=null;if((y=b.data.subagent)!=null&&y.type)m=b.data.subagent.type;else if(b.data.toolName==="Task"){const k=b.data.toolInput;k!=null&&k.subagent_type&&(m=String(k.subagent_type))}else{const k=t.sessions.find(C=>C.sessionId===b.sessionId);k!=null&&k.agentType&&(m=k.agentType)}return m?m.toLowerCase():null}function f(b){var k;const m=b.data.toolInput;if(!m)return"";const y=((k=b.data.toolName)==null?void 0:k.toLowerCase())||"";if(y==="read"&&m.file_path){const C=String(m.file_path),N=C.split("/");return N.length>3?`.../${N.slice(-2).join("/")}`:C}if(y==="write"&&m.file_path){const C=String(m.file_path),N=C.split("/");return N.length>3?`.../${N.slice(-2).join("/")}`:C}if(y==="edit"&&m.file_path){const C=String(m.file_path),N=C.split("/");return N.length>3?`.../${N.slice(-2).join("/")}`:C}if(y==="bash"&&m.command){const C=String(m.command);return C.length>60?C.slice(0,60)+"...":C}return y==="grep"&&m.pattern?`"${m.pattern}"`:y==="glob"&&m.pattern?`"${m.pattern}"`:y==="task"&&m.subagent_type?String(m.subagent_type):""}function _(b){var y,k,C,N,X,ne,G,Q,pe,oe;const m=f(b);switch(b.eventType){case"tool_call":return m?`${b.data.toolName}: ${m}`:`Calling ${b.data.toolName}`;case"tool_result":return m?`${b.data.toolName}: ${m}`:`${b.data.toolName} completed`;case"session_start":return"Session started";case"session_end":if(b.data.assistantResponse){const $=b.data.assistantResponse.slice(0,80);return $.length<b.data.assistantResponse.length?$+"...":$}return"Session ended";case"user_prompt":if(b.data.message){const $=b.data.message.slice(0,80);return $.length<b.data.message.length?$+"...":$}return"User prompt";case"message":return((y=b.data.message)==null?void 0:y.slice(0,100))||"Message";case"notification":return b.data.message||"Notification";case"thinking":return"Thinking...";case"error":return((k=b.data.error)==null?void 0:k.message)||"Error occurred";case"agent_spawn":return`Spawned ${((N=(C=b.data.subagent)==null?void 0:C.type)==null?void 0:N.toLowerCase())||"subagent"}`;case"agent_complete":return"subagent completed";case"subagent_start":return`${((ne=(X=b.data.subagent)==null?void 0:X.type)==null?void 0:ne.toLowerCase())||"subagent"} started`;case"subagent_stop":if(b.data.assistantResponse){const $=((Q=(G=b.data.subagent)==null?void 0:G.type)==null?void 0:Q.toLowerCase())||"subagent",M=b.data.assistantResponse.slice(0,60),A=M.length<b.data.assistantResponse.length?"...":"";return`${$}: ${M}${A}`}return`${((oe=(pe=b.data.subagent)==null?void 0:pe.type)==null?void 0:oe.toLowerCase())||"subagent"} completed`;default:return b.eventType}}function v(b){var C,N;const m=(N=(C=b.data.subagent)==null?void 0:C.type)==null?void 0:N.toLowerCase(),y=b.timestamp,k=t.sessions.find(X=>{var ne;return X.parentSessionId===b.sessionId&&((ne=X.agentType)==null?void 0:ne.toLowerCase())===m&&Math.abs(X.startTime-y)<5e3});k&&t.selectSession(k.sessionId)}return As(i,async()=>{r.value&&s.value&&(await Qs(),s.value.scrollTop=s.value.scrollHeight)}),(b,m)=>(R(),B("div",n_,[p("div",o_,[p("h2",l_,[m[2]||(m[2]=xt(" Event Stream ",-1)),p("span",a_,"("+j(i.value.length)+")",1)]),p("div",h_,[p("button",{class:ve(["text-xs px-2 py-1 rounded",r.value?"bg-monitor-accent-cyan text-white":"bg-slate-700 text-monitor-text-secondary"]),onClick:m[0]||(m[0]=y=>$e(t).setAutoScroll(!r.value))}," Auto-scroll ",2),p("button",{class:"text-xs px-2 py-1 rounded bg-slate-700 text-monitor-text-secondary hover:bg-slate-600",onClick:m[1]||(m[1]=y=>$e(t).clearEvents())}," Clear ")])]),p("div",{ref_key:"eventListRef",ref:s,class:"flex-1 overflow-y-auto p-2 space-y-1"},[i.value.length===0?(R(),B("div",c_,[$e(t).selectedSessionId?(R(),B("p",u_,"Waiting for events...")):(R(),B(ye,{key:0},[m[3]||(m[3]=p("p",null,"Select a session to view its events",-1)),m[4]||(m[4]=p("p",{class:"text-xs mt-2"},"or new events will appear here as they occur",-1))],64))])):Z("",!0),(R(!0),B(ye,null,_t(i.value,y=>{var k,C,N,X,ne,G,Q,pe;return R(),B("div",{key:y.id,class:"group rounded-lg bg-monitor-bg-secondary hover:bg-slate-700/70 transition-colors animate-fade-in"},[p("div",{class:"flex items-center px-3 py-2 cursor-pointer",onClick:oe=>o(y)},[p("span",f_,j(a(y.timestamp)),1),(R(),B("svg",{class:ve(["w-4 h-4 mr-2 flex-shrink-0",`event-${y.eventType}`]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:h(y.eventType)},null,8,__)],2)),p("span",{class:ve(["text-xs px-1.5 py-0.5 rounded mr-2 flex-shrink-0",`event-${y.eventType} bg-slate-800`])},j(y.eventType),3),d(y)?(R(),B("span",p_,j(d(y)),1)):Z("",!0),y.data.toolName?(R(),B("span",{key:1,class:ve(["tool-badge mr-2",c(y.data.toolName)])},j(y.data.toolName),3)):Z("",!0),p("span",g_,j(_(y)),1),(R(),B("svg",{class:ve(["w-4 h-4 text-monitor-text-muted transition-transform",{"rotate-180":n.value.has(y.id)}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...m[5]||(m[5]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,d_),n.value.has(y.id)?(R(),B("div",v_,[p("div",m_,[p("span",null,"Session: "+j(y.sessionId.slice(0,8)),1),p("span",null,"Machine: "+j(y.machineId),1),p("span",null,j(y.workingDirectory),1)]),y.data.toolInput?(R(),B("div",S_,[m[6]||(m[6]=p("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Input:",-1)),p("pre",b_,j(u(y.data.toolInput)),1)])):Z("",!0),y.data.toolOutput?(R(),B("div",y_,[m[7]||(m[7]=p("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Output:",-1)),p("pre",w_,j(u(y.data.toolOutput)),1)])):Z("",!0),y.eventType==="user_prompt"&&y.data.message?(R(),B("div",C_,[m[8]||(m[8]=p("div",{class:"text-xs text-cyan-400 mb-1 flex items-center"},[p("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),xt(" User Prompt: ")],-1)),p("pre",x_,j(y.data.message),1)])):Z("",!0),y.eventType==="session_end"&&y.data.assistantResponse?(R(),B("div",k_,[m[9]||(m[9]=p("div",{class:"text-xs text-green-400 mb-1 flex items-center"},[p("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),xt(" Final Response: ")],-1)),p("pre",E_,j(y.data.assistantResponse),1)])):Z("",!0),y.data.message&&y.eventType!=="user_prompt"?(R(),B("div",M_,[m[10]||(m[10]=p("div",{class:"text-xs text-monitor-text-secondary mb-1"},"Message:",-1)),p("pre",R_,j(y.data.message),1)])):Z("",!0),y.data.error?(R(),B("div",B_,[m[11]||(m[11]=p("div",{class:"text-xs text-red-400 mb-1"},"Error:",-1)),p("pre",D_,j(y.data.error.message)+`
`+j(y.data.error.stack),1)])):Z("",!0),y.data.tokenUsage?(R(),B("div",T_,[m[12]||(m[12]=p("span",{class:"text-monitor-text-secondary"},"Tokens:",-1)),p("span",P_,"+"+j(y.data.tokenUsage.input)+" in",1),p("span",L_,"+"+j(y.data.tokenUsage.output)+" out",1),y.data.tokenUsage.cacheRead?(R(),B("span",I_,j(y.data.tokenUsage.cacheRead)+" cache read ",1)):Z("",!0)])):Z("",!0),$e(t).loadingDetails.has(y.id)?(R(),B("div",A_,[...m[13]||(m[13]=[p("svg",{class:"animate-spin h-3 w-3 mr-2",fill:"none",viewBox:"0 0 24 24"},[p("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),p("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),xt(" Loading full event details... ",-1)])])):Z("",!0),(N=(C=(k=l(y.id))==null?void 0:k.data)==null?void 0:C.thinkingBlocks)!=null&&N.length?(R(),B("div",O_,[p("div",N_,[m[14]||(m[14]=p("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1)),xt(" Chain of Thought ("+j(((G=(ne=(X=l(y.id))==null?void 0:X.data)==null?void 0:ne.thinkingBlocks)==null?void 0:G.length)||0)+") ",1)]),p("div",$_,[(R(!0),B(ye,null,_t(((pe=(Q=l(y.id))==null?void 0:Q.data)==null?void 0:pe.thinkingBlocks)||[],(oe,$)=>(R(),B("div",{key:$,class:"code-block text-xs bg-purple-900/20 border-l-2 border-purple-500 p-2"},[p("pre",H_,j(oe.content),1)]))),128))])])):Z("",!0),y.data.toolName==="Task"&&y.data.subagent?(R(),B("div",W_,[p("button",{onClick:oe=>v(y),class:"flex items-center text-xs text-purple-400 hover:text-cyan-400 transition-colors"},[m[15]||(m[15]=p("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),xt(" View "+j(y.data.subagent.type||"subagent")+" session  ",1)],8,F_)])):Z("",!0)])):Z("",!0)])}),128))],512)]))}}),K_={class:"p-2 border-b border-slate-700 flex items-center justify-between"},U_={class:"flex items-center space-x-2 text-xs text-monitor-text-muted"},V_={class:"flex-1 relative overflow-hidden p-2"},j_={key:0,class:"absolute inset-0 flex items-center justify-center text-monitor-text-muted text-sm"},q_={class:"absolute inset-0 flex"},Y_={class:"relative h-full"},X_={class:"absolute left-0 text-xs text-monitor-text-muted w-16 truncate"},G_={class:"absolute left-16 right-0 h-full flex items-center"},J_=["onMouseenter","onClick"],Z_={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 rounded shadow-lg text-xs whitespace-nowrap z-20"},Q_={class:"font-medium text-monitor-text-primary"},ep={class:"text-monitor-text-muted"},tp={class:"text-monitor-text-secondary"},sp=Gt({__name:"ToolTimeline",setup(e){const t=hs(),s=ue(null),i=ue(null),r=_e(()=>t.toolEvents),n=_e(()=>{if(r.value.length===0)return{start:Date.now()-6e4,end:Date.now()};const u=r.value.map(v=>v.timestamp),d=Math.min(...u),f=Math.max(...u,Date.now()),_=(f-d)*.05||5e3;return{start:d-_,end:f+_}});function o(u){const{start:d,end:f}=n.value,_=f-d;return _===0?50:(u-d)/_*100}function l(u){const d=u.toLowerCase();return d.includes("read")?"bg-blue-500":d.includes("write")?"bg-orange-500":d.includes("bash")?"bg-green-500":d.includes("edit")?"bg-yellow-500":d.includes("glob")?"bg-purple-500":d.includes("grep")?"bg-pink-500":"bg-gray-500"}function a(u){return new Date(u).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}const h=_e(()=>{const u=new Map;return r.value.forEach(d=>{const f=u.get(d.sessionId)||[];f.push(d),u.set(d.sessionId,f)}),u}),c=_e(()=>Array.from(h.value.keys()));return(u,d)=>(R(),B("div",{ref_key:"containerRef",ref:s,class:"h-full flex flex-col"},[p("div",K_,[d[2]||(d[2]=p("h2",{class:"text-xs font-medium text-monitor-text-secondary uppercase tracking-wide"}," Tool Timeline ",-1)),p("div",U_,[p("span",null,j(a(n.value.start)),1),d[1]||(d[1]=p("span",null,"-",-1)),p("span",null,j(a(n.value.end)),1)])]),p("div",V_,[r.value.length===0?(R(),B("div",j_," No tool calls yet ")):Z("",!0),p("div",q_,[(R(),B(ye,null,_t(5,f=>p("div",{key:f,class:"flex-1 border-r border-slate-700/50 last:border-r-0"})),64))]),p("div",Y_,[(R(!0),B(ye,null,_t(c.value,(f,_)=>(R(),B("div",{key:f,class:"absolute left-0 right-0 flex items-center",style:Ut({top:`${_/Math.max(c.value.length,1)*100}%`,height:`${100/Math.max(c.value.length,1)}%`})},[p("div",X_,j(f.slice(0,6)),1),p("div",G_,[(R(!0),B(ye,null,_t(h.value.get(f),v=>(R(),B("div",{key:v.id,class:ve(["absolute transform -translate-x-1/2 cursor-pointer transition-all duration-200",["rounded-full",l(v.data.toolName||""),i.value===v.id?"w-4 h-4 ring-2 ring-white z-10":"w-3 h-3 hover:w-4 hover:h-4"]]),style:Ut({left:`${o(v.timestamp)}%`}),onMouseenter:b=>i.value=v.id,onMouseleave:d[0]||(d[0]=b=>i.value=null),onClick:b=>$e(t).selectSession(v.sessionId)},[i.value===v.id?(R(),B("div",Z_,[p("div",Q_,j(v.data.toolName),1),p("div",ep,j(a(v.timestamp)),1),p("div",tp,j(v.eventType==="tool_call"?"Called":"Completed"),1)])):Z("",!0)],46,J_))),128))])],4))),128))]),d[3]||(d[3]=Mo('<div class="absolute bottom-0 right-0 flex items-center space-x-3 text-xs p-2 bg-monitor-bg-primary/80 rounded"><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span><span class="text-monitor-text-muted">Read</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-orange-500"></span><span class="text-monitor-text-muted">Write</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-monitor-text-muted">Bash</span></div><div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-yellow-500"></span><span class="text-monitor-text-muted">Edit</span></div></div>',1))])],512))}}),ip={class:"p-3 space-y-4"},rp={class:"text-xs text-monitor-text-muted"},np={class:"flex items-center justify-between text-sm mb-1"},op={class:"font-mono text-monitor-text-primary"},lp={class:"h-2 bg-slate-700 rounded-full overflow-hidden"},ap={class:"flex items-center justify-between text-sm mb-1"},hp={class:"font-mono text-monitor-text-primary"},cp={class:"h-2 bg-slate-700 rounded-full overflow-hidden"},up={key:0,class:"pt-2 border-t border-slate-700"},dp={class:"grid grid-cols-2 gap-4"},fp={class:"flex items-center justify-between text-xs mb-1"},_p={class:"font-mono text-monitor-text-muted"},pp={class:"h-1 bg-slate-700 rounded-full overflow-hidden"},gp={class:"flex items-center justify-between text-xs mb-1"},vp={class:"font-mono text-monitor-text-muted"},mp={class:"h-1 bg-slate-700 rounded-full overflow-hidden"},Sp={class:"pt-3 border-t border-slate-700"},bp={class:"flex items-center justify-between"},yp={class:"font-mono text-lg text-monitor-text-primary"},wp={class:"flex items-center justify-between mt-2"},Cp={class:"font-mono text-sm text-monitor-accent-cyan"},xp={key:1,class:"pt-3 border-t border-slate-700"},kp={class:"space-y-2 max-h-32 overflow-y-auto"},Ep=["onClick"],Mp={class:"font-mono text-monitor-text-secondary"},Rp=Gt({__name:"TokenMetrics",setup(e){const t=hs(),s=_e(()=>t.tokenTotals),i=_e(()=>t.selectedSession),r=_e(()=>{var h,c,u,d;if(!i.value)return null;const a=i.value;return{input:((h=a.tokenUsage)==null?void 0:h.totalInput)||0,output:((c=a.tokenUsage)==null?void 0:c.totalOutput)||0,cacheRead:((u=a.tokenUsage)==null?void 0:u.totalCacheRead)||0,cacheWrite:((d=a.tokenUsage)==null?void 0:d.totalCacheCreation)||0}}),n=_e(()=>{const d=r.value||s.value;return(d.input/1e3*.003+d.output/1e3*.015+(d.cacheRead||0)/1e3*3e-4+(d.cacheWrite||0)/1e3*.00375).toFixed(4)});function o(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"K":a.toString()}const l=_e(()=>{const a=r.value||s.value;return Math.max(a.input,a.output,1)});return(a,h)=>(R(),B("div",ip,[p("div",rp,j(i.value?`Session: ${i.value.sessionId.slice(0,8)}`:"All Sessions"),1),p("div",null,[p("div",np,[h[0]||(h[0]=p("span",{class:"text-green-400"},"Input",-1)),p("span",op,j(o((r.value||s.value).input)),1)]),p("div",lp,[p("div",{class:"h-full bg-green-500 rounded-full transition-all duration-500",style:Ut({width:`${(r.value||s.value).input/l.value*100}%`})},null,4)])]),p("div",null,[p("div",ap,[h[1]||(h[1]=p("span",{class:"text-blue-400"},"Output",-1)),p("span",hp,j(o((r.value||s.value).output)),1)]),p("div",cp,[p("div",{class:"h-full bg-blue-500 rounded-full transition-all duration-500",style:Ut({width:`${(r.value||s.value).output/l.value*100}%`})},null,4)])]),(r.value||s.value).cacheRead||(r.value||s.value).cacheWrite?(R(),B("div",up,[h[4]||(h[4]=p("div",{class:"text-xs text-monitor-text-secondary mb-2"},"Cache",-1)),p("div",dp,[p("div",null,[p("div",fp,[h[2]||(h[2]=p("span",{class:"text-purple-400"},"Read",-1)),p("span",_p,j(o((r.value||s.value).cacheRead||0)),1)]),p("div",pp,[p("div",{class:"h-full bg-purple-500 rounded-full",style:Ut({width:`${((r.value||s.value).cacheRead||0)/Math.max((r.value||s.value).input,1)*100}%`})},null,4)])]),p("div",null,[p("div",gp,[h[3]||(h[3]=p("span",{class:"text-pink-400"},"Write",-1)),p("span",vp,j(o((r.value||s.value).cacheWrite||0)),1)]),p("div",mp,[p("div",{class:"h-full bg-pink-500 rounded-full",style:Ut({width:`${((r.value||s.value).cacheWrite||0)/Math.max((r.value||s.value).input,1)*100}%`})},null,4)])])])])):Z("",!0),p("div",Sp,[p("div",bp,[h[5]||(h[5]=p("span",{class:"text-sm text-monitor-text-secondary"},"Total Tokens",-1)),p("span",yp,j(o((r.value||s.value).input+(r.value||s.value).output)),1)]),p("div",wp,[h[6]||(h[6]=p("span",{class:"text-xs text-monitor-text-muted"},"Est. Cost",-1)),p("span",Cp," $"+j(n.value),1)])]),!i.value&&$e(t).sessions.length>0?(R(),B("div",xp,[h[7]||(h[7]=p("div",{class:"text-xs text-monitor-text-secondary mb-2"},"By Session",-1)),p("div",kp,[(R(!0),B(ye,null,_t($e(t).sessions,c=>(R(),B("div",{key:c.sessionId,class:"flex items-center justify-between text-xs"},[p("span",{class:"text-monitor-text-muted cursor-pointer hover:text-monitor-text-primary",onClick:u=>$e(t).selectSession(c.sessionId)},j(c.sessionId.slice(0,8)),9,Ep),p("span",Mp,j(o(c.tokenUsage.totalInput+c.tokenUsage.totalOutput)),1)]))),128))])])):Z("",!0)]))}}),Bp={class:"flex items-center space-x-2"},Dp={key:0,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Tp={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pp={key:0,class:"inline-flex items-center text-xs text-monitor-text-muted"},Lp=Gt({__name:"ModeIndicator",setup(e){const t=hs(),s=_e(()=>t.mode),i=_e(()=>t.connectionStatus==="connected");return(r,n)=>(R(),B("div",Bp,[p("span",{class:ve(["inline-flex items-center px-2 py-0.5 rounded text-xs font-medium",{"bg-blue-900 text-blue-200":s.value==="local","bg-purple-900 text-purple-200":s.value==="redis"}])},[s.value==="local"?(R(),B("svg",Dp,[...n[0]||(n[0]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(R(),B("svg",Tp,[...n[1]||(n[1]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"},null,-1)])])),xt(" "+j(s.value==="local"?"Local":"Redis"),1)],2),i.value?(R(),B("span",Pp,[...n[2]||(n[2]=[p("svg",{class:"w-3 h-3 mr-1 text-green-500",fill:"currentColor",viewBox:"0 0 24 24"},[p("circle",{cx:"12",cy:"12",r:"4"})],-1),xt(" Connected ",-1)])])):Z("",!0)]))}}),Ip={class:"bg-monitor-bg-secondary px-4 py-2"},Ap={class:"flex items-center space-x-4"},Op={class:"relative flex-1 max-w-md"},Np={class:"relative"},$p={key:0,class:"bg-monitor-accent-cyan text-white text-xs px-1.5 rounded-full"},Hp={key:0,class:"absolute top-full left-0 mt-1 w-56 bg-monitor-bg-primary border border-slate-700 rounded-lg shadow-xl z-50"},Wp={class:"p-2 space-y-1 max-h-64 overflow-y-auto"},Fp=["onClick"],zp={key:0,class:"w-4 h-4 text-monitor-accent-cyan",fill:"currentColor",viewBox:"0 0 24 24"},Kp={key:0,class:"flex items-center space-x-2"},Up=["onClick"],Vp={class:"text-xs text-monitor-text-muted"},jp=Gt({__name:"FilterBar",setup(e){const t=hs(),s=ue(""),i=ue(!1),r=["session_start","session_end","tool_call","tool_result","message","notification","thinking","error","agent_spawn","agent_complete"],n=_e(()=>t.filters.eventTypes),o=_e(()=>t.filters.eventTypes.length>0||t.filters.searchQuery!=="");function l(){t.setFilter("searchQuery",s.value)}function a(d){t.toggleEventTypeFilter(d)}function h(){s.value="",t.clearFilters()}function c(d){return d.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ")}function u(d){return{session_start:"bg-green-500/20 text-green-400 border-green-500",session_end:"bg-gray-500/20 text-gray-400 border-gray-500",tool_call:"bg-blue-500/20 text-blue-400 border-blue-500",tool_result:"bg-cyan-500/20 text-cyan-400 border-cyan-500",message:"bg-white/20 text-white border-white",notification:"bg-yellow-500/20 text-yellow-400 border-yellow-500",thinking:"bg-purple-500/20 text-purple-400 border-purple-500",error:"bg-red-500/20 text-red-400 border-red-500",agent_spawn:"bg-orange-500/20 text-orange-400 border-orange-500",agent_complete:"bg-lime-500/20 text-lime-400 border-lime-500"}[d]||"bg-gray-500/20 text-gray-400 border-gray-500"}return(d,f)=>(R(),B(ye,null,[p("div",Ip,[p("div",Ap,[p("div",Op,[f[3]||(f[3]=p("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-monitor-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),Xa(p("input",{"onUpdate:modelValue":f[0]||(f[0]=_=>s.value=_),type:"text",placeholder:"Search events...",class:"w-full pl-10 pr-4 py-1.5 bg-monitor-bg-primary border border-slate-700 rounded-lg text-sm text-monitor-text-primary placeholder-monitor-text-muted focus:outline-none focus:border-monitor-accent-cyan",onInput:l},null,544),[[Ch,s.value]])]),p("div",Np,[p("button",{class:ve(["flex items-center space-x-2 px-3 py-1.5 bg-monitor-bg-primary border border-slate-700 rounded-lg text-sm hover:border-slate-600 transition-colors",{"border-monitor-accent-cyan":n.value.length>0}]),onClick:f[1]||(f[1]=_=>i.value=!i.value)},[f[4]||(f[4]=p("svg",{class:"w-4 h-4 text-monitor-text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})],-1)),f[5]||(f[5]=p("span",{class:"text-monitor-text-secondary"},"Event Types",-1)),n.value.length>0?(R(),B("span",$p,j(n.value.length),1)):Z("",!0)],2),i.value?(R(),B("div",Hp,[p("div",Wp,[(R(),B(ye,null,_t(r,_=>p("button",{key:_,class:"w-full flex items-center justify-between px-2 py-1.5 rounded hover:bg-slate-700/50 transition-colors",onClick:v=>a(_)},[p("span",{class:ve(["px-2 py-0.5 rounded text-xs border",u(_)])},j(c(_)),3),n.value.includes(_)?(R(),B("svg",zp,[...f[6]||(f[6]=[p("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):Z("",!0)],8,Fp)),64))])])):Z("",!0)]),n.value.length>0?(R(),B("div",Kp,[(R(!0),B(ye,null,_t(n.value,_=>(R(),B("span",{key:_,class:ve(["inline-flex items-center px-2 py-0.5 rounded text-xs border cursor-pointer hover:opacity-80",u(_)]),onClick:v=>a(_)},[xt(j(c(_))+" ",1),f[7]||(f[7]=p("svg",{class:"w-3 h-3 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1))],10,Up))),128))])):Z("",!0),o.value?(R(),B("button",{key:1,class:"text-xs text-monitor-text-muted hover:text-monitor-text-primary transition-colors",onClick:h}," Clear all ")):Z("",!0),p("div",Vp,j($e(t).filteredEvents.length)+" events ",1)])]),i.value?(R(),B("div",{key:0,class:"fixed inset-0 z-40",onClick:f[2]||(f[2]=_=>i.value=!1)})):Z("",!0)],64))}});/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var Dh=Object.defineProperty,qp=Object.getOwnPropertyDescriptor,Yp=(e,t)=>{for(var s in t)Dh(e,s,{get:t[s],enumerable:!0})},Ae=(e,t,s,i)=>{for(var r=i>1?void 0:i?qp(t,s):t,n=e.length-1,o;n>=0;n--)(o=e[n])&&(r=(i?o(t,s,r):o(r))||r);return i&&r&&Dh(t,s,r),r},Y=(e,t)=>(s,i)=>t(s,i,e),bl="Terminal input",Rn={get:()=>bl,set:e=>bl=e},yl="Too much output to announce, navigate to rows manually to read",Bn={get:()=>yl,set:e=>yl=e};function Xp(e){return e.replace(/\r?\n/g,"\r")}function Gp(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function Jp(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function Zp(e,t,s,i){if(e.stopPropagation(),e.clipboardData){let r=e.clipboardData.getData("text/plain");Th(r,t,s,i)}}function Th(e,t,s,i){e=Xp(e),e=Gp(e,s.decPrivateModes.bracketedPasteMode&&i.rawOptions.ignoreBracketedPasteMode!==!0),s.triggerDataEvent(e,!0),t.value=""}function Ph(e,t,s){let i=s.getBoundingClientRect(),r=e.clientX-i.left-10,n=e.clientY-i.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${r}px`,t.style.top=`${n}px`,t.style.zIndex="1000",t.focus()}function wl(e,t,s,i,r){Ph(e,t,s),r&&i.rightClickSelect(e),t.value=i.selectionText,t.select()}function bs(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function Fr(e,t=0,s=e.length){let i="";for(let r=t;r<s;++r){let n=e[r];n>65535?(n-=65536,i+=String.fromCharCode((n>>10)+55296)+String.fromCharCode(n%1024+56320)):i+=String.fromCharCode(n)}return i}var Qp=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let s=e.length;if(!s)return 0;let i=0,r=0;if(this._interim){let n=e.charCodeAt(r++);56320<=n&&n<=57343?t[i++]=(this._interim-55296)*1024+n-56320+65536:(t[i++]=this._interim,t[i++]=n),this._interim=0}for(let n=r;n<s;++n){let o=e.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=s)return this._interim=o,i;let l=e.charCodeAt(n);56320<=l&&l<=57343?t[i++]=(o-55296)*1024+l-56320+65536:(t[i++]=o,t[i++]=l);continue}o!==65279&&(t[i++]=o)}return i}},eg=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let s=e.length;if(!s)return 0;let i=0,r,n,o,l,a=0,h=0;if(this.interim[0]){let d=!1,f=this.interim[0];f&=(f&224)===192?31:(f&240)===224?15:7;let _=0,v;for(;(v=this.interim[++_]&63)&&_<4;)f<<=6,f|=v;let b=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,m=b-_;for(;h<m;){if(h>=s)return 0;if(v=e[h++],(v&192)!==128){h--,d=!0;break}else this.interim[_++]=v,f<<=6,f|=v&63}d||(b===2?f<128?h--:t[i++]=f:b===3?f<2048||f>=55296&&f<=57343||f===65279||(t[i++]=f):f<65536||f>1114111||(t[i++]=f)),this.interim.fill(0)}let c=s-4,u=h;for(;u<s;){for(;u<c&&!((r=e[u])&128)&&!((n=e[u+1])&128)&&!((o=e[u+2])&128)&&!((l=e[u+3])&128);)t[i++]=r,t[i++]=n,t[i++]=o,t[i++]=l,u+=4;if(r=e[u++],r<128)t[i++]=r;else if((r&224)===192){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(a=(r&31)<<6|n&63,a<128){u--;continue}t[i++]=a}else if((r&240)===224){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(a=(r&15)<<12|(n&63)<<6|o&63,a<2048||a>=55296&&a<=57343||a===65279)continue;t[i++]=a}else if((r&248)===240){if(u>=s)return this.interim[0]=r,i;if(n=e[u++],(n&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,i;if(o=e[u++],(o&192)!==128){u--;continue}if(u>=s)return this.interim[0]=r,this.interim[1]=n,this.interim[2]=o,i;if(l=e[u++],(l&192)!==128){u--;continue}if(a=(r&7)<<18|(n&63)<<12|(o&63)<<6|l&63,a<65536||a>1114111)continue;t[i++]=a}}return i}},Lh="",ys=" ",Wi=class Ih{constructor(){this.fg=0,this.bg=0,this.extended=new Sr}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new Ih;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},Sr=class Ah{constructor(t=0,s=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=s}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new Ah(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},Pt=class Oh extends Wi{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new Sr,this.combinedData=""}static fromCharData(t){let s=new Oh;return s.setFromCharData(t),s}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?bs(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let s=!1;if(t[1].length>2)s=!0;else if(t[1].length===2){let i=t[1].charCodeAt(0);if(55296<=i&&i<=56319){let r=t[1].charCodeAt(1);56320<=r&&r<=57343?this.content=(i-55296)*1024+r-56320+65536|t[2]<<22:s=!0}else s=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;s&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Cl="di$target",Dn="di$dependencies",sn=new Map;function tg(e){return e[Dn]||[]}function st(e){if(sn.has(e))return sn.get(e);let t=function(s,i,r){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");sg(t,s,r)};return t._id=e,sn.set(e,t),t}function sg(e,t,s){t[Cl]===t?t[Dn].push({id:e,index:s}):(t[Dn]=[{id:e,index:s}],t[Cl]=t)}var pt=st("BufferService"),Nh=st("CoreMouseService"),Ws=st("CoreService"),ig=st("CharsetService"),Bo=st("InstantiationService"),$h=st("LogService"),gt=st("OptionsService"),Hh=st("OscLinkService"),rg=st("UnicodeService"),Fi=st("DecorationService"),Tn=class{constructor(e,t,s){this._bufferService=e,this._optionsService=t,this._oscLinkService=s}provideLinks(e,t){var c;let s=this._bufferService.buffer.lines.get(e-1);if(!s){t(void 0);return}let i=[],r=this._optionsService.rawOptions.linkHandler,n=new Pt,o=s.getTrimmedLength(),l=-1,a=-1,h=!1;for(let u=0;u<o;u++)if(!(a===-1&&!s.hasContent(u))){if(s.loadCell(u,n),n.hasExtendedAttrs()&&n.extended.urlId)if(a===-1){a=u,l=n.extended.urlId;continue}else h=n.extended.urlId!==l;else a!==-1&&(h=!0);if(h||a!==-1&&u===o-1){let d=(c=this._oscLinkService.getLinkData(l))==null?void 0:c.uri;if(d){let f={start:{x:a+1,y:e},end:{x:u+(!h&&u===o-1?1:0),y:e}},_=!1;if(!(r!=null&&r.allowNonHttpProtocols))try{let v=new URL(d);["http:","https:"].includes(v.protocol)||(_=!0)}catch{_=!0}_||i.push({text:d,range:f,activate:(v,b)=>r?r.activate(v,b,f):ng(v,b),hover:(v,b)=>{var m;return(m=r==null?void 0:r.hover)==null?void 0:m.call(r,v,b,f)},leave:(v,b)=>{var m;return(m=r==null?void 0:r.leave)==null?void 0:m.call(r,v,b,f)}})}h=!1,n.hasExtendedAttrs()&&n.extended.urlId?(a=u,l=n.extended.urlId):(a=-1,l=-1)}}t(i)}};Tn=Ae([Y(0,pt),Y(1,gt),Y(2,Hh)],Tn);function ng(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var zr=st("CharSizeService"),cs=st("CoreBrowserService"),Do=st("MouseService"),us=st("RenderService"),og=st("SelectionService"),Wh=st("CharacterJoinerService"),si=st("ThemeService"),Fh=st("LinkProviderService"),lg=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?xl.isErrorNoTelemetry(e)?new xl(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},ag=new lg;function rr(e){hg(e)||ag.onUnexpectedError(e)}var Pn="Canceled";function hg(e){return e instanceof cg?!0:e instanceof Error&&e.name===Pn&&e.message===Pn}var cg=class extends Error{constructor(){super(Pn),this.name=this.message}};function ug(e){return new Error(`Illegal argument: ${e}`)}var xl=class Ln extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Ln)return t;let s=new Ln;return s.message=t.message,s.stack=t.stack,s}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},In=class zh extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,zh.prototype)}};function yt(e,t=0){return e[e.length-(1+t)]}var dg;(e=>{function t(n){return n<0}e.isLessThan=t;function s(n){return n<=0}e.isLessThanOrEqual=s;function i(n){return n>0}e.isGreaterThan=i;function r(n){return n===0}e.isNeitherLessOrGreaterThan=r,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(dg||(dg={}));function fg(e,t){let s=this,i=!1,r;return function(){return i||(i=!0,t||(r=e.apply(s,arguments))),r}}var Kh;(e=>{function t(C){return C&&typeof C=="object"&&typeof C[Symbol.iterator]=="function"}e.is=t;let s=Object.freeze([]);function i(){return s}e.empty=i;function*r(C){yield C}e.single=r;function n(C){return t(C)?C:r(C)}e.wrap=n;function o(C){return C||s}e.from=o;function*l(C){for(let N=C.length-1;N>=0;N--)yield C[N]}e.reverse=l;function a(C){return!C||C[Symbol.iterator]().next().done===!0}e.isEmpty=a;function h(C){return C[Symbol.iterator]().next().value}e.first=h;function c(C,N){let X=0;for(let ne of C)if(N(ne,X++))return!0;return!1}e.some=c;function u(C,N){for(let X of C)if(N(X))return X}e.find=u;function*d(C,N){for(let X of C)N(X)&&(yield X)}e.filter=d;function*f(C,N){let X=0;for(let ne of C)yield N(ne,X++)}e.map=f;function*_(C,N){let X=0;for(let ne of C)yield*N(ne,X++)}e.flatMap=_;function*v(...C){for(let N of C)yield*N}e.concat=v;function b(C,N,X){let ne=X;for(let G of C)ne=N(ne,G);return ne}e.reduce=b;function*m(C,N,X=C.length){for(N<0&&(N+=C.length),X<0?X+=C.length:X>C.length&&(X=C.length);N<X;N++)yield C[N]}e.slice=m;function y(C,N=Number.POSITIVE_INFINITY){let X=[];if(N===0)return[X,C];let ne=C[Symbol.iterator]();for(let G=0;G<N;G++){let Q=ne.next();if(Q.done)return[X,e.empty()];X.push(Q.value)}return[X,{[Symbol.iterator](){return ne}}]}e.consume=y;async function k(C){let N=[];for await(let X of C)N.push(X);return Promise.resolve(N)}e.asyncToArray=k})(Kh||(Kh={}));function $s(e){if(Kh.is(e)){let t=[];for(let s of e)if(s)try{s.dispose()}catch(i){t.push(i)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function _g(...e){return De(()=>$s(e))}function De(e){return{dispose:fg(()=>{e()})}}var Uh=class Vh{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{$s(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?Vh.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),void 0)}};Uh.DISABLE_DISPOSED_WARNING=!1;var Cs=Uh,he=class{constructor(){this._store=new Cs,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};he.None=Object.freeze({dispose(){}});var ti=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||((t=this._value)==null||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,(e=this._value)==null||e.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}},is=typeof window=="object"?window:globalThis,An=class On{constructor(t){this.element=t,this.next=On.Undefined,this.prev=On.Undefined}};An.Undefined=new An(void 0);var Te=An,kl=class{constructor(){this._first=Te.Undefined,this._last=Te.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===Te.Undefined}clear(){let e=this._first;for(;e!==Te.Undefined;){let t=e.next;e.prev=Te.Undefined,e.next=Te.Undefined,e=t}this._first=Te.Undefined,this._last=Te.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let s=new Te(e);if(this._first===Te.Undefined)this._first=s,this._last=s;else if(t){let r=this._last;this._last=s,s.prev=r,r.next=s}else{let r=this._first;this._first=s,s.next=r,r.prev=s}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(s))}}shift(){if(this._first!==Te.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Te.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Te.Undefined&&e.next!==Te.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Te.Undefined&&e.next===Te.Undefined?(this._first=Te.Undefined,this._last=Te.Undefined):e.next===Te.Undefined?(this._last=this._last.prev,this._last.next=Te.Undefined):e.prev===Te.Undefined&&(this._first=this._first.next,this._first.prev=Te.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==Te.Undefined;)yield e.element,e=e.next}},pg=globalThis.performance&&typeof globalThis.performance.now=="function",gg=class jh{static create(t){return new jh(t)}constructor(t){this._now=pg&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},nt;(e=>{e.None=()=>he.None;function t($,M){return u($,()=>{},0,void 0,!0,void 0,M)}e.defer=t;function s($){return(M,A=null,U)=>{let H=!1,F;return F=$(P=>{if(!H)return F?F.dispose():H=!0,M.call(A,P)},null,U),H&&F.dispose(),F}}e.once=s;function i($,M,A){return h((U,H=null,F)=>$(P=>U.call(H,M(P)),null,F),A)}e.map=i;function r($,M,A){return h((U,H=null,F)=>$(P=>{M(P),U.call(H,P)},null,F),A)}e.forEach=r;function n($,M,A){return h((U,H=null,F)=>$(P=>M(P)&&U.call(H,P),null,F),A)}e.filter=n;function o($){return $}e.signal=o;function l(...$){return(M,A=null,U)=>{let H=_g(...$.map(F=>F(P=>M.call(A,P))));return c(H,U)}}e.any=l;function a($,M,A,U){let H=A;return i($,F=>(H=M(H,F),H),U)}e.reduce=a;function h($,M){let A,U={onWillAddFirstListener(){A=$(H.fire,H)},onDidRemoveLastListener(){A==null||A.dispose()}},H=new W(U);return M==null||M.add(H),H.event}function c($,M){return M instanceof Array?M.push($):M&&M.add($),$}function u($,M,A=100,U=!1,H=!1,F,P){let de,Be,We,Oe=0,it,Xe={leakWarningThreshold:F,onWillAddFirstListener(){de=$(Fe=>{Oe++,Be=M(Be,Fe),U&&!We&&(vt.fire(Be),Be=void 0),it=()=>{let mt=Be;Be=void 0,We=void 0,(!U||Oe>1)&&vt.fire(mt),Oe=0},typeof A=="number"?(clearTimeout(We),We=setTimeout(it,A)):We===void 0&&(We=0,queueMicrotask(it))})},onWillRemoveListener(){H&&Oe>0&&(it==null||it())},onDidRemoveLastListener(){it=void 0,de.dispose()}},vt=new W(Xe);return P==null||P.add(vt),vt.event}e.debounce=u;function d($,M=0,A){return e.debounce($,(U,H)=>U?(U.push(H),U):[H],M,void 0,!0,void 0,A)}e.accumulate=d;function f($,M=(U,H)=>U===H,A){let U=!0,H;return n($,F=>{let P=U||!M(F,H);return U=!1,H=F,P},A)}e.latch=f;function _($,M,A){return[e.filter($,M,A),e.filter($,U=>!M(U),A)]}e.split=_;function v($,M=!1,A=[],U){let H=A.slice(),F=$(Be=>{H?H.push(Be):de.fire(Be)});U&&U.add(F);let P=()=>{H==null||H.forEach(Be=>de.fire(Be)),H=null},de=new W({onWillAddFirstListener(){F||(F=$(Be=>de.fire(Be)),U&&U.add(F))},onDidAddFirstListener(){H&&(M?setTimeout(P):P())},onDidRemoveLastListener(){F&&F.dispose(),F=null}});return U&&U.add(de),de.event}e.buffer=v;function b($,M){return(A,U,H)=>{let F=M(new y);return $(function(P){let de=F.evaluate(P);de!==m&&A.call(U,de)},void 0,H)}}e.chain=b;let m=Symbol("HaltChainable");class y{constructor(){this.steps=[]}map(M){return this.steps.push(M),this}forEach(M){return this.steps.push(A=>(M(A),A)),this}filter(M){return this.steps.push(A=>M(A)?A:m),this}reduce(M,A){let U=A;return this.steps.push(H=>(U=M(U,H),U)),this}latch(M=(A,U)=>A===U){let A=!0,U;return this.steps.push(H=>{let F=A||!M(H,U);return A=!1,U=H,F?H:m}),this}evaluate(M){for(let A of this.steps)if(M=A(M),M===m)break;return M}}function k($,M,A=U=>U){let U=(...de)=>P.fire(A(...de)),H=()=>$.on(M,U),F=()=>$.removeListener(M,U),P=new W({onWillAddFirstListener:H,onDidRemoveLastListener:F});return P.event}e.fromNodeEventEmitter=k;function C($,M,A=U=>U){let U=(...de)=>P.fire(A(...de)),H=()=>$.addEventListener(M,U),F=()=>$.removeEventListener(M,U),P=new W({onWillAddFirstListener:H,onDidRemoveLastListener:F});return P.event}e.fromDOMEventEmitter=C;function N($){return new Promise(M=>s($)(M))}e.toPromise=N;function X($){let M=new W;return $.then(A=>{M.fire(A)},()=>{M.fire(void 0)}).finally(()=>{M.dispose()}),M.event}e.fromPromise=X;function ne($,M){return $(A=>M.fire(A))}e.forward=ne;function G($,M,A){return M(A),$(U=>M(U))}e.runAndSubscribe=G;class Q{constructor(M,A){this._observable=M,this._counter=0,this._hasChanged=!1;let U={onWillAddFirstListener:()=>{M.addObserver(this)},onDidRemoveLastListener:()=>{M.removeObserver(this)}};this.emitter=new W(U),A&&A.add(this.emitter)}beginUpdate(M){this._counter++}handlePossibleChange(M){}handleChange(M,A){this._hasChanged=!0}endUpdate(M){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function pe($,M){return new Q($,M).emitter.event}e.fromObservable=pe;function oe($){return(M,A,U)=>{let H=0,F=!1,P={beginUpdate(){H++},endUpdate(){H--,H===0&&($.reportChanges(),F&&(F=!1,M.call(A)))},handlePossibleChange(){},handleChange(){F=!0}};$.addObserver(P),$.reportChanges();let de={dispose(){$.removeObserver(P)}};return U instanceof Cs?U.add(de):Array.isArray(U)&&U.push(de),de}}e.fromObservableLight=oe})(nt||(nt={}));var Nn=class $n{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${$n._idPool++}`,$n.all.add(this)}start(t){this._stopWatch=new gg,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Nn.all=new Set,Nn._idPool=0;var vg=Nn,mg=-1,qh=class Yh{constructor(t,s,i=(Yh._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=s,this.name=i,this._warnCountdown=0}dispose(){var t;(t=this._stacks)==null||t.clear()}check(t,s){let i=this.threshold;if(i<=0||s<i)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let[n,o]=this.getMostFrequentStack(),l=`[${this.name}] potential listener LEAK detected, having ${s} listeners already. MOST frequent listener (${o}):`;console.warn(l),console.warn(n);let a=new yg(l,n);this._errorHandler(a)}return()=>{let n=this._stacks.get(t.value)||0;this._stacks.set(t.value,n-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,s=0;for(let[i,r]of this._stacks)(!t||s<r)&&(t=[i,r],s=r);return t}};qh._idPool=1;var Sg=qh,bg=class Xh{constructor(t){this.value=t}static create(){let t=new Error;return new Xh(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},yg=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},wg=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},Cg=0,rn=class{constructor(e){this.value=e,this.id=Cg++}},xg=2,kg,W=class{constructor(e){var t,s,i,r;this._size=0,this._options=e,this._leakageMon=(t=this._options)!=null&&t.leakWarningThreshold?new Sg((e==null?void 0:e.onListenerError)??rr,((s=this._options)==null?void 0:s.leakWarningThreshold)??mg):void 0,this._perfMon=(i=this._options)!=null&&i._profName?new vg(this._options._profName):void 0,this._deliveryQueue=(r=this._options)==null?void 0:r.deliveryQueue}dispose(){var e,t,s,i;this._disposed||(this._disposed=!0,((e=this._deliveryQueue)==null?void 0:e.current)===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),(s=(t=this._options)==null?void 0:t.onDidRemoveLastListener)==null||s.call(t),(i=this._leakageMon)==null||i.dispose())}get event(){return this._event??(this._event=(e,t,s)=>{var o,l,a,h,c;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let u=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(u);let d=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],f=new wg(`${u}. HINT: Stack shows most frequent listener (${d[1]}-times)`,d[0]);return(((o=this._options)==null?void 0:o.onListenerError)||rr)(f),he.None}if(this._disposed)return he.None;t&&(e=e.bind(t));let i=new rn(e),r;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(i.stack=bg.create(),r=this._leakageMon.check(i.stack,this._size+1)),this._listeners?this._listeners instanceof rn?(this._deliveryQueue??(this._deliveryQueue=new Eg),this._listeners=[this._listeners,i]):this._listeners.push(i):((a=(l=this._options)==null?void 0:l.onWillAddFirstListener)==null||a.call(l,this),this._listeners=i,(c=(h=this._options)==null?void 0:h.onDidAddFirstListener)==null||c.call(h,this)),this._size++;let n=De(()=>{r==null||r(),this._removeListener(i)});return s instanceof Cs?s.add(n):Array.isArray(s)&&s.push(n),n}),this._event}_removeListener(e){var r,n,o,l;if((n=(r=this._options)==null?void 0:r.onWillRemoveListener)==null||n.call(r,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(l=(o=this._options)==null?void 0:o.onDidRemoveLastListener)==null||l.call(o,this),this._size=0;return}let t=this._listeners,s=t.indexOf(e);if(s===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,t[s]=void 0;let i=this._deliveryQueue.current===this;if(this._size*xg<=t.length){let a=0;for(let h=0;h<t.length;h++)t[h]?t[a++]=t[h]:i&&(this._deliveryQueue.end--,a<this._deliveryQueue.i&&this._deliveryQueue.i--);t.length=a}}_deliver(e,t){var i;if(!e)return;let s=((i=this._options)==null?void 0:i.onListenerError)||rr;if(!s){e.value(t);return}try{e.value(t)}catch(r){s(r)}}_deliverQueue(e){let t=e.current._listeners;for(;e.i<e.end;)this._deliver(t[e.i++],e.value);e.reset()}fire(e){var t,s,i,r;if((t=this._deliveryQueue)!=null&&t.current&&(this._deliverQueue(this._deliveryQueue),(s=this._perfMon)==null||s.stop()),(i=this._perfMon)==null||i.start(this._size),this._listeners)if(this._listeners instanceof rn)this._deliver(this._listeners,e);else{let n=this._deliveryQueue;n.enqueue(this,e,this._listeners.length),this._deliverQueue(n)}(r=this._perfMon)==null||r.stop()}hasListeners(){return this._size>0}},Eg=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,s){this.i=0,this.end=s,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Hn=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new W,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new W,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,s){if(this.getZoomLevel(s)===t)return;let i=this.getWindowId(s);this.mapWindowIdToZoomLevel.set(i,t),this._onDidChangeZoomLevel.fire(i)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,s){this.mapWindowIdToZoomFactor.set(this.getWindowId(s),t)}setFullscreen(t,s){if(this.isFullscreen(s)===t)return;let i=this.getWindowId(s);this.mapWindowIdToFullScreen.set(i,t),this._onDidChangeFullscreen.fire(i)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Hn.INSTANCE=new Hn;var To=Hn;function Mg(e,t,s){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",s)}To.INSTANCE.onDidChangeZoomLevel;function Rg(e){return To.INSTANCE.getZoomFactor(e)}To.INSTANCE.onDidChangeFullscreen;var ii=typeof navigator=="object"?navigator.userAgent:"",Wn=ii.indexOf("Firefox")>=0,Bg=ii.indexOf("AppleWebKit")>=0,Po=ii.indexOf("Chrome")>=0,Dg=!Po&&ii.indexOf("Safari")>=0;ii.indexOf("Electron/")>=0;ii.indexOf("Android")>=0;var nn=!1;if(typeof is.matchMedia=="function"){let e=is.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=is.matchMedia("(display-mode: fullscreen)");nn=e.matches,Mg(is,e,({matches:s})=>{nn&&t.matches||(nn=s)})}var Ys="en",Fn=!1,zn=!1,nr=!1,Gh=!1,qi,or=Ys,El=Ys,Tg,At,Ns=globalThis,rt,_a;typeof Ns.vscode<"u"&&typeof Ns.vscode.process<"u"?rt=Ns.vscode.process:typeof process<"u"&&typeof((_a=process==null?void 0:process.versions)==null?void 0:_a.node)=="string"&&(rt=process);var pa,Pg=typeof((pa=rt==null?void 0:rt.versions)==null?void 0:pa.electron)=="string",Lg=Pg&&(rt==null?void 0:rt.type)==="renderer",ga;if(typeof rt=="object"){Fn=rt.platform==="win32",zn=rt.platform==="darwin",nr=rt.platform==="linux",nr&&rt.env.SNAP&&rt.env.SNAP_REVISION,rt.env.CI||rt.env.BUILD_ARTIFACTSTAGINGDIRECTORY,qi=Ys,or=Ys;let e=rt.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);qi=t.userLocale,El=t.osLocale,or=t.resolvedLanguage||Ys,Tg=(ga=t.languagePack)==null?void 0:ga.translationsConfigFile}catch{}Gh=!0}else typeof navigator=="object"&&!Lg?(At=navigator.userAgent,Fn=At.indexOf("Windows")>=0,zn=At.indexOf("Macintosh")>=0,(At.indexOf("Macintosh")>=0||At.indexOf("iPad")>=0||At.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0,nr=At.indexOf("Linux")>=0,(At==null?void 0:At.indexOf("Mobi"))>=0,or=globalThis._VSCODE_NLS_LANGUAGE||Ys,qi=navigator.language.toLowerCase(),El=qi):console.error("Unable to resolve platform.");var Jh=Fn,qt=zn,Ig=nr,Ml=Gh,Xt=At,fs=or,Ag;(e=>{function t(){return fs}e.value=t;function s(){return fs.length===2?fs==="en":fs.length>=3?fs[0]==="e"&&fs[1]==="n"&&fs[2]==="-":!1}e.isDefaultVariant=s;function i(){return fs==="en"}e.isDefault=i})(Ag||(Ag={}));var Og=typeof Ns.postMessage=="function"&&!Ns.importScripts;(()=>{if(Og){let e=[];Ns.addEventListener("message",s=>{if(s.data&&s.data.vscodeScheduleAsyncWork)for(let i=0,r=e.length;i<r;i++){let n=e[i];if(n.id===s.data.vscodeScheduleAsyncWork){e.splice(i,1),n.callback();return}}});let t=0;return s=>{let i=++t;e.push({id:i,callback:s}),Ns.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();var Ng=!!(Xt&&Xt.indexOf("Chrome")>=0);Xt&&Xt.indexOf("Firefox")>=0;!Ng&&Xt&&Xt.indexOf("Safari")>=0;Xt&&Xt.indexOf("Edg/")>=0;Xt&&Xt.indexOf("Android")>=0;var Us=typeof navigator=="object"?navigator:{};Ml||document.queryCommandSupported&&document.queryCommandSupported("copy")||Us&&Us.clipboard&&Us.clipboard.writeText,Ml||Us&&Us.clipboard&&Us.clipboard.readText;var Lo=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},on=new Lo,Rl=new Lo,Bl=new Lo,$g=new Array(230),Zh;(e=>{function t(l){return on.keyCodeToStr(l)}e.toString=t;function s(l){return on.strToKeyCode(l)}e.fromString=s;function i(l){return Rl.keyCodeToStr(l)}e.toUserSettingsUS=i;function r(l){return Bl.keyCodeToStr(l)}e.toUserSettingsGeneral=r;function n(l){return Rl.strToKeyCode(l)||Bl.strToKeyCode(l)}e.fromUserSettings=n;function o(l){if(l>=98&&l<=113)return null;switch(l){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return on.keyCodeToStr(l)}e.toElectronAccelerator=o})(Zh||(Zh={}));var Hg=class Qh{constructor(t,s,i,r,n){this.ctrlKey=t,this.shiftKey=s,this.altKey=i,this.metaKey=r,this.keyCode=n}equals(t){return t instanceof Qh&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",s=this.shiftKey?"1":"0",i=this.altKey?"1":"0",r=this.metaKey?"1":"0";return`K${t}${s}${i}${r}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new Wg([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},Wg=class{constructor(e){if(e.length===0)throw ug("chords");this.chords=e}getHashCode(){let e="";for(let t=0,s=this.chords.length;t<s;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function Fg(e){if(e.charCode){let s=String.fromCharCode(e.charCode).toUpperCase();return Zh.fromString(s)}let t=e.keyCode;if(t===3)return 7;if(Wn)switch(t){case 59:return 85;case 60:if(Ig)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(qt)return 57;break}else if(Bg&&(qt&&t===93||!qt&&t===92))return 57;return $g[t]||0}var zg=qt?256:2048,Kg=512,Ug=1024,Vg=qt?2048:256,Dl=class{constructor(e){var s;this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=(s=t.getModifierState)==null?void 0:s.call(t,"AltGraph"),this.keyCode=Fg(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=zg),this.altKey&&(t|=Kg),this.shiftKey&&(t|=Ug),this.metaKey&&(t|=Vg),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new Hg(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},Tl=new WeakMap;function jg(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,s=e.parent.location;if(t.origin!=="null"&&s.origin!=="null"&&t.origin!==s.origin)return null}catch{return null}return e.parent}var qg=class{static getSameOriginWindowChain(e){let t=Tl.get(e);if(!t){t=[],Tl.set(e,t);let s=e,i;do i=jg(s),i?t.push({window:new WeakRef(s),iframeElement:s.frameElement||null}):t.push({window:new WeakRef(s),iframeElement:null}),s=i;while(s)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let s=0,i=0,r=this.getSameOriginWindowChain(e);for(let n of r){let o=n.window.deref();if(s+=(o==null?void 0:o.scrollY)??0,i+=(o==null?void 0:o.scrollX)??0,o===t||!n.iframeElement)break;let l=n.iframeElement.getBoundingClientRect();s+=l.top,i+=l.left}return{top:s,left:i}}},Yi=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let s=qg.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=s.left,this.posy-=s.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},Pl=class{constructor(e,t=0,s=0){var r;this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=s,this.deltaX=t;let i=!1;if(Po){let n=navigator.userAgent.match(/Chrome\/(\d+)/);i=(n?parseInt(n[1]):123)<=122}if(e){let n=e,o=e,l=((r=e.view)==null?void 0:r.devicePixelRatio)||1;if(typeof n.wheelDeltaY<"u")i?this.deltaY=n.wheelDeltaY/(120*l):this.deltaY=n.wheelDeltaY/120;else if(typeof o.VERTICAL_AXIS<"u"&&o.axis===o.VERTICAL_AXIS)this.deltaY=-o.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?Wn&&!qt?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof n.wheelDeltaX<"u")Dg&&Jh?this.deltaX=-(n.wheelDeltaX/120):i?this.deltaX=n.wheelDeltaX/(120*l):this.deltaX=n.wheelDeltaX/120;else if(typeof o.HORIZONTAL_AXIS<"u"&&o.axis===o.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?Wn&&!qt?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(i?this.deltaY=e.wheelDelta/(120*l):this.deltaY=e.wheelDelta/120)}}preventDefault(){var e;(e=this.browserEvent)==null||e.preventDefault()}stopPropagation(){var e;(e=this.browserEvent)==null||e.stopPropagation()}},ec=Object.freeze(function(e,t){let s=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(s)}}}),Yg;(e=>{function t(s){return s===e.None||s===e.Cancelled||s instanceof Xg?!0:!s||typeof s!="object"?!1:typeof s.isCancellationRequested=="boolean"&&typeof s.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:nt.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:ec})})(Yg||(Yg={}));var Xg=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?ec:(this._emitter||(this._emitter=new W),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},Io=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new In("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new In("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},Gg=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){var e;(e=this.disposable)==null||e.dispose(),this.disposable=void 0}cancelAndSet(e,t,s=globalThis){if(this.isDisposed)throw new In("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let i=s.setInterval(()=>{e()},t);this.disposable=De(()=>{s.clearInterval(i),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},Jg;(e=>{async function t(i){let r,n=await Promise.all(i.map(o=>o.then(l=>l,l=>{r||(r=l)})));if(typeof r<"u")throw r;return n}e.settled=t;function s(i){return new Promise(async(r,n)=>{try{await i(r,n)}catch(o){n(o)}})}e.withAsyncBody=s})(Jg||(Jg={}));var Ll=class Dt{static fromArray(t){return new Dt(s=>{s.emitMany(t)})}static fromPromise(t){return new Dt(async s=>{s.emitMany(await t)})}static fromPromises(t){return new Dt(async s=>{await Promise.all(t.map(async i=>s.emitOne(await i)))})}static merge(t){return new Dt(async s=>{await Promise.all(t.map(async i=>{for await(let r of i)s.emitOne(r)}))})}constructor(t,s){this._state=0,this._results=[],this._error=null,this._onReturn=s,this._onStateChanged=new W,queueMicrotask(async()=>{let i={emitOne:r=>this.emitOne(r),emitMany:r=>this.emitMany(r),reject:r=>this.reject(r)};try{await Promise.resolve(t(i)),this.resolve()}catch(r){this.reject(r)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await nt.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>{var s;return(s=this._onReturn)==null||s.call(this),{done:!0,value:void 0}}}}static map(t,s){return new Dt(async i=>{for await(let r of t)i.emitOne(s(r))})}map(t){return Dt.map(this,t)}static filter(t,s){return new Dt(async i=>{for await(let r of t)s(r)&&i.emitOne(r)})}filter(t){return Dt.filter(this,t)}static coalesce(t){return Dt.filter(t,s=>!!s)}coalesce(){return Dt.coalesce(this)}static async toPromise(t){let s=[];for await(let i of t)s.push(i);return s}toPromise(){return Dt.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};Ll.EMPTY=Ll.fromArray([]);var{getWindow:Vt,getWindowId:Zg,onDidRegisterWindow:Qg}=(function(){let e=new Map,t={window:is,disposables:new Cs};e.set(is.vscodeWindowId,t);let s=new W,i=new W,r=new W;function n(o,l){return(typeof o=="number"?e.get(o):void 0)??(l?t:void 0)}return{onDidRegisterWindow:s.event,onWillUnregisterWindow:r.event,onDidUnregisterWindow:i.event,registerWindow(o){if(e.has(o.vscodeWindowId))return he.None;let l=new Cs,a={window:o,disposables:l.add(new Cs)};return e.set(o.vscodeWindowId,a),l.add(De(()=>{e.delete(o.vscodeWindowId),i.fire(o)})),l.add(se(o,Ze.BEFORE_UNLOAD,()=>{r.fire(o)})),s.fire(a),l},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:n,getWindow(o){var h;let l=o;if((h=l==null?void 0:l.ownerDocument)!=null&&h.defaultView)return l.ownerDocument.defaultView.window;let a=o;return a!=null&&a.view?a.view.window:is},getDocument(o){return Vt(o).document}}})(),ev=class{constructor(e,t,s,i){this._node=e,this._type=t,this._handler=s,this._options=i||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function se(e,t,s,i){return new ev(e,t,s,i)}var Il=function(e,t,s,i){return se(e,t,s,i)},Ao,tv=class extends Gg{constructor(e){super(),this.defaultTarget=e&&Vt(e)}cancelAndSet(e,t,s){return super.cancelAndSet(e,t,s??this.defaultTarget)}},Al=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){rr(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,s=new Map,i=new Map,r=n=>{s.set(n,!1);let o=e.get(n)??[];for(t.set(n,o),e.set(n,[]),i.set(n,!0);o.length>0;)o.sort(Al.sort),o.shift().execute();i.set(n,!1)};Ao=(n,o,l=0)=>{let a=Zg(n),h=new Al(o,l),c=e.get(a);return c||(c=[],e.set(a,c)),c.push(h),s.get(a)||(s.set(a,!0),n.requestAnimationFrame(()=>r(a))),h}})();function sv(e){let t=e.getBoundingClientRect(),s=Vt(e);return{left:t.left+s.scrollX,top:t.top+s.scrollY,width:t.width,height:t.height}}var Ze={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},iv=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=St(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=St(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=St(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=St(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=St(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=St(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=St(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=St(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=St(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=St(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=St(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=St(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=St(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=St(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function St(e){return typeof e=="number"?`${e}px`:e}function Ri(e){return new iv(e)}var tc=class{constructor(){this._hooks=new Cs,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let s=this._onStopCallback;this._onStopCallback=null,e&&s&&s(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,s,i,r){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=i,this._onStopCallback=r;let n=e;try{e.setPointerCapture(t),this._hooks.add(De(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{n=Vt(e)}this._hooks.add(se(n,Ze.POINTER_MOVE,o=>{if(o.buttons!==s){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(se(n,Ze.POINTER_UP,o=>this.stopMonitoring(!0)))}};function rv(e,t,s){let i=null,r=null;if(typeof s.value=="function"?(i="value",r=s.value,r.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof s.get=="function"&&(i="get",r=s.get),!r)throw new Error("not supported");let n=`$memoize$${t}`;s[i]=function(...o){return this.hasOwnProperty(n)||Object.defineProperty(this,n,{configurable:!1,enumerable:!1,writable:!1,value:r.apply(this,o)}),this[n]}}var Ft;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(Ft||(Ft={}));var _i=class ot extends he{constructor(){super(),this.dispatched=!1,this.targets=new kl,this.ignoreTargets=new kl,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(nt.runAndSubscribe(Qg,({window:t,disposables:s})=>{s.add(se(t.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),s.add(se(t.document,"touchend",i=>this.onTouchEnd(t,i))),s.add(se(t.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:is,disposables:this._store}))}static addTarget(t){if(!ot.isTouchDevice())return he.None;ot.INSTANCE||(ot.INSTANCE=new ot);let s=ot.INSTANCE.targets.push(t);return De(s)}static ignoreTarget(t){if(!ot.isTouchDevice())return he.None;ot.INSTANCE||(ot.INSTANCE=new ot);let s=ot.INSTANCE.ignoreTargets.push(t);return De(s)}static isTouchDevice(){return"ontouchstart"in is||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let s=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,r=t.targetTouches.length;i<r;i++){let n=t.targetTouches.item(i);this.activeTouches[n.identifier]={id:n.identifier,initialTarget:n.target,initialTimeStamp:s,initialPageX:n.pageX,initialPageY:n.pageY,rollingTimestamps:[s],rollingPageX:[n.pageX],rollingPageY:[n.pageY]};let o=this.newGestureEvent(Ft.Start,n.target);o.pageX=n.pageX,o.pageY=n.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,s){let i=Date.now(),r=Object.keys(this.activeTouches).length;for(let n=0,o=s.changedTouches.length;n<o;n++){let l=s.changedTouches.item(n);if(!this.activeTouches.hasOwnProperty(String(l.identifier))){console.warn("move of an UNKNOWN touch",l);continue}let a=this.activeTouches[l.identifier],h=Date.now()-a.initialTimeStamp;if(h<ot.HOLD_DELAY&&Math.abs(a.initialPageX-yt(a.rollingPageX))<30&&Math.abs(a.initialPageY-yt(a.rollingPageY))<30){let c=this.newGestureEvent(Ft.Tap,a.initialTarget);c.pageX=yt(a.rollingPageX),c.pageY=yt(a.rollingPageY),this.dispatchEvent(c)}else if(h>=ot.HOLD_DELAY&&Math.abs(a.initialPageX-yt(a.rollingPageX))<30&&Math.abs(a.initialPageY-yt(a.rollingPageY))<30){let c=this.newGestureEvent(Ft.Contextmenu,a.initialTarget);c.pageX=yt(a.rollingPageX),c.pageY=yt(a.rollingPageY),this.dispatchEvent(c)}else if(r===1){let c=yt(a.rollingPageX),u=yt(a.rollingPageY),d=yt(a.rollingTimestamps)-a.rollingTimestamps[0],f=c-a.rollingPageX[0],_=u-a.rollingPageY[0],v=[...this.targets].filter(b=>a.initialTarget instanceof Node&&b.contains(a.initialTarget));this.inertia(t,v,i,Math.abs(f)/d,f>0?1:-1,c,Math.abs(_)/d,_>0?1:-1,u)}this.dispatchEvent(this.newGestureEvent(Ft.End,a.initialTarget)),delete this.activeTouches[l.identifier]}this.dispatched&&(s.preventDefault(),s.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,s){let i=document.createEvent("CustomEvent");return i.initEvent(t,!1,!0),i.initialTarget=s,i.tapCount=0,i}dispatchEvent(t){if(t.type===Ft.Tap){let s=new Date().getTime(),i=0;s-this._lastSetTapCountTime>ot.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=s,t.tapCount=i}else(t.type===Ft.Change||t.type===Ft.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let i of this.ignoreTargets)if(i.contains(t.initialTarget))return;let s=[];for(let i of this.targets)if(i.contains(t.initialTarget)){let r=0,n=t.initialTarget;for(;n&&n!==i;)r++,n=n.parentElement;s.push([r,i])}s.sort((i,r)=>i[0]-r[0]);for(let[i,r]of s)r.dispatchEvent(t),this.dispatched=!0}}inertia(t,s,i,r,n,o,l,a,h){this.handle=Ao(t,()=>{let c=Date.now(),u=c-i,d=0,f=0,_=!0;r+=ot.SCROLL_FRICTION*u,l+=ot.SCROLL_FRICTION*u,r>0&&(_=!1,d=n*r*u),l>0&&(_=!1,f=a*l*u);let v=this.newGestureEvent(Ft.Change);v.translationX=d,v.translationY=f,s.forEach(b=>b.dispatchEvent(v)),_||this.inertia(t,s,c,r,n,o+d,l,a,h+f)})}onTouchMove(t){let s=Date.now();for(let i=0,r=t.changedTouches.length;i<r;i++){let n=t.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(n.identifier))){console.warn("end of an UNKNOWN touch",n);continue}let o=this.activeTouches[n.identifier],l=this.newGestureEvent(Ft.Change,o.initialTarget);l.translationX=n.pageX-yt(o.rollingPageX),l.translationY=n.pageY-yt(o.rollingPageY),l.pageX=n.pageX,l.pageY=n.pageY,this.dispatchEvent(l),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(n.pageX),o.rollingPageY.push(n.pageY),o.rollingTimestamps.push(s)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};_i.SCROLL_FRICTION=-.005,_i.HOLD_DELAY=700,_i.CLEAR_TAP_COUNT_TIME=400,Ae([rv],_i,"isTouchDevice",1);var nv=_i,Oo=class extends he{onclick(e,t){this._register(se(e,Ze.CLICK,s=>t(new Yi(Vt(e),s))))}onmousedown(e,t){this._register(se(e,Ze.MOUSE_DOWN,s=>t(new Yi(Vt(e),s))))}onmouseover(e,t){this._register(se(e,Ze.MOUSE_OVER,s=>t(new Yi(Vt(e),s))))}onmouseleave(e,t){this._register(se(e,Ze.MOUSE_LEAVE,s=>t(new Yi(Vt(e),s))))}onkeydown(e,t){this._register(se(e,Ze.KEY_DOWN,s=>t(new Dl(s))))}onkeyup(e,t){this._register(se(e,Ze.KEY_UP,s=>t(new Dl(s))))}oninput(e,t){this._register(se(e,Ze.INPUT,t))}onblur(e,t){this._register(se(e,Ze.BLUR,t))}onfocus(e,t){this._register(se(e,Ze.FOCUS,t))}onchange(e,t){this._register(se(e,Ze.CHANGE,t))}ignoreGesture(e){return nv.ignoreTarget(e)}},Ol=11,ov=class extends Oo{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=Ol+"px",this.domNode.style.height=Ol+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new tc),this._register(Il(this.bgDomNode,Ze.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(Il(this.domNode,Ze.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new tv),this._pointerdownScheduleRepeatTimer=this._register(new Io)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,Vt(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},lv=class Kn{constructor(t,s,i,r,n,o,l){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(s=s|0,i=i|0,r=r|0,n=n|0,o=o|0,l=l|0),this.rawScrollLeft=r,this.rawScrollTop=l,s<0&&(s=0),r+s>i&&(r=i-s),r<0&&(r=0),n<0&&(n=0),l+n>o&&(l=o-n),l<0&&(l=0),this.width=s,this.scrollWidth=i,this.scrollLeft=r,this.height=n,this.scrollHeight=o,this.scrollTop=l}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,s){return new Kn(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,s?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,s?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new Kn(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,s){let i=this.width!==t.width,r=this.scrollWidth!==t.scrollWidth,n=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,l=this.scrollHeight!==t.scrollHeight,a=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:s,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:i,scrollWidthChanged:r,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:l,scrollTopChanged:a}}},av=class extends he{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new lv(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){var i;let s=this._state.withScrollDimensions(e,t);this._setState(s,!!this._smoothScrolling),(i=this._smoothScrolling)==null||i.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let s=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===s.scrollLeft&&this._smoothScrolling.to.scrollTop===s.scrollTop)return;let i;t?i=new $l(this._smoothScrolling.from,s,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,s,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{let s=this._state.withScrollPosition(e);this._smoothScrolling=$l.start(this._state,s,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let s=this._state;s.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(s,t)))}},Nl=class{constructor(e,t,s){this.scrollLeft=e,this.scrollTop=t,this.isDone=s}};function ln(e,t){let s=t-e;return function(i){return e+s*uv(i)}}function hv(e,t,s){return function(i){return i<s?e(i/s):t((i-s)/(1-s))}}var $l=class Un{constructor(t,s,i,r){this.from=t,this.to=s,this.duration=r,this.startTime=i,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,s,i){if(Math.abs(t-s)>2.5*i){let r,n;return t<s?(r=t+.75*i,n=s-.75*i):(r=t-.75*i,n=s+.75*i),hv(ln(t,r),ln(n,s),.33)}return ln(t,s)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let s=(t-this.startTime)/this.duration;if(s<1){let i=this.scrollLeft(s),r=this.scrollTop(s);return new Nl(i,r,!1)}return new Nl(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,s,i){return Un.start(t,s,i)}static start(t,s,i){i=i+10;let r=Date.now()-10;return new Un(t,s,r,i)}};function cv(e){return Math.pow(e,3)}function uv(e){return 1-cv(1-e)}var dv=class extends he{constructor(e,t,s){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=s,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new Io)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{var e;(e=this._domNode)==null||e.setClassName(this._visibleClassName)},0))}_hide(e){var t;this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,(t=this._domNode)==null||t.setClassName(this._invisibleClassName+(e?" fade":"")))}},fv=140,sc=class extends Oo{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new dv(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new tc),this._shouldRender=!0,this.domNode=Ri(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(se(this.domNode.domNode,Ze.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new ov(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,s,i){this.slider=Ri(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof s=="number"&&this.slider.setWidth(s),typeof i=="number"&&this.slider.setHeight(i),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(se(this.slider.domNode,Ze.POINTER_DOWN,r=>{r.button===0&&(r.preventDefault(),this._sliderPointerDown(r))})),this.onclick(this.slider.domNode,r=>{r.leftButton&&r.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,s=t+this._scrollbarState.getSliderPosition(),i=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),r=this._sliderPointerPosition(e);s<=r&&r<=i?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,s;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,s=e.offsetY;else{let r=sv(this.domNode.domNode);t=e.pageX-r.left,s=e.pageY-r.top}let i=this._pointerDownRelativePosition(t,s);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(i):this._scrollbarState.getDesiredScrollPositionFromOffset(i)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),s=this._sliderOrthogonalPointerPosition(e),i=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,r=>{let n=this._sliderOrthogonalPointerPosition(r),o=Math.abs(n-s);if(Jh&&o>fv){this._setDesiredScrollPositionNow(i.getScrollPosition());return}let l=this._sliderPointerPosition(r)-t;this._setDesiredScrollPositionNow(i.getDesiredScrollPositionFromDelta(l))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},ic=class Vn{constructor(t,s,i,r,n,o){this._scrollbarSize=Math.round(s),this._oppositeScrollbarSize=Math.round(i),this._arrowSize=Math.round(t),this._visibleSize=r,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new Vn(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let s=Math.round(t);return this._visibleSize!==s?(this._visibleSize=s,this._refreshComputedValues(),!0):!1}setScrollSize(t){let s=Math.round(t);return this._scrollSize!==s?(this._scrollSize=s,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let s=Math.round(t);return this._scrollPosition!==s?(this._scrollPosition=s,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,s,i,r,n){let o=Math.max(0,i-t),l=Math.max(0,o-2*s),a=r>0&&r>i;if(!a)return{computedAvailableSize:Math.round(o),computedIsNeeded:a,computedSliderSize:Math.round(l),computedSliderRatio:0,computedSliderPosition:0};let h=Math.round(Math.max(20,Math.floor(i*l/r))),c=(l-h)/(r-i),u=n*c;return{computedAvailableSize:Math.round(o),computedIsNeeded:a,computedSliderSize:Math.round(h),computedSliderRatio:c,computedSliderPosition:Math.round(u)}}_refreshComputedValues(){let t=Vn._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let s=t-this._arrowSize-this._computedSliderSize/2;return Math.round(s/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let s=t-this._arrowSize,i=this._scrollPosition;return s<this._computedSliderPosition?i-=this._visibleSize:i+=this._visibleSize,i}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let s=this._computedSliderPosition+t;return Math.round(s/this._computedSliderRatio)}},_v=class extends sc{constructor(e,t,s){let i=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ic(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,i.width,i.scrollWidth,r.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},pv=class extends sc{constructor(e,t,s){let i=e.getScrollDimensions(),r=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:s,scrollbarState:new ic(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,i.height,i.scrollHeight,r.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},gv=500,Hl=50,vv=class{constructor(e,t,s){this.timestamp=e,this.deltaX=t,this.deltaY=s,this.score=0}},jn=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,s=0,i=1,r=this._rear;do{let n=r===this._front?t:Math.pow(2,-i);if(t-=n,s+=this._memory[r].score*n,r===this._front)break;r=(this._capacity+r-1)%this._capacity,i++}while(!0);return s<=.5}acceptStandardWheelEvent(t){if(Po){let s=Vt(t.browserEvent),i=Rg(s);this.accept(Date.now(),t.deltaX*i,t.deltaY*i)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,s,i){let r=null,n=new vv(t,s,i);this._front===-1&&this._rear===-1?(this._memory[0]=n,this._front=0,this._rear=0):(r=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,r)}_computeScore(t,s){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let i=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(i+=.25),s){let r=Math.abs(t.deltaX),n=Math.abs(t.deltaY),o=Math.abs(s.deltaX),l=Math.abs(s.deltaY),a=Math.max(Math.min(r,o),1),h=Math.max(Math.min(n,l),1),c=Math.max(r,o),u=Math.max(n,l);c%a===0&&u%h===0&&(i-=.5)}return Math.min(Math.max(i,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};jn.INSTANCE=new jn;var mv=jn,Sv=class extends Oo{constructor(e,t,s){super(),this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new W),this.onWillScroll=this._onWillScroll.event,this._options=yv(t),this._scrollable=s,this._register(this._scrollable.onScroll(r=>{this._onWillScroll.fire(r),this._onDidScroll(r),this._onScroll.fire(r)}));let i={onMouseWheel:r=>this._onMouseWheel(r),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new pv(this._scrollable,this._options,i)),this._horizontalScrollbar=this._register(new _v(this._scrollable,this._options,i)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Ri(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Ri(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Ri(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,r=>this._onMouseOver(r)),this.onmouseleave(this._listenOnDomNode,r=>this._onMouseLeave(r)),this._hideTimeout=this._register(new Io),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=$s(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,qt&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new Pl(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=$s(this._mouseWheelToDispose),e)){let t=s=>{this._onMouseWheel(new Pl(s))};this._mouseWheelToDispose.push(se(this._listenOnDomNode,Ze.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){var r;if((r=e.browserEvent)!=null&&r.defaultPrevented)return;let t=mv.INSTANCE;t.acceptStandardWheelEvent(e);let s=!1;if(e.deltaY||e.deltaX){let n=e.deltaY*this._options.mouseWheelScrollSensitivity,o=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&o+n===0?o=n=0:Math.abs(n)>=Math.abs(o)?o=0:n=0),this._options.flipAxes&&([n,o]=[o,n]);let l=!qt&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||l)&&!o&&(o=n,n=0),e.browserEvent&&e.browserEvent.altKey&&(o=o*this._options.fastScrollSensitivity,n=n*this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),h={};if(n){let c=Hl*n,u=a.scrollTop-(c<0?Math.floor(c):Math.ceil(c));this._verticalScrollbar.writeScrollPosition(h,u)}if(o){let c=Hl*o,u=a.scrollLeft-(c<0?Math.floor(c):Math.ceil(c));this._horizontalScrollbar.writeScrollPosition(h,u)}h=this._scrollable.validateScrollPosition(h),(a.scrollLeft!==h.scrollLeft||a.scrollTop!==h.scrollTop)&&(this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(h):this._scrollable.setScrollPositionNow(h),s=!0)}let i=s;!i&&this._options.alwaysConsumeMouseWheel&&(i=!0),!i&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(i=!0),i&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,s=e.scrollLeft>0,i=s?" left":"",r=t?" top":"",n=s||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${i}`),this._topShadowDomNode.setClassName(`shadow${r}`),this._topLeftShadowDomNode.setClassName(`shadow${n}${r}${i}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),gv)}},bv=class extends Sv{constructor(e,t,s){super(e,t,s)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function yv(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,qt&&(t.className+=" mac"),t}var qn=class extends he{constructor(e,t,s,i,r,n,o,l){super(),this._bufferService=s,this._optionsService=o,this._renderService=l,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let a=this._register(new av({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:h=>Ao(i.window,h)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{a.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new bv(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},a)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(r.onProtocolChange(h=>{this._scrollableElement.updateOptions({handleMouseWheel:!(h&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(nt.runAndSubscribe(n.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=n.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(De(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=i.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(De(()=>this._styleElement.remove())),this._register(nt.runAndSubscribe(n.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${n.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${n.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${n.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(h=>this._handleScroll(h)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){var e;return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:((e=this._optionsService.rawOptions.overviewRuler)==null?void 0:e.width)||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),s=t-this._bufferService.buffer.ydisp;s!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(s)),this._isHandlingScroll=!1}};qn=Ae([Y(2,pt),Y(3,cs),Y(4,Nh),Y(5,si),Y(6,gt),Y(7,us)],qn);var Yn=class extends he{constructor(e,t,s,i,r){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=s,this._decorationService=i,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this._register(De(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var i;let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",((i=e==null?void 0:e.options)==null?void 0:i.layer)==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let s=e.options.x??0;return s&&s>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let s=this._decorationElements.get(e);s||(s=this._createElement(e),e.element=s,this._decorationElements.set(e,s),this._container.appendChild(s),e.onDispose(()=>{this._decorationElements.delete(e),s.remove()})),s.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(s.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,s.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(s)}}_refreshXPosition(e,t=e.element){if(!t)return;let s=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=s?`${s*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=s?`${s*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){var t;(t=this._decorationElements.get(e))==null||t.remove(),this._decorationElements.delete(e),e.dispose()}};Yn=Ae([Y(1,pt),Y(2,cs),Y(3,Fi),Y(4,us)],Yn);var wv=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,s){return t>=e.startBufferLine-this._linePadding[s||"full"]&&t<=e.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},Ht={full:0,left:0,center:0,right:0},_s={full:0,left:0,center:0,right:0},oi={full:0,left:0,center:0,right:0},br=class extends he{constructor(e,t,s,i,r,n,o,l){var h;super(),this._viewportElement=e,this._screenElement=t,this._bufferService=s,this._decorationService=i,this._renderService=r,this._optionsService=n,this._themeService=o,this._coreBrowserService=l,this._colorZoneStore=new wv,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(h=this._viewportElement.parentElement)==null||h.insertBefore(this._canvas,this._viewportElement),this._register(De(()=>{var c;return(c=this._canvas)==null?void 0:c.remove()}));let a=this._canvas.getContext("2d");if(a)this._ctx=a;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){var e;return((e=this._optionsService.options.overviewRuler)==null?void 0:e.width)||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);_s.full=this._canvas.width,_s.left=e,_s.center=t,_s.right=e,this._refreshDrawHeightConstants(),oi.full=1,oi.left=1,oi.center=1+_s.left,oi.right=1+_s.left+_s.center}_refreshDrawHeightConstants(){Ht.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);Ht.left=t,Ht.center=t,Ht.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Ht.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Ht.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Ht.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*Ht.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(oi[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-Ht[e.position||"full"]/2),_s[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+Ht[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};br=Ae([Y(2,pt),Y(3,Fi),Y(4,us),Y(5,gt),Y(6,si),Y(7,cs)],br);var E;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""))(E||(E={}));var lr;(e=>(e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""))(lr||(lr={}));var rc;(e=>e.ST=`${E.ESC}\\`)(rc||(rc={}));var Xn=class{constructor(e,t,s,i,r,n){this._textarea=e,this._compositionView=t,this._bufferService=s,this._optionsService=i,this._coreService=r,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let s;t.start+=this._dataAlreadySent.length,this._isComposing?s=this._textarea.value.substring(t.start,this._compositionPosition.start):s=this._textarea.value.substring(t.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,s=t.replace(e,"");this._dataAlreadySent=s,t.length>e.length?this._coreService.triggerDataEvent(s,!0):t.length<e.length?this._coreService.triggerDataEvent(`${E.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};Xn=Ae([Y(2,pt),Y(3,gt),Y(4,Ws),Y(5,us)],Xn);var Qe=0,et=0,tt=0,Le=0,Wl={css:"#00000000",rgba:0},Ke;(e=>{function t(r,n,o,l){return l!==void 0?`#${Bs(r)}${Bs(n)}${Bs(o)}${Bs(l)}`:`#${Bs(r)}${Bs(n)}${Bs(o)}`}e.toCss=t;function s(r,n,o,l=255){return(r<<24|n<<16|o<<8|l)>>>0}e.toRgba=s;function i(r,n,o,l){return{css:e.toCss(r,n,o,l),rgba:e.toRgba(r,n,o,l)}}e.toColor=i})(Ke||(Ke={}));var Me;(e=>{function t(a,h){if(Le=(h.rgba&255)/255,Le===1)return{css:h.css,rgba:h.rgba};let c=h.rgba>>24&255,u=h.rgba>>16&255,d=h.rgba>>8&255,f=a.rgba>>24&255,_=a.rgba>>16&255,v=a.rgba>>8&255;Qe=f+Math.round((c-f)*Le),et=_+Math.round((u-_)*Le),tt=v+Math.round((d-v)*Le);let b=Ke.toCss(Qe,et,tt),m=Ke.toRgba(Qe,et,tt);return{css:b,rgba:m}}e.blend=t;function s(a){return(a.rgba&255)===255}e.isOpaque=s;function i(a,h,c){let u=ar.ensureContrastRatio(a.rgba,h.rgba,c);if(u)return Ke.toColor(u>>24&255,u>>16&255,u>>8&255)}e.ensureContrastRatio=i;function r(a){let h=(a.rgba|255)>>>0;return[Qe,et,tt]=ar.toChannels(h),{css:Ke.toCss(Qe,et,tt),rgba:h}}e.opaque=r;function n(a,h){return Le=Math.round(h*255),[Qe,et,tt]=ar.toChannels(a.rgba),{css:Ke.toCss(Qe,et,tt,Le),rgba:Ke.toRgba(Qe,et,tt,Le)}}e.opacity=n;function o(a,h){return Le=a.rgba&255,n(a,Le*h/255)}e.multiplyOpacity=o;function l(a){return[a.rgba>>24&255,a.rgba>>16&255,a.rgba>>8&255]}e.toColorRGB=l})(Me||(Me={}));var Pe;(e=>{let t,s;try{let r=document.createElement("canvas");r.width=1,r.height=1;let n=r.getContext("2d",{willReadFrequently:!0});n&&(t=n,t.globalCompositeOperation="copy",s=t.createLinearGradient(0,0,1,1))}catch{}function i(r){if(r.match(/#[\da-f]{3,8}/i))switch(r.length){case 4:return Qe=parseInt(r.slice(1,2).repeat(2),16),et=parseInt(r.slice(2,3).repeat(2),16),tt=parseInt(r.slice(3,4).repeat(2),16),Ke.toColor(Qe,et,tt);case 5:return Qe=parseInt(r.slice(1,2).repeat(2),16),et=parseInt(r.slice(2,3).repeat(2),16),tt=parseInt(r.slice(3,4).repeat(2),16),Le=parseInt(r.slice(4,5).repeat(2),16),Ke.toColor(Qe,et,tt,Le);case 7:return{css:r,rgba:(parseInt(r.slice(1),16)<<8|255)>>>0};case 9:return{css:r,rgba:parseInt(r.slice(1),16)>>>0}}let n=r.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(n)return Qe=parseInt(n[1]),et=parseInt(n[2]),tt=parseInt(n[3]),Le=Math.round((n[5]===void 0?1:parseFloat(n[5]))*255),Ke.toColor(Qe,et,tt,Le);if(!t||!s)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=s,t.fillStyle=r,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[Qe,et,tt,Le]=t.getImageData(0,0,1,1).data,Le!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:Ke.toRgba(Qe,et,tt,Le),css:r}}e.toColor=i})(Pe||(Pe={}));var dt;(e=>{function t(i){return s(i>>16&255,i>>8&255,i&255)}e.relativeLuminance=t;function s(i,r,n){let o=i/255,l=r/255,a=n/255,h=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),c=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4),u=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4);return h*.2126+c*.7152+u*.0722}e.relativeLuminance2=s})(dt||(dt={}));var ar;(e=>{function t(o,l){if(Le=(l&255)/255,Le===1)return l;let a=l>>24&255,h=l>>16&255,c=l>>8&255,u=o>>24&255,d=o>>16&255,f=o>>8&255;return Qe=u+Math.round((a-u)*Le),et=d+Math.round((h-d)*Le),tt=f+Math.round((c-f)*Le),Ke.toRgba(Qe,et,tt)}e.blend=t;function s(o,l,a){let h=dt.relativeLuminance(o>>8),c=dt.relativeLuminance(l>>8);if(Qt(h,c)<a){if(c<h){let f=i(o,l,a),_=Qt(h,dt.relativeLuminance(f>>8));if(_<a){let v=r(o,l,a),b=Qt(h,dt.relativeLuminance(v>>8));return _>b?f:v}return f}let u=r(o,l,a),d=Qt(h,dt.relativeLuminance(u>>8));if(d<a){let f=i(o,l,a),_=Qt(h,dt.relativeLuminance(f>>8));return d>_?u:f}return u}}e.ensureContrastRatio=s;function i(o,l,a){let h=o>>24&255,c=o>>16&255,u=o>>8&255,d=l>>24&255,f=l>>16&255,_=l>>8&255,v=Qt(dt.relativeLuminance2(d,f,_),dt.relativeLuminance2(h,c,u));for(;v<a&&(d>0||f>0||_>0);)d-=Math.max(0,Math.ceil(d*.1)),f-=Math.max(0,Math.ceil(f*.1)),_-=Math.max(0,Math.ceil(_*.1)),v=Qt(dt.relativeLuminance2(d,f,_),dt.relativeLuminance2(h,c,u));return(d<<24|f<<16|_<<8|255)>>>0}e.reduceLuminance=i;function r(o,l,a){let h=o>>24&255,c=o>>16&255,u=o>>8&255,d=l>>24&255,f=l>>16&255,_=l>>8&255,v=Qt(dt.relativeLuminance2(d,f,_),dt.relativeLuminance2(h,c,u));for(;v<a&&(d<255||f<255||_<255);)d=Math.min(255,d+Math.ceil((255-d)*.1)),f=Math.min(255,f+Math.ceil((255-f)*.1)),_=Math.min(255,_+Math.ceil((255-_)*.1)),v=Qt(dt.relativeLuminance2(d,f,_),dt.relativeLuminance2(h,c,u));return(d<<24|f<<16|_<<8|255)>>>0}e.increaseLuminance=r;function n(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=n})(ar||(ar={}));function Bs(e){let t=e.toString(16);return t.length<2?"0"+t:t}function Qt(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var Cv=class extends Wi{constructor(e,t,s){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},yr=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new Pt}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let s=[],i=t.translateToString(!0),r=0,n=0,o=0,l=t.getFg(0),a=t.getBg(0);for(let h=0;h<t.getTrimmedLength();h++)if(t.loadCell(h,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==l||this._workCell.bg!==a){if(h-r>1){let c=this._getJoinedRanges(i,o,n,t,r);for(let u=0;u<c.length;u++)s.push(c[u])}r=h,o=n,l=this._workCell.fg,a=this._workCell.bg}n+=this._workCell.getChars().length||ys.length}if(this._bufferService.cols-r>1){let h=this._getJoinedRanges(i,o,n,t,r);for(let c=0;c<h.length;c++)s.push(h[c])}return s}_getJoinedRanges(e,t,s,i,r){let n=e.substring(t,s),o=[];try{o=this._characterJoiners[0].handler(n)}catch(l){console.error(l)}for(let l=1;l<this._characterJoiners.length;l++)try{let a=this._characterJoiners[l].handler(n);for(let h=0;h<a.length;h++)yr._mergeRanges(o,a[h])}catch(a){console.error(a)}return this._stringRangesToCellRanges(o,i,r),o}_stringRangesToCellRanges(e,t,s){let i=0,r=!1,n=0,o=e[i];if(o){for(let l=s;l<this._bufferService.cols;l++){let a=t.getWidth(l),h=t.getString(l).length||ys.length;if(a!==0){if(!r&&o[0]<=n&&(o[0]=l,r=!0),o[1]<=n){if(o[1]=l,o=e[++i],!o)break;o[0]<=n?(o[0]=l,r=!0):r=!1}n+=h}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let s=!1;for(let i=0;i<e.length;i++){let r=e[i];if(s){if(t[1]<=r[0])return e[i-1][1]=t[1],e;if(t[1]<=r[1])return e[i-1][1]=Math.max(t[1],r[1]),e.splice(i,1),e;e.splice(i,1),i--}else{if(t[1]<=r[0])return e.splice(i,0,t),e;if(t[1]<=r[1])return r[0]=Math.min(t[0],r[0]),e;t[0]<r[1]&&(r[0]=Math.min(t[0],r[0]),s=!0);continue}}return s?e[e.length-1][1]=t[1]:e.push(t),e}};yr=Ae([Y(0,pt)],yr);function xv(e){return 57508<=e&&e<=57558}function kv(e){return 9472<=e&&e<=9631}function Ev(e){return xv(e)||kv(e)}function Mv(){return{css:{canvas:Xi(),cell:Xi()},device:{canvas:Xi(),cell:Xi(),char:{width:0,height:0,left:0,top:0}}}}function Xi(){return{width:0,height:0}}var Gn=class{constructor(e,t,s,i,r,n,o){this._document=e,this._characterJoinerService=t,this._optionsService=s,this._coreBrowserService=i,this._coreService=r,this._decorationService=n,this._themeService=o,this._workCell=new Pt,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,s){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=s}createRow(e,t,s,i,r,n,o,l,a,h,c){let u=[],d=this._characterJoinerService.getJoinedCharacters(t),f=this._themeService.colors,_=e.getNoBgTrimmedLength();s&&_<n+1&&(_=n+1);let v,b=0,m="",y=0,k=0,C=0,N=0,X=!1,ne=0,G=!1,Q=0,pe=0,oe=[],$=h!==-1&&c!==-1;for(let M=0;M<_;M++){e.loadCell(M,this._workCell);let A=this._workCell.getWidth();if(A===0)continue;let U=!1,H=M>=pe,F=M,P=this._workCell;if(d.length>0&&M===d[0][0]&&H){let S=d.shift(),x=this._isCellInSelection(S[0],t);for(y=S[0]+1;y<S[1];y++)H&&(H=x===this._isCellInSelection(y,t));H&&(H=!s||n<S[0]||n>=S[1]),H?(U=!0,P=new Cv(this._workCell,e.translateToString(!0,S[0],S[1]),S[1]-S[0]),F=S[1]-1,A=P.getWidth()):pe=S[1]}let de=this._isCellInSelection(M,t),Be=s&&M===n,We=$&&M>=h&&M<=c,Oe=!1;this._decorationService.forEachDecorationAtCell(M,t,void 0,S=>{Oe=!0});let it=P.getChars()||ys;if(it===" "&&(P.isUnderline()||P.isOverline())&&(it=""),Q=A*l-a.get(it,P.isBold(),P.isItalic()),!v)v=this._document.createElement("span");else if(b&&(de&&G||!de&&!G&&P.bg===k)&&(de&&G&&f.selectionForeground||P.fg===C)&&P.extended.ext===N&&We===X&&Q===ne&&!Be&&!U&&!Oe&&H){P.isInvisible()?m+=ys:m+=it,b++;continue}else b&&(v.textContent=m),v=this._document.createElement("span"),b=0,m="";if(k=P.bg,C=P.fg,N=P.extended.ext,X=We,ne=Q,G=de,U&&n>=M&&n<=F&&(n=M),!this._coreService.isCursorHidden&&Be&&this._coreService.isCursorInitialized){if(oe.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&oe.push("xterm-cursor-blink"),oe.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(r)switch(r){case"outline":oe.push("xterm-cursor-outline");break;case"block":oe.push("xterm-cursor-block");break;case"bar":oe.push("xterm-cursor-bar");break;case"underline":oe.push("xterm-cursor-underline");break}}if(P.isBold()&&oe.push("xterm-bold"),P.isItalic()&&oe.push("xterm-italic"),P.isDim()&&oe.push("xterm-dim"),P.isInvisible()?m=ys:m=P.getChars()||ys,P.isUnderline()&&(oe.push(`xterm-underline-${P.extended.underlineStyle}`),m===" "&&(m=""),!P.isUnderlineColorDefault()))if(P.isUnderlineColorRGB())v.style.textDecorationColor=`rgb(${Wi.toColorRGB(P.getUnderlineColor()).join(",")})`;else{let S=P.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&P.isBold()&&S<8&&(S+=8),v.style.textDecorationColor=f.ansi[S].css}P.isOverline()&&(oe.push("xterm-overline"),m===" "&&(m="")),P.isStrikethrough()&&oe.push("xterm-strikethrough"),We&&(v.style.textDecoration="underline");let Xe=P.getFgColor(),vt=P.getFgColorMode(),Fe=P.getBgColor(),mt=P.getBgColorMode(),Jt=!!P.isInverse();if(Jt){let S=Xe;Xe=Fe,Fe=S;let x=vt;vt=mt,mt=x}let bt,Rt,ds=!1;this._decorationService.forEachDecorationAtCell(M,t,void 0,S=>{S.options.layer!=="top"&&ds||(S.backgroundColorRGB&&(mt=50331648,Fe=S.backgroundColorRGB.rgba>>8&16777215,bt=S.backgroundColorRGB),S.foregroundColorRGB&&(vt=50331648,Xe=S.foregroundColorRGB.rgba>>8&16777215,Rt=S.foregroundColorRGB),ds=S.options.layer==="top")}),!ds&&de&&(bt=this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque,Fe=bt.rgba>>8&16777215,mt=50331648,ds=!0,f.selectionForeground&&(vt=50331648,Xe=f.selectionForeground.rgba>>8&16777215,Rt=f.selectionForeground)),ds&&oe.push("xterm-decoration-top");let g;switch(mt){case 16777216:case 33554432:g=f.ansi[Fe],oe.push(`xterm-bg-${Fe}`);break;case 50331648:g=Ke.toColor(Fe>>16,Fe>>8&255,Fe&255),this._addStyle(v,`background-color:#${Fl((Fe>>>0).toString(16),"0",6)}`);break;case 0:default:Jt?(g=f.foreground,oe.push("xterm-bg-257")):g=f.background}switch(bt||P.isDim()&&(bt=Me.multiplyOpacity(g,.5)),vt){case 16777216:case 33554432:P.isBold()&&Xe<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(Xe+=8),this._applyMinimumContrast(v,g,f.ansi[Xe],P,bt,void 0)||oe.push(`xterm-fg-${Xe}`);break;case 50331648:let S=Ke.toColor(Xe>>16&255,Xe>>8&255,Xe&255);this._applyMinimumContrast(v,g,S,P,bt,Rt)||this._addStyle(v,`color:#${Fl(Xe.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(v,g,f.foreground,P,bt,Rt)||Jt&&oe.push("xterm-fg-257")}oe.length&&(v.className=oe.join(" "),oe.length=0),!Be&&!U&&!Oe&&H?b++:v.textContent=m,Q!==this.defaultSpacing&&(v.style.letterSpacing=`${Q}px`),u.push(v),M=F}return v&&b&&(v.textContent=m),u}_applyMinimumContrast(e,t,s,i,r,n){if(this._optionsService.rawOptions.minimumContrastRatio===1||Ev(i.getCode()))return!1;let o=this._getContrastCache(i),l;if(!r&&!n&&(l=o.getColor(t.rgba,s.rgba)),l===void 0){let a=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);l=Me.ensureContrastRatio(r||t,n||s,a),o.setColor((r||t).rgba,(n||s).rgba,l??null)}return l?(this._addStyle(e,`color:${l.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let s=this._selectionStart,i=this._selectionEnd;return!s||!i?!1:this._columnSelectMode?s[0]<=i[0]?e>=s[0]&&t>=s[1]&&e<i[0]&&t<=i[1]:e<s[0]&&t>=s[1]&&e>=i[0]&&t<=i[1]:t>s[1]&&t<i[1]||s[1]===i[1]&&t===s[1]&&e>=s[0]&&e<i[0]||s[1]<i[1]&&t===i[1]&&e<i[0]||s[1]<i[1]&&t===s[1]&&e>=s[0]}};Gn=Ae([Y(1,Wh),Y(2,gt),Y(3,cs),Y(4,Ws),Y(5,Fi),Y(6,si)],Gn);function Fl(e,t,s){for(;e.length<s;)e=t+e;return e}var Rv=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let s=e.createElement("span");s.classList.add("xterm-char-measure-element");let i=e.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontWeight="bold";let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontStyle="italic";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold",n.style.fontStyle="italic",this._measureElements=[s,i,r,n],this._container.appendChild(s),this._container.appendChild(i),this._container.appendChild(r),this._container.appendChild(n),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,s,i){e===this._font&&t===this._fontSize&&s===this._weight&&i===this._weightBold||(this._font=e,this._fontSize=t,this._weight=s,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${s}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${s}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(e,t,s){let i=0;if(!t&&!s&&e.length===1&&(i=e.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];let o=this._measure(e,0);return o>0&&(this._flat[i]=o),o}let r=e;t&&(r+="B"),s&&(r+="I");let n=this._holey.get(r);if(n===void 0){let o=0;t&&(o|=1),s&&(o|=2),n=this._measure(e,o),n>0&&this._holey.set(r,n)}return n}_measure(e,t){let s=this._measureElements[t];return s.textContent=e.repeat(32),s.offsetWidth/32}},Bv=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,s,i=!1){if(this.selectionStart=t,this.selectionEnd=s,!t||!s||t[0]===s[0]&&t[1]===s[1]){this.clear();return}let r=e.buffers.active.ydisp,n=t[1]-r,o=s[1]-r,l=Math.max(n,0),a=Math.min(o,e.rows-1);if(l>=e.rows||a<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=i,this.viewportStartRow=n,this.viewportEndRow=o,this.viewportCappedStartRow=l,this.viewportCappedEndRow=a,this.startCol=t[0],this.endCol=s[0]}isCellSelected(e,t,s){return this.hasSelection?(s-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&s>=this.viewportCappedStartRow&&t<this.endCol&&s<=this.viewportCappedEndRow:t<this.startCol&&s>=this.viewportCappedStartRow&&t>=this.endCol&&s<=this.viewportCappedEndRow:s>this.viewportStartRow&&s<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&s===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportStartRow&&t>=this.startCol):!1}};function Dv(){return new Bv}var an="xterm-dom-renderer-owner-",Bt="xterm-rows",Gi="xterm-fg-",zl="xterm-bg-",li="xterm-focus",Ji="xterm-selection",Tv=1,Jn=class extends he{constructor(e,t,s,i,r,n,o,l,a,h,c,u,d,f){super(),this._terminal=e,this._document=t,this._element=s,this._screenElement=i,this._viewportElement=r,this._helperContainer=n,this._linkifier2=o,this._charSizeService=a,this._optionsService=h,this._bufferService=c,this._coreService=u,this._coreBrowserService=d,this._themeService=f,this._terminalClass=Tv++,this._rowElements=[],this._selectionRenderModel=Dv(),this.onRequestRedraw=this._register(new W).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(Bt),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(Ji),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Mv(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(_=>this._injectCss(_))),this._injectCss(this._themeService.colors),this._rowFactory=l.createInstance(Gn,document),this._element.classList.add(an+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(_=>this._handleLinkHover(_))),this._register(this._linkifier2.onHideLinkUnderline(_=>this._handleLinkLeave(_))),this._register(De(()=>{this._element.classList.remove(an+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Rv(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let s of this._rowElements)s.style.width=`${this.dimensions.css.canvas.width}px`,s.style.height=`${this.dimensions.css.cell.height}px`,s.style.lineHeight=`${this.dimensions.css.cell.height}px`,s.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${Bt} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${Bt} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${Bt} .xterm-dim { color: ${Me.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let s=`blink_underline_${this._terminalClass}`,i=`blink_bar_${this._terminalClass}`,r=`blink_block_${this._terminalClass}`;t+=`@keyframes ${s} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${i} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${r} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${Bt}.${li} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${Bt}.${li} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${Bt}.${li} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${Bt} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${Bt} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${Bt} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${Bt} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${Bt} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${Ji} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Ji} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Ji} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[n,o]of e.ansi.entries())t+=`${this._terminalSelector} .${Gi}${n} { color: ${o.css}; }${this._terminalSelector} .${Gi}${n}.xterm-dim { color: ${Me.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${zl}${n} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${Gi}257 { color: ${Me.opaque(e.background).css}; }${this._terminalSelector} .${Gi}257.xterm-dim { color: ${Me.multiplyOpacity(Me.opaque(e.background),.5).css}; }${this._terminalSelector} .${zl}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let s=this._rowElements.length;s<=t;s++){let i=this._document.createElement("div");this._rowContainer.appendChild(i),this._rowElements.push(i)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(li),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(li),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,s){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,s),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,s),!this._selectionRenderModel.hasSelection))return;let i=this._selectionRenderModel.viewportStartRow,r=this._selectionRenderModel.viewportEndRow,n=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,l=this._document.createDocumentFragment();if(s){let a=e[0]>t[0];l.appendChild(this._createSelectionElement(n,a?t[0]:e[0],a?e[0]:t[0],o-n+1))}else{let a=i===n?e[0]:0,h=n===r?t[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(n,a,h));let c=o-n-1;if(l.appendChild(this._createSelectionElement(n+1,0,this._bufferService.cols,c)),n!==o){let u=r===o?t[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(o,0,u))}}this._selectionContainer.appendChild(l)}_createSelectionElement(e,t,s,i=1){let r=this._document.createElement("div"),n=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(s-t);return n+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-n),r.style.height=`${i*this.dimensions.css.cell.height}px`,r.style.top=`${e*this.dimensions.css.cell.height}px`,r.style.left=`${n}px`,r.style.width=`${o}px`,r}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let s=this._bufferService.buffer,i=s.ybase+s.y,r=Math.min(s.x,this._bufferService.cols-1),n=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,l=this._optionsService.rawOptions.cursorInactiveStyle;for(let a=e;a<=t;a++){let h=a+s.ydisp,c=this._rowElements[a],u=s.lines.get(h);if(!c||!u)break;c.replaceChildren(...this._rowFactory.createRow(u,h,h===i,o,l,r,n,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${an}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,s,i,r,n){s<0&&(e=0),i<0&&(t=0);let o=this._bufferService.rows-1;s=Math.max(Math.min(s,o),0),i=Math.max(Math.min(i,o),0),r=Math.min(r,this._bufferService.cols);let l=this._bufferService.buffer,a=l.ybase+l.y,h=Math.min(l.x,r-1),c=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,d=this._optionsService.rawOptions.cursorInactiveStyle;for(let f=s;f<=i;++f){let _=f+l.ydisp,v=this._rowElements[f],b=l.lines.get(_);if(!v||!b)break;v.replaceChildren(...this._rowFactory.createRow(b,_,_===a,u,d,h,c,this.dimensions.css.cell.width,this._widthCache,n?f===s?e:0:-1,n?(f===i?t:r)-1:-1))}}};Jn=Ae([Y(7,Bo),Y(8,zr),Y(9,gt),Y(10,pt),Y(11,Ws),Y(12,cs),Y(13,si)],Jn);var Zn=class extends he{constructor(e,t,s){super(),this._optionsService=s,this.width=0,this.height=0,this._onCharSizeChange=this._register(new W),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new Lv(this._optionsService))}catch{this._measureStrategy=this._register(new Pv(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};Zn=Ae([Y(2,gt)],Zn);var nc=class extends he{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},Pv=class extends nc{constructor(e,t,s){super(),this._document=e,this._parentElement=t,this._optionsService=s,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},Lv=class extends nc{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},Iv=class extends he{constructor(e,t,s){super(),this._textarea=e,this._window=t,this.mainDocument=s,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new Av(this._window)),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new W),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(i=>this._screenDprMonitor.setWindow(i))),this._register(nt.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(se(this._textarea,"focus",()=>this._isFocused=!0)),this._register(se(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},Av=class extends he{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new ti),this._onDprChange=this._register(new W),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(De(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=se(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var e;this._outerListener&&((e=this._resolutionMediaMatchList)==null||e.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},Ov=class extends he{constructor(){super(),this.linkProviders=[],this._register(De(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function No(e,t,s){let i=s.getBoundingClientRect(),r=e.getComputedStyle(s),n=parseInt(r.getPropertyValue("padding-left")),o=parseInt(r.getPropertyValue("padding-top"));return[t.clientX-i.left-n,t.clientY-i.top-o]}function Nv(e,t,s,i,r,n,o,l,a){if(!n)return;let h=No(e,t,s);if(h)return h[0]=Math.ceil((h[0]+(a?o/2:0))/o),h[1]=Math.ceil(h[1]/l),h[0]=Math.min(Math.max(h[0],1),i+(a?1:0)),h[1]=Math.min(Math.max(h[1],1),r),h}var Qn=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,s,i,r){return Nv(window,e,t,s,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,r)}getMouseReportCoords(e,t){let s=No(window,e,t);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};Qn=Ae([Y(0,us),Y(1,zr)],Qn);var $v=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,s){this._rowCount=s,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},oc={};Yp(oc,{getSafariVersion:()=>Wv,isChromeOS:()=>cc,isFirefox:()=>lc,isIpad:()=>Fv,isIphone:()=>zv,isLegacyEdge:()=>Hv,isLinux:()=>$o,isMac:()=>wr,isNode:()=>Kr,isSafari:()=>ac,isWindows:()=>hc});var Kr=typeof process<"u"&&"title"in process,zi=Kr?"node":navigator.userAgent,Ki=Kr?"node":navigator.platform,lc=zi.includes("Firefox"),Hv=zi.includes("Edge"),ac=/^((?!chrome|android).)*safari/i.test(zi);function Wv(){if(!ac)return 0;let e=zi.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var wr=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Ki),Fv=Ki==="iPad",zv=Ki==="iPhone",hc=["Windows","Win16","Win32","WinCE"].includes(Ki),$o=Ki.indexOf("Linux")>=0,cc=/\bCrOS\b/.test(zi),uc=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,s=0,i=e.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),s=Math.max(t,s),r=e.timeRemaining(),s*1.5>r){i-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-t))}ms`),this._start();return}i=r}this.clear()}},Kv=class extends uc{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},Uv=class extends uc{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},Cr=!Kr&&"requestIdleCallback"in window?Uv:Kv,Vv=class{constructor(){this._queue=new Cr}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},eo=class extends he{constructor(e,t,s,i,r,n,o,l,a){super(),this._rowCount=e,this._optionsService=s,this._charSizeService=i,this._coreService=r,this._coreBrowserService=l,this._renderer=this._register(new ti),this._pausedResizeTask=new Vv,this._observerDisposable=this._register(new ti),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new W),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new W),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new W),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new $v((h,c)=>this._renderRows(h,c),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new jv(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(De(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>{var h;return(h=this._renderer.value)==null?void 0:h.clear()})),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(n.onDecorationRegistered(()=>this._fullRefresh())),this._register(n.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(a.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(h=>this._registerIntersectionObserver(h,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let s=new e.IntersectionObserver(i=>this._handleIntersectionChange(i[i.length-1]),{threshold:0});s.observe(t),this._observerDisposable.value=De(()=>s.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,s=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let i=this._syncOutputHandler.flush();i&&(e=Math.min(e,i.start),t=Math.max(t,i.end)),s||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&((t=(e=this._renderer.value).clearTextureAtlas)==null||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var s;return(s=this._renderer.value)==null?void 0:s.handleResize(e,t)}):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,t,s){var i;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=s,(i=this._renderer.value)==null||i.handleSelectionChanged(e,t,s)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};eo=Ae([Y(2,gt),Y(3,zr),Y(4,Ws),Y(5,Fi),Y(6,pt),Y(7,cs),Y(8,si)],eo);var jv=class{constructor(e,t,s){this._coreBrowserService=e,this._coreService=t,this._onTimeout=s,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function qv(e,t,s,i){let r=s.buffer.x,n=s.buffer.y;if(!s.buffer.hasScrollback)return Gv(r,n,e,t,s,i)+Ur(n,t,s,i)+Jv(r,n,e,t,s,i);let o;if(n===t)return o=r>e?"D":"C",Ai(Math.abs(r-e),Ii(o,i));o=n>t?"D":"C";let l=Math.abs(n-t),a=Xv(n>t?e:r,s)+(l-1)*s.cols+1+Yv(n>t?r:e);return Ai(a,Ii(o,i))}function Yv(e,t){return e-1}function Xv(e,t){return t.cols-e}function Gv(e,t,s,i,r,n){return Ur(t,i,r,n).length===0?"":Ai(fc(e,t,e,t-Hs(t,r),!1,r).length,Ii("D",n))}function Ur(e,t,s,i){let r=e-Hs(e,s),n=t-Hs(t,s),o=Math.abs(r-n)-Zv(e,t,s);return Ai(o,Ii(dc(e,t),i))}function Jv(e,t,s,i,r,n){let o;Ur(t,i,r,n).length>0?o=i-Hs(i,r):o=t;let l=i,a=Qv(e,t,s,i,r,n);return Ai(fc(e,o,s,l,a==="C",r).length,Ii(a,n))}function Zv(e,t,s){var o;let i=0,r=e-Hs(e,s),n=t-Hs(t,s);for(let l=0;l<Math.abs(r-n);l++){let a=dc(e,t)==="A"?-1:1;(o=s.buffer.lines.get(r+a*l))!=null&&o.isWrapped&&i++}return i}function Hs(e,t){let s=0,i=t.buffer.lines.get(e),r=i==null?void 0:i.isWrapped;for(;r&&e>=0&&e<t.rows;)s++,i=t.buffer.lines.get(--e),r=i==null?void 0:i.isWrapped;return s}function Qv(e,t,s,i,r,n){let o;return Ur(s,i,r,n).length>0?o=i-Hs(i,r):o=t,e<s&&o<=i||e>=s&&o<i?"C":"D"}function dc(e,t){return e>t?"A":"B"}function fc(e,t,s,i,r,n){let o=e,l=t,a="";for(;(o!==s||l!==i)&&l>=0&&l<n.buffer.lines.length;)o+=r?1:-1,r&&o>n.cols-1?(a+=n.buffer.translateBufferLineToString(l,!1,e,o),o=0,e=0,l++):!r&&o<0&&(a+=n.buffer.translateBufferLineToString(l,!1,0,e+1),o=n.cols-1,e=o,l--);return a+n.buffer.translateBufferLineToString(l,!1,e,o)}function Ii(e,t){let s=t?"O":"[";return E.ESC+s+e}function Ai(e,t){e=Math.floor(e);let s="";for(let i=0;i<e;i++)s+=t;return s}var em=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function Kl(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var hn=50,tm=15,sm=50,im=500,rm="",nm=new RegExp(rm,"g"),to=class extends he{constructor(e,t,s,i,r,n,o,l,a){super(),this._element=e,this._screenElement=t,this._linkifier=s,this._bufferService=i,this._coreService=r,this._mouseService=n,this._optionsService=o,this._renderService=l,this._coreBrowserService=a,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new Pt,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new W),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new W),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new W),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=h=>this._handleMouseMove(h),this._mouseUpListener=h=>this._handleMouseUp(h),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(h=>this._handleTrim(h)),this._register(this._bufferService.buffers.onBufferActivate(h=>this._handleBufferActivate(h))),this.enable(),this._model=new em(this._bufferService),this._activeSelectionMode=0,this._register(De(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(h=>{h.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let s=this._bufferService.buffer,i=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let r=e[0]<t[0]?e[0]:t[0],n=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let l=s.translateBufferLineToString(o,!0,r,n);i.push(l)}}else{let r=e[1]===t[1]?t[0]:void 0;i.push(s.translateBufferLineToString(e[1],!0,e[0],r));for(let n=e[1]+1;n<=t[1]-1;n++){let o=s.lines.get(n),l=s.translateBufferLineToString(n,!0);o!=null&&o.isWrapped?i[i.length-1]+=l:i.push(l)}if(e[1]!==t[1]){let n=s.lines.get(t[1]),o=s.translateBufferLineToString(t[1],!0,0,t[0]);n&&n.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(r=>r.replace(nm," ")).join(hc?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),$o&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i||!t?!1:this._areCoordsInSelection(t,s,i)}isCellInSelection(e,t){let s=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!s||!i?!1:this._areCoordsInSelection([e,t],s,i)}_areCoordsInSelection(e,t,s){return e[1]>t[1]&&e[1]<s[1]||t[1]===s[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<s[0]||t[1]<s[1]&&e[1]===s[1]&&e[0]<s[0]||t[1]<s[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){var r,n;let s=(n=(r=this._linkifier.currentLink)==null?void 0:r.link)==null?void 0:n.range;if(s)return this._model.selectionStart=[s.start.x-1,s.start.y-1],this._model.selectionStartLength=Kl(s,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let i=this._getMouseBufferCoords(e);return i?(this._selectWordAt(i,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=No(this._coreBrowserService.window,e,this._screenElement)[1],s=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=s?0:(t>s&&(t-=s),t=Math.min(Math.max(t,-hn),hn),t/=hn,t/Math.abs(t)+Math.round(t*(tm-1)))}shouldForceSelection(e){return wr?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),sm)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!(wr&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let s=this._bufferService.buffer;if(this._model.selectionEnd[1]<s.lines.length){let i=s.lines.get(this._model.selectionEnd[1]);i&&i.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<im&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let s=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(s&&s[0]!==void 0&&s[1]!==void 0){let i=qv(s[0]-1,s[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,s=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!s){this._oldHasSelection&&this._fireOnSelectionChange(e,t,s);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,s)}_fireOnSelectionChange(e,t,s){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=s,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let s=t;for(let i=0;t>=i;i++){let r=e.loadCell(i,this._workCell).getChars().length;this._workCell.getWidth()===0?s--:r>1&&t!==i&&(s+=r-1)}return s}setSelection(e,t,s){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=s,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,s=!0,i=!0){if(e[0]>=this._bufferService.cols)return;let r=this._bufferService.buffer,n=r.lines.get(e[1]);if(!n)return;let o=r.translateBufferLineToString(e[1],!1),l=this._convertViewportColToCharacterIndex(n,e[0]),a=l,h=e[0]-l,c=0,u=0,d=0,f=0;if(o.charAt(l)===" "){for(;l>0&&o.charAt(l-1)===" ";)l--;for(;a<o.length&&o.charAt(a+1)===" ";)a++}else{let b=e[0],m=e[0];n.getWidth(b)===0&&(c++,b--),n.getWidth(m)===2&&(u++,m++);let y=n.getString(m).length;for(y>1&&(f+=y-1,a+=y-1);b>0&&l>0&&!this._isCharWordSeparator(n.loadCell(b-1,this._workCell));){n.loadCell(b-1,this._workCell);let k=this._workCell.getChars().length;this._workCell.getWidth()===0?(c++,b--):k>1&&(d+=k-1,l-=k-1),l--,b--}for(;m<n.length&&a+1<o.length&&!this._isCharWordSeparator(n.loadCell(m+1,this._workCell));){n.loadCell(m+1,this._workCell);let k=this._workCell.getChars().length;this._workCell.getWidth()===2?(u++,m++):k>1&&(f+=k-1,a+=k-1),a++,m++}}a++;let _=l+h-c+d,v=Math.min(this._bufferService.cols,a-l+c+u-d-f);if(!(!t&&o.slice(l,a).trim()==="")){if(s&&_===0&&n.getCodePoint(0)!==32){let b=r.lines.get(e[1]-1);if(b&&n.isWrapped&&b.getCodePoint(this._bufferService.cols-1)!==32){let m=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(m){let y=this._bufferService.cols-m.start;_-=y,v+=y}}}if(i&&_+v===this._bufferService.cols&&n.getCodePoint(this._bufferService.cols-1)!==32){let b=r.lines.get(e[1]+1);if(b!=null&&b.isWrapped&&b.getCodePoint(0)!==32){let m=this._getWordAt([0,e[1]+1],!1,!1,!0);m&&(v+=m.length)}}return{start:_,length:v}}}_selectWordAt(e,t){let s=this._getWordAt(e,t);if(s){for(;s.start<0;)s.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[s.start,e[1]],this._model.selectionStartLength=s.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let s=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,s--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,s++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,s]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),s={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=Kl(s,this._bufferService.cols)}};to=Ae([Y(3,pt),Y(4,Ws),Y(5,Do),Y(6,gt),Y(7,us),Y(8,cs)],to);var Ul=class{constructor(){this._data={}}set(e,t,s){this._data[e]||(this._data[e]={}),this._data[e][t]=s}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},Vl=class{constructor(){this._color=new Ul,this._css=new Ul}setCss(e,t,s){this._css.set(e,t,s)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,s){this._color.set(e,t,s)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},je=Object.freeze((()=>{let e=[Pe.toColor("#2e3436"),Pe.toColor("#cc0000"),Pe.toColor("#4e9a06"),Pe.toColor("#c4a000"),Pe.toColor("#3465a4"),Pe.toColor("#75507b"),Pe.toColor("#06989a"),Pe.toColor("#d3d7cf"),Pe.toColor("#555753"),Pe.toColor("#ef2929"),Pe.toColor("#8ae234"),Pe.toColor("#fce94f"),Pe.toColor("#729fcf"),Pe.toColor("#ad7fa8"),Pe.toColor("#34e2e2"),Pe.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let s=0;s<216;s++){let i=t[s/36%6|0],r=t[s/6%6|0],n=t[s%6];e.push({css:Ke.toCss(i,r,n),rgba:Ke.toRgba(i,r,n)})}for(let s=0;s<24;s++){let i=8+s*10;e.push({css:Ke.toCss(i,i,i),rgba:Ke.toRgba(i,i,i)})}return e})()),Ts=Pe.toColor("#ffffff"),pi=Pe.toColor("#000000"),jl=Pe.toColor("#ffffff"),ql=pi,ai={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},om=Ts,so=class extends he{constructor(e){super(),this._optionsService=e,this._contrastCache=new Vl,this._halfContrastCache=new Vl,this._onChangeColors=this._register(new W),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:Ts,background:pi,cursor:jl,cursorAccent:ql,selectionForeground:void 0,selectionBackgroundTransparent:ai,selectionBackgroundOpaque:Me.blend(pi,ai),selectionInactiveBackgroundTransparent:ai,selectionInactiveBackgroundOpaque:Me.blend(pi,ai),scrollbarSliderBackground:Me.opacity(Ts,.2),scrollbarSliderHoverBackground:Me.opacity(Ts,.4),scrollbarSliderActiveBackground:Me.opacity(Ts,.5),overviewRulerBorder:Ts,ansi:je.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=xe(e.foreground,Ts),t.background=xe(e.background,pi),t.cursor=Me.blend(t.background,xe(e.cursor,jl)),t.cursorAccent=Me.blend(t.background,xe(e.cursorAccent,ql)),t.selectionBackgroundTransparent=xe(e.selectionBackground,ai),t.selectionBackgroundOpaque=Me.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=xe(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=Me.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?xe(e.selectionForeground,Wl):void 0,t.selectionForeground===Wl&&(t.selectionForeground=void 0),Me.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=Me.opacity(t.selectionBackgroundTransparent,.3)),Me.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=Me.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=xe(e.scrollbarSliderBackground,Me.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=xe(e.scrollbarSliderHoverBackground,Me.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=xe(e.scrollbarSliderActiveBackground,Me.opacity(t.foreground,.5)),t.overviewRulerBorder=xe(e.overviewRulerBorder,om),t.ansi=je.slice(),t.ansi[0]=xe(e.black,je[0]),t.ansi[1]=xe(e.red,je[1]),t.ansi[2]=xe(e.green,je[2]),t.ansi[3]=xe(e.yellow,je[3]),t.ansi[4]=xe(e.blue,je[4]),t.ansi[5]=xe(e.magenta,je[5]),t.ansi[6]=xe(e.cyan,je[6]),t.ansi[7]=xe(e.white,je[7]),t.ansi[8]=xe(e.brightBlack,je[8]),t.ansi[9]=xe(e.brightRed,je[9]),t.ansi[10]=xe(e.brightGreen,je[10]),t.ansi[11]=xe(e.brightYellow,je[11]),t.ansi[12]=xe(e.brightBlue,je[12]),t.ansi[13]=xe(e.brightMagenta,je[13]),t.ansi[14]=xe(e.brightCyan,je[14]),t.ansi[15]=xe(e.brightWhite,je[15]),e.extendedAnsi){let s=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let i=0;i<s;i++)t.ansi[i+16]=xe(e.extendedAnsi[i],je[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};so=Ae([Y(0,gt)],so);function xe(e,t){if(e!==void 0)try{return Pe.toColor(e)}catch{}return t}var lm=class{constructor(...e){this._entries=new Map;for(let[t,s]of e)this.set(t,s)}set(e,t){let s=this._entries.get(e);return this._entries.set(e,t),s}forEach(e){for(let[t,s]of this._entries.entries())e(t,s)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},am=class{constructor(){this._services=new lm,this._services.set(Bo,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let s=tg(e).sort((n,o)=>n.index-o.index),i=[];for(let n of s){let o=this._services.get(n.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${n.id._id}.`);i.push(o)}let r=s.length>0?s[0].index:t.length;if(t.length!==r)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${r+1} conflicts with ${t.length} static arguments`);return new e(...t,...i)}},hm={trace:0,debug:1,info:2,warn:3,error:4,off:5},cm="xterm.js: ",io=class extends he{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=hm[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":cm)+t,...s)}trace(e,...t){var s;this._logLevel<=0&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.trace.bind(this._optionsService.options.logger))??console.log,e,t)}debug(e,...t){var s;this._logLevel<=1&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.debug.bind(this._optionsService.options.logger))??console.log,e,t)}info(e,...t){var s;this._logLevel<=2&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.info.bind(this._optionsService.options.logger))??console.info,e,t)}warn(e,...t){var s;this._logLevel<=3&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.warn.bind(this._optionsService.options.logger))??console.warn,e,t)}error(e,...t){var s;this._logLevel<=4&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.error.bind(this._optionsService.options.logger))??console.error,e,t)}};io=Ae([Y(0,gt)],io);var Yl=class extends he{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new W),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new W),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new W),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let s=0;s<Math.min(e,this.length);s++)t[s]=this._array[this._getCyclicIndex(s)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...s){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+s.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<s.length;i++)this._array[this._getCyclicIndex(e+i)]=s[i];if(s.length&&this.onInsertEmitter.fire({index:e,amount:s.length}),this._length+s.length>this._maxLength){let i=this._length+s.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=s.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,s){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+s<0)throw new Error("Cannot shift elements in list beyond index 0");if(s>0){for(let r=t-1;r>=0;r--)this.set(e+r+s,this.get(e+r));let i=e+t+s-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<t;i++)this.set(e+i+s,this.get(e+i))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},ae=3,ze=Object.freeze(new Wi),Zi=0,cn=2,gi=class _c{constructor(t,s,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*ae);let r=s||Pt.fromCharData([0,Lh,1,0]);for(let n=0;n<t;++n)this.setCell(n,r);this.length=t}get(t){let s=this._data[t*ae+0],i=s&2097151;return[this._data[t*ae+1],s&2097152?this._combined[t]:i?bs(i):"",s>>22,s&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i]}set(t,s){this._data[t*ae+1]=s[0],s[1].length>1?(this._combined[t]=s[1],this._data[t*ae+0]=t|2097152|s[2]<<22):this._data[t*ae+0]=s[1].charCodeAt(0)|s[2]<<22}getWidth(t){return this._data[t*ae+0]>>22}hasWidth(t){return this._data[t*ae+0]&12582912}getFg(t){return this._data[t*ae+1]}getBg(t){return this._data[t*ae+2]}hasContent(t){return this._data[t*ae+0]&4194303}getCodePoint(t){let s=this._data[t*ae+0];return s&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):s&2097151}isCombined(t){return this._data[t*ae+0]&2097152}getString(t){let s=this._data[t*ae+0];return s&2097152?this._combined[t]:s&2097151?bs(s&2097151):""}isProtected(t){return this._data[t*ae+2]&536870912}loadCell(t,s){return Zi=t*ae,s.content=this._data[Zi+0],s.fg=this._data[Zi+1],s.bg=this._data[Zi+2],s.content&2097152&&(s.combinedData=this._combined[t]),s.bg&268435456&&(s.extended=this._extendedAttrs[t]),s}setCell(t,s){s.content&2097152&&(this._combined[t]=s.combinedData),s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*ae+0]=s.content,this._data[t*ae+1]=s.fg,this._data[t*ae+2]=s.bg}setCellFromCodepoint(t,s,i,r){r.bg&268435456&&(this._extendedAttrs[t]=r.extended),this._data[t*ae+0]=s|i<<22,this._data[t*ae+1]=r.fg,this._data[t*ae+2]=r.bg}addCodepointToCell(t,s,i){let r=this._data[t*ae+0];r&2097152?this._combined[t]+=bs(s):r&2097151?(this._combined[t]=bs(r&2097151)+bs(s),r&=-2097152,r|=2097152):r=s|1<<22,i&&(r&=-12582913,r|=i<<22),this._data[t*ae+0]=r}insertCells(t,s,i){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length-t){let r=new Pt;for(let n=this.length-t-s-1;n>=0;--n)this.setCell(t+s+n,this.loadCell(t+n,r));for(let n=0;n<s;++n)this.setCell(t+n,i)}else for(let r=t;r<this.length;++r)this.setCell(r,i);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(t,s,i){if(t%=this.length,s<this.length-t){let r=new Pt;for(let n=0;n<this.length-t-s;++n)this.setCell(t+n,this.loadCell(t+s+n,r));for(let n=this.length-s;n<this.length;++n)this.setCell(n,i)}else for(let r=t;r<this.length;++r)this.setCell(r,i);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,i)}replaceCells(t,s,i,r=!1){if(r){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodepoint(s,0,1,i);t<s&&t<this.length;)this.isProtected(t)||this.setCell(t,i),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s,0,1,i);t<s&&t<this.length;)this.setCell(t++,i)}resize(t,s){if(t===this.length)return this._data.length*4*cn<this._data.buffer.byteLength;let i=t*ae;if(t>this.length){if(this._data.buffer.byteLength>=i*4)this._data=new Uint32Array(this._data.buffer,0,i);else{let r=new Uint32Array(i);r.set(this._data),this._data=r}for(let r=this.length;r<t;++r)this.setCell(r,s)}else{this._data=this._data.subarray(0,i);let r=Object.keys(this._combined);for(let o=0;o<r.length;o++){let l=parseInt(r[o],10);l>=t&&delete this._combined[l]}let n=Object.keys(this._extendedAttrs);for(let o=0;o<n.length;o++){let l=parseInt(n[o],10);l>=t&&delete this._extendedAttrs[l]}}return this.length=t,i*4*cn<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*cn<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,s=!1){if(s){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,t);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let s in t._combined)this._combined[s]=t._combined[s];this._extendedAttrs={};for(let s in t._extendedAttrs)this._extendedAttrs[s]=t._extendedAttrs[s];this.isWrapped=t.isWrapped}clone(){let t=new _c(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let s in this._combined)t._combined[s]=this._combined[s];for(let s in this._extendedAttrs)t._extendedAttrs[s]=this._extendedAttrs[s];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303)return t+(this._data[t*ae+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*ae+0]&4194303||this._data[t*ae+2]&50331648)return t+(this._data[t*ae+0]>>22);return 0}copyCellsFrom(t,s,i,r,n){let o=t._data;if(n)for(let a=r-1;a>=0;a--){for(let h=0;h<ae;h++)this._data[(i+a)*ae+h]=o[(s+a)*ae+h];o[(s+a)*ae+2]&268435456&&(this._extendedAttrs[i+a]=t._extendedAttrs[s+a])}else for(let a=0;a<r;a++){for(let h=0;h<ae;h++)this._data[(i+a)*ae+h]=o[(s+a)*ae+h];o[(s+a)*ae+2]&268435456&&(this._extendedAttrs[i+a]=t._extendedAttrs[s+a])}let l=Object.keys(t._combined);for(let a=0;a<l.length;a++){let h=parseInt(l[a],10);h>=s&&(this._combined[h-s+i]=t._combined[h])}}translateToString(t,s,i,r){s=s??0,i=i??this.length,t&&(i=Math.min(i,this.getTrimmedLength())),r&&(r.length=0);let n="";for(;s<i;){let o=this._data[s*ae+0],l=o&2097151,a=o&2097152?this._combined[s]:l?bs(l):ys;if(n+=a,r)for(let h=0;h<a.length;++h)r.push(s);s+=o>>22||1}return r&&r.push(s),n}};function um(e,t,s,i,r,n){let o=[];for(let l=0;l<e.length-1;l++){let a=l,h=e.get(++a);if(!h.isWrapped)continue;let c=[e.get(l)];for(;a<e.length&&h.isWrapped;)c.push(h),h=e.get(++a);if(!n&&i>=l&&i<a){l+=c.length-1;continue}let u=0,d=Oi(c,u,t),f=1,_=0;for(;f<c.length;){let b=Oi(c,f,t),m=b-_,y=s-d,k=Math.min(m,y);c[u].copyCellsFrom(c[f],_,d,k,!1),d+=k,d===s&&(u++,d=0),_+=k,_===b&&(f++,_=0),d===0&&u!==0&&c[u-1].getWidth(s-1)===2&&(c[u].copyCellsFrom(c[u-1],s-1,d++,1,!1),c[u-1].setCell(s-1,r))}c[u].replaceCells(d,s,r);let v=0;for(let b=c.length-1;b>0&&(b>u||c[b].getTrimmedLength()===0);b--)v++;v>0&&(o.push(l+c.length-v),o.push(v)),l+=c.length-1}return o}function dm(e,t){let s=[],i=0,r=t[i],n=0;for(let o=0;o<e.length;o++)if(r===o){let l=t[++i];e.onDeleteEmitter.fire({index:o-n,amount:l}),o+=l-1,n+=l,r=t[++i]}else s.push(o);return{layout:s,countRemoved:n}}function fm(e,t){let s=[];for(let i=0;i<t.length;i++)s.push(e.get(t[i]));for(let i=0;i<s.length;i++)e.set(i,s[i]);e.length=t.length}function _m(e,t,s){let i=[],r=e.map((a,h)=>Oi(e,h,t)).reduce((a,h)=>a+h),n=0,o=0,l=0;for(;l<r;){if(r-l<s){i.push(r-l);break}n+=s;let a=Oi(e,o,t);n>a&&(n-=a,o++);let h=e[o].getWidth(n-1)===2;h&&n--;let c=h?s-1:s;i.push(c),l+=c}return i}function Oi(e,t,s){if(t===e.length-1)return e[t].getTrimmedLength();let i=!e[t].hasContent(s-1)&&e[t].getWidth(s-1)===1,r=e[t+1].getWidth(0)===2;return i&&r?s-1:s}var pc=class gc{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=gc._nextId++,this._onDispose=this.register(new W),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),$s(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};pc._nextId=1;var pm=pc,Ye={},Ps=Ye.B;Ye[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};Ye.A={"#":""};Ye.B=void 0;Ye[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};Ye.C=Ye[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};Ye.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};Ye.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};Ye.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};Ye.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};Ye.E=Ye[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};Ye.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};Ye.H=Ye[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};Ye["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var Xl=4294967295,Gl=class{constructor(e,t,s){this._hasScrollback=e,this._optionsService=t,this._bufferService=s,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=ze.clone(),this.savedCharset=Ps,this.markers=[],this._nullCell=Pt.fromCharData([0,Lh,1,0]),this._whitespaceCell=Pt.fromCharData([0,ys,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new Cr,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new Yl(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new Sr),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new Sr),this._whitespaceCell}getBlankLine(e,t){return new gi(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>Xl?Xl:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=ze);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new Yl(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let s=this.getNullCell(ze),i=0,r=this._getCorrectBufferLength(t);if(r>this.lines.maxLength&&(this.lines.maxLength=r),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)i+=+this.lines.get(o).resize(e,s);let n=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new gi(e,s)):this.ybase>0&&this.lines.length<=this.ybase+this.y+n+1?(this.ybase--,n++,this.ydisp>0&&this.ydisp--):this.lines.push(new gi(e,s)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(r<this.lines.maxLength){let o=this.lines.length-r;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=r}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),n&&(this.y+=n),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let n=0;n<this.lines.length;n++)i+=+this.lines.get(n).resize(e,s);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let s=this._optionsService.rawOptions.reflowCursorLine,i=um(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(ze),s);if(i.length>0){let r=dm(this.lines,i);fm(this.lines,r.layout),this._reflowLargerAdjustViewport(e,t,r.countRemoved)}}_reflowLargerAdjustViewport(e,t,s){let i=this.getNullCell(ze),r=s;for(;r-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new gi(e,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-s,0)}_reflowSmaller(e,t){let s=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(ze),r=[],n=0;for(let o=this.lines.length-1;o>=0;o--){let l=this.lines.get(o);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;let a=[l];for(;l.isWrapped&&o>0;)l=this.lines.get(--o),a.unshift(l);if(!s){let k=this.ybase+this.y;if(k>=o&&k<o+a.length)continue}let h=a[a.length-1].getTrimmedLength(),c=_m(a,this._cols,e),u=c.length-a.length,d;this.ybase===0&&this.y!==this.lines.length-1?d=Math.max(0,this.y-this.lines.maxLength+u):d=Math.max(0,this.lines.length-this.lines.maxLength+u);let f=[];for(let k=0;k<u;k++){let C=this.getBlankLine(ze,!0);f.push(C)}f.length>0&&(r.push({start:o+a.length+n,newLines:f}),n+=f.length),a.push(...f);let _=c.length-1,v=c[_];v===0&&(_--,v=c[_]);let b=a.length-u-1,m=h;for(;b>=0;){let k=Math.min(m,v);if(a[_]===void 0)break;if(a[_].copyCellsFrom(a[b],m-k,v-k,k,!0),v-=k,v===0&&(_--,v=c[_]),m-=k,m===0){b--;let C=Math.max(b,0);m=Oi(a,C,this._cols)}}for(let k=0;k<a.length;k++)c[k]<e&&a[k].setCell(c[k],i);let y=u-d;for(;y-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+n)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+t-1)}if(r.length>0){let o=[],l=[];for(let v=0;v<this.lines.length;v++)l.push(this.lines.get(v));let a=this.lines.length,h=a-1,c=0,u=r[c];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+n);let d=0;for(let v=Math.min(this.lines.maxLength-1,a+n-1);v>=0;v--)if(u&&u.start>h+d){for(let b=u.newLines.length-1;b>=0;b--)this.lines.set(v--,u.newLines[b]);v++,o.push({index:h+1,amount:u.newLines.length}),d+=u.newLines.length,u=r[++c]}else this.lines.set(v,l[h--]);let f=0;for(let v=o.length-1;v>=0;v--)o[v].index+=f,this.lines.onInsertEmitter.fire(o[v]),f+=o[v].amount;let _=Math.max(0,a+n-this.lines.maxLength);_>0&&this.lines.onTrimEmitter.fire(_)}}translateBufferLineToString(e,t,s=0,i){let r=this.lines.get(e);return r?r.translateToString(t,s,i):""}getWrappedRangeForLine(e){let t=e,s=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;s+1<this.lines.length&&this.lines.get(s+1).isWrapped;)s++;return{first:t,last:s}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new pm(e);return this.markers.push(t),t.register(this.lines.onTrim(s=>{t.line-=s,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(s=>{t.line>=s.index&&(t.line+=s.amount)})),t.register(this.lines.onDelete(s=>{t.line>=s.index&&t.line<s.index+s.amount&&t.dispose(),t.line>s.index&&(t.line-=s.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},gm=class extends he{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new W),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new Gl(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new Gl(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},vc=2,mc=1,ro=class extends he{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,vc),this.rows=Math.max(e.rawOptions.rows||0,mc),this.buffers=this._register(new gm(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let s=this.cols!==e,i=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:s,rowsChanged:i})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let s=this.buffer,i;i=this._cachedBlankLine,(!i||i.length!==this.cols||i.getFg(0)!==e.fg||i.getBg(0)!==e.bg)&&(i=s.getBlankLine(e,t),this._cachedBlankLine=i),i.isWrapped=t;let r=s.ybase+s.scrollTop,n=s.ybase+s.scrollBottom;if(s.scrollTop===0){let o=s.lines.isFull;n===s.lines.length-1?o?s.lines.recycle().copyFrom(i):s.lines.push(i.clone()):s.lines.splice(n+1,0,i.clone()),o?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{let o=n-r+1;s.lines.shiftElements(r+1,o-1,-1),s.lines.set(n,i.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(e,t){let s=this.buffer;if(e<0){if(s.ydisp===0)return;this.isUserScrolling=!0}else e+s.ydisp>=s.ybase&&(this.isUserScrolling=!1);let i=s.ydisp;s.ydisp=Math.max(Math.min(s.ydisp+e,s.ybase),0),i!==s.ydisp&&(t||this._onScroll.fire(s.ydisp))}};ro=Ae([Y(0,gt)],ro);var Vs={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:wr,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},vm=["normal","bold","100","200","300","400","500","600","700","800","900"],mm=class extends he{constructor(e){super(),this._onOptionChange=this._register(new W),this.onOptionChange=this._onOptionChange.event;let t={...Vs};for(let s in e)if(s in t)try{let i=e[s];t[s]=this._sanitizeAndValidateOption(s,i)}catch(i){console.error(i)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(De(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(s=>{s===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(s=>{e.indexOf(s)!==-1&&t()})}_setupOptions(){let e=s=>{if(!(s in Vs))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},t=(s,i)=>{if(!(s in Vs))throw new Error(`No option with key "${s}"`);i=this._sanitizeAndValidateOption(s,i),this.rawOptions[s]!==i&&(this.rawOptions[s]=i,this._onOptionChange.fire(s))};for(let s in this.rawOptions){let i={get:e.bind(this,s),set:t.bind(this,s)};Object.defineProperty(this.options,s,i)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=Vs[e]),!Sm(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=Vs[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=vm.includes(t)?t:Vs[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function Sm(e){return e==="block"||e==="underline"||e==="bar"}function vi(e,t=5){if(typeof e!="object")return e;let s=Array.isArray(e)?[]:{};for(let i in e)s[i]=t<=1?e[i]:e[i]&&vi(e[i],t-1);return s}var Jl=Object.freeze({insertMode:!1}),Zl=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),no=class extends he{constructor(e,t,s){super(),this._bufferService=e,this._logService=t,this._optionsService=s,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new W),this.onData=this._onData.event,this._onUserInput=this._register(new W),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new W),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=vi(Jl),this.decPrivateModes=vi(Zl)}reset(){this.modes=vi(Jl),this.decPrivateModes=vi(Zl)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let s=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&s.ybase!==s.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(i=>i.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};no=Ae([Y(0,pt),Y(1,$h),Y(2,gt)],no);var Ql={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function un(e,t){let s=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(s|=64,s|=e.action):(s|=e.button&3,e.button&4&&(s|=64),e.button&8&&(s|=128),e.action===32?s|=32:e.action===0&&!t&&(s|=3)),s}var dn=String.fromCharCode,ea={DEFAULT:e=>{let t=[un(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${dn(t[0])}${dn(t[1])}${dn(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${un(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${un(e,!0)};${e.x};${e.y}${t}`}},oo=class extends he{constructor(e,t,s){super(),this._bufferService=e,this._coreService=t,this._optionsService=s,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new W),this.onProtocolChange=this._onProtocolChange.event;for(let i of Object.keys(Ql))this.addProtocol(i,Ql[i]);for(let i of Object.keys(ea))this.addEncoding(i,ea[i]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,s){if(e.deltaY===0||e.shiftKey||t===void 0||s===void 0)return 0;let i=t/s,r=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(r/=i+0,Math.abs(e.deltaY)<50&&(r*=.3),this._wheelPartialScroll+=r,r=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._bufferService.rows),r}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,s){if(s){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};oo=Ae([Y(0,pt),Y(1,Ws),Y(2,gt)],oo);var fn=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],bm=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],qe;function ym(e,t){let s=0,i=t.length-1,r;if(e<t[0][0]||e>t[i][1])return!1;for(;i>=s;)if(r=s+i>>1,e>t[r][1])s=r+1;else if(e<t[r][0])i=r-1;else return!0;return!1}var wm=class{constructor(){if(this.version="6",!qe){qe=new Uint8Array(65536),qe.fill(1),qe[0]=0,qe.fill(0,1,32),qe.fill(0,127,160),qe.fill(2,4352,4448),qe[9001]=2,qe[9002]=2,qe.fill(2,11904,42192),qe[12351]=1,qe.fill(2,44032,55204),qe.fill(2,63744,64256),qe.fill(2,65040,65050),qe.fill(2,65072,65136),qe.fill(2,65280,65377),qe.fill(2,65504,65511);for(let e=0;e<fn.length;++e)qe.fill(0,fn[e][0],fn[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?qe[e]:ym(e,bm)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let s=this.wcwidth(e),i=s===0&&t!==0;if(i){let r=Ls.extractWidth(t);r===0?i=!1:r>s&&(s=r)}return Ls.createPropertyValue(0,s,i)}},Ls=class hr{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new W,this.onChange=this._onChange.event;let t=new wm;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,s,i=!1){return(t&16777215)<<3|(s&3)<<1|(i?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let s=0,i=0,r=t.length;for(let n=0;n<r;++n){let o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=r)return s+this.wcwidth(o);let h=t.charCodeAt(n);56320<=h&&h<=57343?o=(o-55296)*1024+h-56320+65536:s+=this.wcwidth(h)}let l=this.charProperties(o,i),a=hr.extractWidth(l);hr.extractShouldJoin(l)&&(a-=hr.extractWidth(i)),s+=a,i=l}return s}charProperties(t,s){return this._activeProvider.charProperties(t,s)}},Cm=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function ta(e){var i;let t=(i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1))==null?void 0:i.get(e.cols-1),s=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);s&&t&&(s.isWrapped=t[3]!==0&&t[3]!==32)}var hi=2147483647,xm=256,Sc=class lo{constructor(t=32,s=32){if(this.maxLength=t,this.maxSubParamsLength=s,s>xm)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(s),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let s=new lo;if(!t.length)return s;for(let i=Array.isArray(t[0])?1:0;i<t.length;++i){let r=t[i];if(Array.isArray(r))for(let n=0;n<r.length;++n)s.addSubParam(r[n]);else s.addParam(r)}return s}clone(){let t=new lo(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let s=0;s<this.length;++s){t.push(this.params[s]);let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&t.push(Array.prototype.slice.call(this._subParams,i,r))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>hi?hi:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>hi?hi:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let s=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;return i-s>0?this._subParams.subarray(s,i):null}getSubParamsAll(){let t={};for(let s=0;s<this.length;++s){let i=this._subParamsIdx[s]>>8,r=this._subParamsIdx[s]&255;r-i>0&&(t[s]=this._subParams.slice(i,r))}return t}addDigit(t){let s;if(this._rejectDigits||!(s=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let i=this._digitIsSub?this._subParams:this.params,r=i[s-1];i[s-1]=~r?Math.min(r*10+t,hi):t}},ci=[],km=class{constructor(){this._state=0,this._active=ci,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(t),{dispose:()=>{let i=s.indexOf(t);i!==-1&&s.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=ci}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=ci,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||ci,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,s){if(!this._active.length)this._handlerFb(this._id,"PUT",Fr(e,t,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s)}start(){this.reset(),this._state=1}put(e,t,s){if(this._state!==3){if(this._state===1)for(;t<s;){let i=e[t++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&s-t>0&&this._put(e,t,s)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].end(e),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].end(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=ci,this._id=-1,this._state=0}}},wt=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=Fr(e,t,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(s=>(this._data="",this._hitLimit=!1,s));return this._data="",this._hitLimit=!1,t}},ui=[],Em=class{constructor(){this._handlers=Object.create(null),this._active=ui,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=ui}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(t),{dispose:()=>{let i=s.indexOf(t);i!==-1&&s.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=ui,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||ui,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(t)}put(e,t,s){if(!this._active.length)this._handlerFb(this._ident,"PUT",Fr(e,t,s));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,s)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let s=!1,i=this._active.length-1,r=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,s=t,r=this._stack.fallThrough,this._stack.paused=!1),!r&&s===!1){for(;i>=0&&(s=this._active[i].unhook(e),s!==!0);i--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,s;i--}for(;i>=0;i--)if(s=this._active[i].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,s}this._active=ui,this._ident=0}},mi=new Sc;mi.addParam(0);var sa=class{constructor(e){this._handler=e,this._data="",this._params=mi,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():mi,this._data="",this._hitLimit=!1}put(e,t,s){this._hitLimit||(this._data+=Fr(e,t,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(s=>(this._params=mi,this._data="",this._hitLimit=!1,s));return this._params=mi,this._data="",this._hitLimit=!1,t}},Mm=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,s,i){this.table[t<<8|e]=s<<4|i}addMany(e,t,s,i){for(let r=0;r<e.length;r++)this.table[t<<8|e[r]]=s<<4|i}},Tt=160,Rm=(function(){let e=new Mm(4095),t=Array.apply(null,Array(256)).map((l,a)=>a),s=(l,a)=>t.slice(l,a),i=s(32,127),r=s(0,24);r.push(25),r.push.apply(r,s(28,32));let n=s(0,14),o;e.setDefault(1,0),e.addMany(i,0,2,0);for(o in n)e.addMany([24,26,153,154],o,3,0),e.addMany(s(128,144),o,3,0),e.addMany(s(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(r,0,3,0),e.addMany(r,1,3,1),e.add(127,1,0,1),e.addMany(r,8,0,8),e.addMany(r,3,3,3),e.add(127,3,0,3),e.addMany(r,4,3,4),e.add(127,4,0,4),e.addMany(r,6,3,6),e.addMany(r,5,3,5),e.add(127,5,0,5),e.addMany(r,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(s(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(r,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(s(64,127),3,7,0),e.addMany(s(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(s(48,60),4,8,4),e.addMany(s(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(s(32,64),6,0,6),e.add(127,6,0,6),e.addMany(s(64,127),6,0,0),e.addMany(s(32,48),3,9,5),e.addMany(s(32,48),5,9,5),e.addMany(s(48,64),5,0,6),e.addMany(s(64,127),5,7,0),e.addMany(s(32,48),4,9,5),e.addMany(s(32,48),1,9,2),e.addMany(s(32,48),2,9,2),e.addMany(s(48,127),2,10,0),e.addMany(s(48,80),1,10,0),e.addMany(s(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(s(96,127),1,10,0),e.add(80,1,11,9),e.addMany(r,9,0,9),e.add(127,9,0,9),e.addMany(s(28,32),9,0,9),e.addMany(s(32,48),9,9,12),e.addMany(s(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(r,11,0,11),e.addMany(s(32,128),11,0,11),e.addMany(s(28,32),11,0,11),e.addMany(r,10,0,10),e.add(127,10,0,10),e.addMany(s(28,32),10,0,10),e.addMany(s(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(s(32,48),10,9,12),e.addMany(r,12,0,12),e.add(127,12,0,12),e.addMany(s(28,32),12,0,12),e.addMany(s(32,48),12,9,12),e.addMany(s(48,64),12,0,11),e.addMany(s(64,127),12,12,13),e.addMany(s(64,127),10,12,13),e.addMany(s(64,127),9,12,13),e.addMany(r,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(Tt,0,2,0),e.add(Tt,8,5,8),e.add(Tt,6,0,6),e.add(Tt,11,0,11),e.add(Tt,13,13,13),e})(),Bm=class extends he{constructor(e=Rm){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new Sc,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,s,i)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,s)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(De(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new km),this._dcsParser=this._register(new Em),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let s=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(s=e.prefix.charCodeAt(0),s&&60>s||s>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let r=0;r<e.intermediates.length;++r){let n=e.intermediates.charCodeAt(r);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=n}}if(e.final.length!==1)throw new Error("final must be a single byte");let i=e.final.charCodeAt(0);if(t[0]>i||i>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return s<<=8,s|=i,s}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let s=this._identifier(e,[48,126]);this._escHandlers[s]===void 0&&(this._escHandlers[s]=[]);let i=this._escHandlers[s];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let s=this._identifier(e);this._csiHandlers[s]===void 0&&(this._csiHandlers[s]=[]);let i=this._csiHandlers[s];return i.push(t),{dispose:()=>{let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,s,i,r){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=s,this._parseStack.transition=i,this._parseStack.chunkPos=r}parse(e,t,s){let i=0,r=0,n=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,n=this._parseStack.chunkPos+1;else{if(s===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let l=this._parseStack.handlers,a=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(s===!1&&a>-1){for(;a>=0&&(o=l[a](this._params),o!==!0);a--)if(o instanceof Promise)return this._parseStack.handlerPos=a,o}this._parseStack.handlers=[];break;case 4:if(s===!1&&a>-1){for(;a>=0&&(o=l[a](),o!==!0);a--)if(o instanceof Promise)return this._parseStack.handlerPos=a,o}this._parseStack.handlers=[];break;case 6:if(i=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=e[this._parseStack.chunkPos],o=this._oscParser.end(i!==24&&i!==26,s),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,n=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let l=n;l<t;++l){switch(i=e[l],r=this._transitions.table[this.currentState<<8|(i<160?i:Tt)],r>>4){case 2:for(let d=l+1;;++d){if(d>=t||(i=e[d])<32||i>126&&i<Tt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Tt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Tt){this._printHandler(e,l,d),l=d-1;break}if(++d>=t||(i=e[d])<32||i>126&&i<Tt){this._printHandler(e,l,d),l=d-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:l,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let a=this._csiHandlers[this._collect<<8|i],h=a?a.length-1:-1;for(;h>=0&&(o=a[h](this._params),o!==!0);h--)if(o instanceof Promise)return this._preserveStack(3,a,h,r,l),o;h<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}while(++l<t&&(i=e[l])>47&&i<60);l--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:let c=this._escHandlers[this._collect<<8|i],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(4,c,u,r,l),o;u<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let d=l+1;;++d)if(d>=t||(i=e[d])===24||i===26||i===27||i>127&&i<Tt){this._dcsParser.put(e,l,d),l=d-1;break}break;case 14:if(o=this._dcsParser.unhook(i!==24&&i!==26),o)return this._preserveStack(6,[],0,r,l),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let d=l+1;;d++)if(d>=t||(i=e[d])<32||i>127&&i<Tt){this._oscParser.put(e,l,d),l=d-1;break}break;case 6:if(o=this._oscParser.end(i!==24&&i!==26),o)return this._preserveStack(5,[],0,r,l),o;i===27&&(r|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=r&15}}},Dm=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,Tm=/^[\da-f]+$/;function ia(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let s=Dm.exec(t);if(s){let i=s[1]?15:s[4]?255:s[7]?4095:65535;return[Math.round(parseInt(s[1]||s[4]||s[7]||s[10],16)/i*255),Math.round(parseInt(s[2]||s[5]||s[8]||s[11],16)/i*255),Math.round(parseInt(s[3]||s[6]||s[9]||s[12],16)/i*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),Tm.exec(t)&&[3,6,9,12].includes(t.length))){let s=t.length/3,i=[0,0,0];for(let r=0;r<3;++r){let n=parseInt(t.slice(s*r,s*r+s),16);i[r]=s===1?n<<4:s===2?n:s===3?n>>4:n>>8}return i}}function _n(e,t){let s=e.toString(16),i=s.length<2?"0"+s:s;switch(t){case 4:return s[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}function Pm(e,t=16){let[s,i,r]=e;return`rgb:${_n(s,t)}/${_n(i,t)}/${_n(r,t)}`}var Lm={"(":0,")":1,"*":2,"+":3,"-":1,".":2},ps=131072,ra=10;function na(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var oa=5e3,la=0,Im=class extends he{constructor(e,t,s,i,r,n,o,l,a=new Bm){super(),this._bufferService=e,this._charsetService=t,this._coreService=s,this._logService=i,this._optionsService=r,this._oscLinkService=n,this._coreMouseService=o,this._unicodeService=l,this._parser=a,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new Qp,this._utf8Decoder=new eg,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=ze.clone(),this._eraseAttrDataInternal=ze.clone(),this._onRequestBell=this._register(new W),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new W),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new W),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new W),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new W),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new W),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new W),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new W),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new W),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new W),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new ao(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(h=>this._activeBuffer=h.activeBuffer)),this._parser.setCsiHandlerFallback((h,c)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(h),params:c.toArray()})}),this._parser.setEscHandlerFallback(h=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(h)})}),this._parser.setExecuteHandlerFallback(h=>{this._logService.debug("Unknown EXECUTE code: ",{code:h})}),this._parser.setOscHandlerFallback((h,c,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:h,action:c,data:u})}),this._parser.setDcsHandlerFallback((h,c,u)=>{c==="HOOK"&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(h),action:c,payload:u})}),this._parser.setPrintHandler((h,c,u)=>this.print(h,c,u)),this._parser.registerCsiHandler({final:"@"},h=>this.insertChars(h)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},h=>this.scrollLeft(h)),this._parser.registerCsiHandler({final:"A"},h=>this.cursorUp(h)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},h=>this.scrollRight(h)),this._parser.registerCsiHandler({final:"B"},h=>this.cursorDown(h)),this._parser.registerCsiHandler({final:"C"},h=>this.cursorForward(h)),this._parser.registerCsiHandler({final:"D"},h=>this.cursorBackward(h)),this._parser.registerCsiHandler({final:"E"},h=>this.cursorNextLine(h)),this._parser.registerCsiHandler({final:"F"},h=>this.cursorPrecedingLine(h)),this._parser.registerCsiHandler({final:"G"},h=>this.cursorCharAbsolute(h)),this._parser.registerCsiHandler({final:"H"},h=>this.cursorPosition(h)),this._parser.registerCsiHandler({final:"I"},h=>this.cursorForwardTab(h)),this._parser.registerCsiHandler({final:"J"},h=>this.eraseInDisplay(h,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},h=>this.eraseInDisplay(h,!0)),this._parser.registerCsiHandler({final:"K"},h=>this.eraseInLine(h,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},h=>this.eraseInLine(h,!0)),this._parser.registerCsiHandler({final:"L"},h=>this.insertLines(h)),this._parser.registerCsiHandler({final:"M"},h=>this.deleteLines(h)),this._parser.registerCsiHandler({final:"P"},h=>this.deleteChars(h)),this._parser.registerCsiHandler({final:"S"},h=>this.scrollUp(h)),this._parser.registerCsiHandler({final:"T"},h=>this.scrollDown(h)),this._parser.registerCsiHandler({final:"X"},h=>this.eraseChars(h)),this._parser.registerCsiHandler({final:"Z"},h=>this.cursorBackwardTab(h)),this._parser.registerCsiHandler({final:"`"},h=>this.charPosAbsolute(h)),this._parser.registerCsiHandler({final:"a"},h=>this.hPositionRelative(h)),this._parser.registerCsiHandler({final:"b"},h=>this.repeatPrecedingCharacter(h)),this._parser.registerCsiHandler({final:"c"},h=>this.sendDeviceAttributesPrimary(h)),this._parser.registerCsiHandler({prefix:">",final:"c"},h=>this.sendDeviceAttributesSecondary(h)),this._parser.registerCsiHandler({final:"d"},h=>this.linePosAbsolute(h)),this._parser.registerCsiHandler({final:"e"},h=>this.vPositionRelative(h)),this._parser.registerCsiHandler({final:"f"},h=>this.hVPosition(h)),this._parser.registerCsiHandler({final:"g"},h=>this.tabClear(h)),this._parser.registerCsiHandler({final:"h"},h=>this.setMode(h)),this._parser.registerCsiHandler({prefix:"?",final:"h"},h=>this.setModePrivate(h)),this._parser.registerCsiHandler({final:"l"},h=>this.resetMode(h)),this._parser.registerCsiHandler({prefix:"?",final:"l"},h=>this.resetModePrivate(h)),this._parser.registerCsiHandler({final:"m"},h=>this.charAttributes(h)),this._parser.registerCsiHandler({final:"n"},h=>this.deviceStatus(h)),this._parser.registerCsiHandler({prefix:"?",final:"n"},h=>this.deviceStatusPrivate(h)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},h=>this.softReset(h)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},h=>this.setCursorStyle(h)),this._parser.registerCsiHandler({final:"r"},h=>this.setScrollRegion(h)),this._parser.registerCsiHandler({final:"s"},h=>this.saveCursor(h)),this._parser.registerCsiHandler({final:"t"},h=>this.windowOptions(h)),this._parser.registerCsiHandler({final:"u"},h=>this.restoreCursor(h)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},h=>this.insertColumns(h)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},h=>this.deleteColumns(h)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},h=>this.selectProtected(h)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},h=>this.requestMode(h,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},h=>this.requestMode(h,!1)),this._parser.setExecuteHandler(E.BEL,()=>this.bell()),this._parser.setExecuteHandler(E.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(E.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(E.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(E.BS,()=>this.backspace()),this._parser.setExecuteHandler(E.HT,()=>this.tab()),this._parser.setExecuteHandler(E.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(E.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(lr.IND,()=>this.index()),this._parser.setExecuteHandler(lr.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(lr.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new wt(h=>(this.setTitle(h),this.setIconName(h),!0))),this._parser.registerOscHandler(1,new wt(h=>this.setIconName(h))),this._parser.registerOscHandler(2,new wt(h=>this.setTitle(h))),this._parser.registerOscHandler(4,new wt(h=>this.setOrReportIndexedColor(h))),this._parser.registerOscHandler(8,new wt(h=>this.setHyperlink(h))),this._parser.registerOscHandler(10,new wt(h=>this.setOrReportFgColor(h))),this._parser.registerOscHandler(11,new wt(h=>this.setOrReportBgColor(h))),this._parser.registerOscHandler(12,new wt(h=>this.setOrReportCursorColor(h))),this._parser.registerOscHandler(104,new wt(h=>this.restoreIndexedColor(h))),this._parser.registerOscHandler(110,new wt(h=>this.restoreFgColor(h))),this._parser.registerOscHandler(111,new wt(h=>this.restoreBgColor(h))),this._parser.registerOscHandler(112,new wt(h=>this.restoreCursorColor(h))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let h in Ye)this._parser.registerEscHandler({intermediates:"(",final:h},()=>this.selectCharset("("+h)),this._parser.registerEscHandler({intermediates:")",final:h},()=>this.selectCharset(")"+h)),this._parser.registerEscHandler({intermediates:"*",final:h},()=>this.selectCharset("*"+h)),this._parser.registerEscHandler({intermediates:"+",final:h},()=>this.selectCharset("+"+h)),this._parser.registerEscHandler({intermediates:"-",final:h},()=>this.selectCharset("-"+h)),this._parser.registerEscHandler({intermediates:".",final:h},()=>this.selectCharset("."+h)),this._parser.registerEscHandler({intermediates:"/",final:h},()=>this.selectCharset("/"+h));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(h=>(this._logService.error("Parsing error: ",h),h)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new sa((h,c)=>this.requestStatusString(h,c)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,s,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=s,this._parseStack.position=i}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,s)=>setTimeout(()=>s("#SLOW_TIMEOUT"),oa))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${oa} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let s,i=this._activeBuffer.x,r=this._activeBuffer.y,n=0,o=this._parseStack.paused;if(o){if(s=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(s),s;i=this._parseStack.cursorStartX,r=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>ps&&(n=this._parseStack.position+ps)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,h=>String.fromCharCode(h)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(h=>h.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<ps&&(this._parseBuffer=new Uint32Array(Math.min(e.length,ps))),o||this._dirtyRowTracker.clearRange(),e.length>ps)for(let h=n;h<e.length;h+=ps){let c=h+ps<e.length?h+ps:e.length,u=typeof e=="string"?this._stringDecoder.decode(e.substring(h,c),this._parseBuffer):this._utf8Decoder.decode(e.subarray(h,c),this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,u))return this._preserveStack(i,r,u,h),this._logSlowResolvingAsync(s),s}else if(!o){let h=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,h))return this._preserveStack(i,r,h,0),this._logSlowResolvingAsync(s),s}(this._activeBuffer.x!==i||this._activeBuffer.y!==r)&&this._onCursorMove.fire();let l=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),a=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);a<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(a,this._bufferService.rows-1),end:Math.min(l,this._bufferService.rows-1)})}print(e,t,s){let i,r,n=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,l=this._bufferService.cols,a=this._coreService.decPrivateModes.wraparound,h=this._coreService.modes.insertMode,c=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&s-t>0&&u.getWidth(this._activeBuffer.x-1)===2&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,c);let d=this._parser.precedingJoinState;for(let f=t;f<s;++f){if(i=e[f],i<127&&n){let m=n[String.fromCharCode(i)];m&&(i=m.charCodeAt(0))}let _=this._unicodeService.charProperties(i,d);r=Ls.extractWidth(_);let v=Ls.extractShouldJoin(_),b=v?Ls.extractWidth(d):0;if(d=_,o&&this._onA11yChar.fire(bs(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+r-b>l){if(a){let m=u,y=this._activeBuffer.x-b;for(this._activeBuffer.x=b,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),b>0&&u instanceof gi&&u.copyCellsFrom(m,y,0,b,!1);y<l;)m.setCellFromCodepoint(y++,0,1,c)}else if(this._activeBuffer.x=l-1,r===2)continue}if(v&&this._activeBuffer.x){let m=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-m,i,r);for(let y=r-b;--y>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c);continue}if(h&&(u.insertCells(this._activeBuffer.x,r-b,this._activeBuffer.getNullCell(c)),u.getWidth(l-1)===2&&u.setCellFromCodepoint(l-1,0,1,c)),u.setCellFromCodepoint(this._activeBuffer.x++,i,r,c),r>0)for(;--r;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,c)}this._parser.precedingJoinState=d,this._activeBuffer.x<l&&s-t>0&&u.getWidth(this._activeBuffer.x)===0&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,c),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,s=>na(s.params[0],this._optionsService.rawOptions.windowOptions)?t(s):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new sa(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new wt(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var e;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&e.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);t.hasWidth(this._activeBuffer.x)&&!t.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,s,i=!1,r=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n.replaceCells(t,s,this._activeBuffer.getNullCell(this._eraseAttrData()),r),i&&(n.isWrapped=!1)}_resetBufferLine(e,t=!1){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s&&(s.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),s.isWrapped=!1)}eraseInDisplay(e,t=!1){var i;this._restrictCursor(this._bufferService.cols);let s;switch(e.params[0]){case 0:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);s<this._bufferService.rows;s++)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(s);break;case 1:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(s+1).isWrapped=!1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(s=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,s-1);s--&&!((i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s))!=null&&i.getTrimmedLength()););for(;s>=0;s--)this._bufferService.scroll(this._eraseAttrData())}else{for(s=this._bufferService.rows,this._dirtyRowTracker.markDirty(s-1);s--;)this._resetBufferLine(s,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;t--;)this._activeBuffer.lines.splice(r-1,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;t--;)this._activeBuffer.lines.splice(s,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(ze));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let s=this._activeBuffer.scrollTop;s<=this._activeBuffer.scrollBottom;++s){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+s);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let s=e.params[0]||1,i=Ls.extractWidth(t),r=this._activeBuffer.x-i,n=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(r),o=new Uint32Array(n.length*s),l=0;for(let h=0;h<n.length;){let c=n.codePointAt(h)||0;o[l++]=c,h+=c>65535?2:1}let a=l;for(let h=1;h<s;++h)o.copyWithin(a,0,l),a+=l;return this.print(o,0,a),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(E.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(E.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(E.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(E.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(E.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Ps),this._charsetService.setgCharset(1,Ps),this._charsetService.setgCharset(2,Ps),this._charsetService.setgCharset(3,Ps);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){(v=>(v[v.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",v[v.SET=1]="SET",v[v.RESET=2]="RESET",v[v.PERMANENTLY_SET=3]="PERMANENTLY_SET",v[v.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(void 0||(s={}));let i=this._coreService.decPrivateModes,{activeProtocol:r,activeEncoding:n}=this._coreMouseService,o=this._coreService,{buffers:l,cols:a}=this._bufferService,{active:h,alt:c}=l,u=this._optionsService.rawOptions,d=(v,b)=>(o.triggerDataEvent(`${E.ESC}[${t?"":"?"}${v};${b}$y`),!0),f=v=>v?1:2,_=e.params[0];return t?_===2?d(_,4):_===4?d(_,f(o.modes.insertMode)):_===12?d(_,3):_===20?d(_,f(u.convertEol)):d(_,0):_===1?d(_,f(i.applicationCursorKeys)):_===3?d(_,u.windowOptions.setWinLines?a===80?2:a===132?1:0:0):_===6?d(_,f(i.origin)):_===7?d(_,f(i.wraparound)):_===8?d(_,3):_===9?d(_,f(r==="X10")):_===12?d(_,f(u.cursorBlink)):_===25?d(_,f(!o.isCursorHidden)):_===45?d(_,f(i.reverseWraparound)):_===66?d(_,f(i.applicationKeypad)):_===67?d(_,4):_===1e3?d(_,f(r==="VT200")):_===1002?d(_,f(r==="DRAG")):_===1003?d(_,f(r==="ANY")):_===1004?d(_,f(i.sendFocus)):_===1005?d(_,4):_===1006?d(_,f(n==="SGR")):_===1015?d(_,4):_===1016?d(_,f(n==="SGR_PIXELS")):_===1048?d(_,1):_===47||_===1047||_===1049?d(_,f(h===c)):_===2004?d(_,f(i.bracketedPasteMode)):_===2026?d(_,f(i.synchronizedOutput)):d(_,0)}_updateAttrColor(e,t,s,i,r){return t===2?(e|=50331648,e&=-16777216,e|=Wi.fromColorRGB([s,i,r])):t===5&&(e&=-50331904,e|=33554432|s&255),e}_extractColor(e,t,s){let i=[0,0,-1,0,0,0],r=0,n=0;do{if(i[n+r]=e.params[t+n],e.hasSubParams(t+n)){let o=e.getSubParams(t+n),l=0;do i[1]===5&&(r=1),i[n+l+1+r]=o[l];while(++l<o.length&&l+n+1+r<i.length);break}if(i[1]===5&&n+r>=2||i[1]===2&&n+r>=5)break;i[1]&&(r=1)}while(++n+t<e.length&&n+r<i.length);for(let o=2;o<i.length;++o)i[o]===-1&&(i[o]=0);switch(i[0]){case 38:s.fg=this._updateAttrColor(s.fg,i[1],i[3],i[4],i[5]);break;case 48:s.bg=this._updateAttrColor(s.bg,i[1],i[3],i[4],i[5]);break;case 58:s.extended=s.extended.clone(),s.extended.underlineColor=this._updateAttrColor(s.extended.underlineColor,i[1],i[3],i[4],i[5])}return n}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=ze.fg,e.bg=ze.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,s,i=this._curAttrData;for(let r=0;r<t;r++)s=e.params[r],s>=30&&s<=37?(i.fg&=-50331904,i.fg|=16777216|s-30):s>=40&&s<=47?(i.bg&=-50331904,i.bg|=16777216|s-40):s>=90&&s<=97?(i.fg&=-50331904,i.fg|=16777216|s-90|8):s>=100&&s<=107?(i.bg&=-50331904,i.bg|=16777216|s-100|8):s===0?this._processSGR0(i):s===1?i.fg|=134217728:s===3?i.bg|=67108864:s===4?(i.fg|=268435456,this._processUnderline(e.hasSubParams(r)?e.getSubParams(r)[0]:1,i)):s===5?i.fg|=536870912:s===7?i.fg|=67108864:s===8?i.fg|=1073741824:s===9?i.fg|=2147483648:s===2?i.bg|=134217728:s===21?this._processUnderline(2,i):s===22?(i.fg&=-134217729,i.bg&=-134217729):s===23?i.bg&=-67108865:s===24?(i.fg&=-268435457,this._processUnderline(0,i)):s===25?i.fg&=-536870913:s===27?i.fg&=-67108865:s===28?i.fg&=-1073741825:s===29?i.fg&=2147483647:s===39?(i.fg&=-67108864,i.fg|=ze.fg&16777215):s===49?(i.bg&=-67108864,i.bg|=ze.bg&16777215):s===38||s===48||s===58?r+=this._extractColor(e,r,i):s===53?i.bg|=1073741824:s===55?i.bg&=-1073741825:s===59?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):s===100?(i.fg&=-67108864,i.fg|=ze.fg&16777215,i.bg&=-67108864,i.bg|=ze.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",s);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${E.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.ESC}[${t};${s}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${E.ESC}[?${t};${s}R`);break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=ze.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let s=t%2===1;this._coreService.decPrivateModes.cursorBlink=s}return!0}setScrollRegion(e){let t=e.params[0]||1,s;return(e.length<2||(s=e.params[1])>this._bufferService.rows||s===0)&&(s=this._bufferService.rows),s>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=s-1,this._setCursor(0,0)),!0}windowOptions(e){if(!na(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${E.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>ra&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>ra&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],s=e.split(";");for(;s.length>1;){let i=s.shift(),r=s.shift();if(/^\d+$/.exec(i)){let n=parseInt(i);if(aa(n))if(r==="?")t.push({type:0,index:n});else{let o=ia(r);o&&t.push({type:1,index:n,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let s=e.slice(0,t).trim(),i=e.slice(t+1);return i?this._createHyperlink(s,i):s.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let s=e.split(":"),i,r=s.findIndex(n=>n.startsWith("id="));return r!==-1&&(i=s[r].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let s=e.split(";");for(let i=0;i<s.length&&!(t>=this._specialColors.length);++i,++t)if(s[i]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let r=ia(s[i]);r&&this._onColor.fire([{type:1,index:this._specialColors[t],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],s=e.split(";");for(let i=0;i<s.length;++i)if(/^\d+$/.exec(s[i])){let r=parseInt(s[i]);aa(r)&&t.push({type:2,index:r})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Ps),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(Lm[e[0]],Ye[e[1]]||Ps),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=ze.clone(),this._eraseAttrDataInternal=ze.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new Pt;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let s=this._activeBuffer.ybase+this._activeBuffer.y+t,i=this._activeBuffer.lines.get(s);i&&(i.fill(e),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let s=o=>(this._coreService.triggerDataEvent(`${E.ESC}${o}${E.ESC}\\`),!0),i=this._bufferService.buffer,r=this._optionsService.rawOptions;return s(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[r.cursorStyle]-(r.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},ao=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(la=e,e=t,t=la),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};ao=Ae([Y(0,pt)],ao);function aa(e){return 0<=e&&e<256}var Am=5e7,ha=12,Om=50,Nm=class extends he{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let s;for(;s=this._writeBuffer.shift();){this._action(s);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>Am)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let s=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],r=this._action(i,t);if(r){let o=l=>performance.now()-s>=ha?setTimeout(()=>this._innerWrite(0,l)):this._innerWrite(s,l);r.catch(l=>(queueMicrotask(()=>{throw l}),Promise.resolve(!1))).then(o);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=i.length,performance.now()-s>=ha)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>Om&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},ho=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let l=t.addMarker(t.ybase+t.y),a={data:e,id:this._nextId++,lines:[l]};return l.onDispose(()=>this._removeMarkerFromLink(a,l)),this._dataByLinkId.set(a.id,a),a.id}let s=e,i=this._getEntryIdKey(s),r=this._entriesWithId.get(i);if(r)return this.addLineToLink(r.id,t.ybase+t.y),r.id;let n=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(s),data:s,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let s=this._dataByLinkId.get(e);if(s&&s.lines.every(i=>i.line!==t)){let i=this._bufferService.buffer.addMarker(t);s.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(s,i))}}getLinkData(e){var t;return(t=this._dataByLinkId.get(e))==null?void 0:t.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let s=e.lines.indexOf(t);s!==-1&&(e.lines.splice(s,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};ho=Ae([Y(0,pt)],ho);var ca=!1,$m=class extends he{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new ti),this._onBinary=this._register(new W),this.onBinary=this._onBinary.event,this._onData=this._register(new W),this.onData=this._onData.event,this._onLineFeed=this._register(new W),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new W),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new W),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new W),this._instantiationService=new am,this.optionsService=this._register(new mm(e)),this._instantiationService.setService(gt,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(ro)),this._instantiationService.setService(pt,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(io)),this._instantiationService.setService($h,this._logService),this.coreService=this._register(this._instantiationService.createInstance(no)),this._instantiationService.setService(Ws,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(oo)),this._instantiationService.setService(Nh,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(Ls)),this._instantiationService.setService(rg,this.unicodeService),this._charsetService=this._instantiationService.createInstance(Cm),this._instantiationService.setService(ig,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(ho),this._instantiationService.setService(Hh,this._oscLinkService),this._inputHandler=this._register(new Im(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(nt.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(nt.forward(this._bufferService.onResize,this._onResize)),this._register(nt.forward(this.coreService.onData,this._onData)),this._register(nt.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new Nm((t,s)=>this._inputHandler.parse(t,s))),this._register(nt.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new W),this._onScroll.event(e=>{var t;(t=this._onScrollApi)==null||t.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!ca&&(this._logService.warn("writeSync is unreliable and will be removed soon."),ca=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,vc),t=Math.max(t,mc),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(ta.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(ta(this._bufferService),!1))),this._windowsWrappingHeuristics.value=De(()=>{for(let t of e)t.dispose()})}}},Hm={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function Wm(e,t,s,i){var o;let r={type:0,cancel:!1,key:void 0},n=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?r.key=E.ESC+"OA":r.key=E.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?r.key=E.ESC+"OD":r.key=E.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?r.key=E.ESC+"OC":r.key=E.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?r.key=E.ESC+"OB":r.key=E.ESC+"[B");break;case 8:r.key=e.ctrlKey?"\b":E.DEL,e.altKey&&(r.key=E.ESC+r.key);break;case 9:if(e.shiftKey){r.key=E.ESC+"[Z";break}r.key=E.HT,r.cancel=!0;break;case 13:r.key=e.altKey?E.ESC+E.CR:E.CR,r.cancel=!0;break;case 27:r.key=E.ESC,e.altKey&&(r.key=E.ESC+E.ESC),r.cancel=!0;break;case 37:if(e.metaKey)break;n?r.key=E.ESC+"[1;"+(n+1)+"D":t?r.key=E.ESC+"OD":r.key=E.ESC+"[D";break;case 39:if(e.metaKey)break;n?r.key=E.ESC+"[1;"+(n+1)+"C":t?r.key=E.ESC+"OC":r.key=E.ESC+"[C";break;case 38:if(e.metaKey)break;n?r.key=E.ESC+"[1;"+(n+1)+"A":t?r.key=E.ESC+"OA":r.key=E.ESC+"[A";break;case 40:if(e.metaKey)break;n?r.key=E.ESC+"[1;"+(n+1)+"B":t?r.key=E.ESC+"OB":r.key=E.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(r.key=E.ESC+"[2~");break;case 46:n?r.key=E.ESC+"[3;"+(n+1)+"~":r.key=E.ESC+"[3~";break;case 36:n?r.key=E.ESC+"[1;"+(n+1)+"H":t?r.key=E.ESC+"OH":r.key=E.ESC+"[H";break;case 35:n?r.key=E.ESC+"[1;"+(n+1)+"F":t?r.key=E.ESC+"OF":r.key=E.ESC+"[F";break;case 33:e.shiftKey?r.type=2:e.ctrlKey?r.key=E.ESC+"[5;"+(n+1)+"~":r.key=E.ESC+"[5~";break;case 34:e.shiftKey?r.type=3:e.ctrlKey?r.key=E.ESC+"[6;"+(n+1)+"~":r.key=E.ESC+"[6~";break;case 112:n?r.key=E.ESC+"[1;"+(n+1)+"P":r.key=E.ESC+"OP";break;case 113:n?r.key=E.ESC+"[1;"+(n+1)+"Q":r.key=E.ESC+"OQ";break;case 114:n?r.key=E.ESC+"[1;"+(n+1)+"R":r.key=E.ESC+"OR";break;case 115:n?r.key=E.ESC+"[1;"+(n+1)+"S":r.key=E.ESC+"OS";break;case 116:n?r.key=E.ESC+"[15;"+(n+1)+"~":r.key=E.ESC+"[15~";break;case 117:n?r.key=E.ESC+"[17;"+(n+1)+"~":r.key=E.ESC+"[17~";break;case 118:n?r.key=E.ESC+"[18;"+(n+1)+"~":r.key=E.ESC+"[18~";break;case 119:n?r.key=E.ESC+"[19;"+(n+1)+"~":r.key=E.ESC+"[19~";break;case 120:n?r.key=E.ESC+"[20;"+(n+1)+"~":r.key=E.ESC+"[20~";break;case 121:n?r.key=E.ESC+"[21;"+(n+1)+"~":r.key=E.ESC+"[21~";break;case 122:n?r.key=E.ESC+"[23;"+(n+1)+"~":r.key=E.ESC+"[23~";break;case 123:n?r.key=E.ESC+"[24;"+(n+1)+"~":r.key=E.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?r.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?r.key=E.NUL:e.keyCode>=51&&e.keyCode<=55?r.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?r.key=E.DEL:e.keyCode===219?r.key=E.ESC:e.keyCode===220?r.key=E.FS:e.keyCode===221&&(r.key=E.GS);else if((!s||i)&&e.altKey&&!e.metaKey){let l=(o=Hm[e.keyCode])==null?void 0:o[e.shiftKey?1:0];if(l)r.key=E.ESC+l;else if(e.keyCode>=65&&e.keyCode<=90){let a=e.ctrlKey?e.keyCode-64:e.keyCode+32,h=String.fromCharCode(a);e.shiftKey&&(h=h.toUpperCase()),r.key=E.ESC+h}else if(e.keyCode===32)r.key=E.ESC+(e.ctrlKey?E.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let a=e.code.slice(3,4);e.shiftKey||(a=a.toLowerCase()),r.key=E.ESC+a,r.cancel=!0}}else s&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(r.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?r.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(r.key=E.US),e.key==="@"&&(r.key=E.NUL));break}return r}var Ne=0,Fm=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new Cr,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new Cr,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((r,n)=>this._getKey(r)-this._getKey(n)),t=0,s=0,i=new Array(this._array.length+this._insertedValues.length);for(let r=0;r<i.length;r++)s>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[s])?(i[r]=e[t],t++):i[r]=this._array[s++];this._array=i,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(Ne=this._search(t),Ne===-1)||this._getKey(this._array[Ne])!==t)return!1;do if(this._array[Ne]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(Ne),!0;while(++Ne<this._array.length&&this._getKey(this._array[Ne])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((r,n)=>r-n),t=0,s=new Array(this._array.length-e.length),i=0;for(let r=0;r<this._array.length;r++)e[t]===r?t++:s[i++]=this._array[r];this._array=s,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Ne=this._search(e),!(Ne<0||Ne>=this._array.length)&&this._getKey(this._array[Ne])===e))do yield this._array[Ne];while(++Ne<this._array.length&&this._getKey(this._array[Ne])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(Ne=this._search(e),!(Ne<0||Ne>=this._array.length)&&this._getKey(this._array[Ne])===e))do t(this._array[Ne]);while(++Ne<this._array.length&&this._getKey(this._array[Ne])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,s=this._array.length-1;for(;s>=t;){let i=t+s>>1,r=this._getKey(this._array[i]);if(r>e)s=i-1;else if(r<e)t=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===e;)i--;return i}}return t}},pn=0,ua=0,zm=class extends he{constructor(){super(),this._decorations=new Fm(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this._register(new W),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new W),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(De(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new Km(e);if(t){let s=t.marker.onDispose(()=>t.dispose()),i=t.onDispose(()=>{i.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),s.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,s){let i=0,r=0;for(let n of this._decorations.getKeyIterator(t))i=n.options.x??0,r=i+(n.options.width??1),e>=i&&e<r&&(!s||(n.options.layer??"bottom")===s)&&(yield n)}forEachDecorationAtCell(e,t,s,i){this._decorations.forEachByKey(t,r=>{pn=r.options.x??0,ua=pn+(r.options.width??1),e>=pn&&e<ua&&(!s||(r.options.layer??"bottom")===s)&&i(r)})}},Km=class extends Cs{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new W),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new W),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=Pe.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=Pe.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},Um=1e3,Vm=class{constructor(e,t=Um){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,s){this._rowCount=s,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let i=performance.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){let r=i-this._lastRefreshMs,n=this._debounceThresholdMS-r;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},n)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},da=20,xr=class extends he{constructor(e,t,s,i){super(),this._terminal=e,this._coreBrowserService=s,this._renderService=i,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let r=this._coreBrowserService.mainDocument;this._accessibilityContainer=r.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=r.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=r.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new Vm(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(n=>this._handleResize(n.rows))),this._register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(n=>this._handleChar(n))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(n=>this._handleTab(n))),this._register(this._terminal.onKey(n=>this._handleKey(n.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(se(r,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(De(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<da+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===da+1&&(this._liveRegion.textContent+=Bn.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let s=this._terminal.buffer,i=s.lines.length.toString();for(let r=e;r<=t;r++){let n=s.lines.get(s.ydisp+r),o=[],l=(n==null?void 0:n.translateToString(!0,void 0,void 0,o))||"",a=(s.ydisp+r+1).toString(),h=this._rowElements[r];h&&(l.length===0?(h.textContent="",this._rowColumns.set(h,[0,1])):(h.textContent=l,this._rowColumns.set(h,o)),h.setAttribute("aria-posinset",a),h.setAttribute("aria-setsize",i),this._alignRowWidth(h))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let s=e.target,i=this._rowElements[t===0?1:this._rowElements.length-2],r=s.getAttribute("aria-posinset"),n=t===0?"1":`${this._terminal.buffer.lines.length}`;if(r===n||e.relatedTarget!==i)return;let o,l;if(t===0?(o=s,l=this._rowElements.pop(),this._rowContainer.removeChild(l)):(o=this._rowElements.shift(),l=s,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),l.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let a=this._createAccessibilityTreeNode();this._rowElements.unshift(a),this._rowContainer.insertAdjacentElement("afterbegin",a)}else{let a=this._createAccessibilityTreeNode();this._rowElements.push(a),this._rowContainer.appendChild(a)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var l;if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},s={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(s.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===s.node&&t.offset>s.offset)&&([t,s]=[s,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let i=this._rowElements.slice(-1)[0];if(s.node.compareDocumentPosition(i)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(s={node:i,offset:((l=i.textContent)==null?void 0:l.length)??0}),!this._rowContainer.contains(s.node))return;let r=({node:a,offset:h})=>{let c=a instanceof Text?a.parentNode:a,u=parseInt(c==null?void 0:c.getAttribute("aria-posinset"),10)-1;if(isNaN(u))return console.warn("row is invalid. Race condition?"),null;let d=this._rowColumns.get(c);if(!d)return console.warn("columns is null. Race condition?"),null;let f=h<d.length?d[h]:d.slice(-1)[0]+1;return f>=this._terminal.cols&&(++u,f=0),{row:u,column:f}},n=r(t),o=r(s);if(!(!n||!o)){if(n.row>o.row||n.row===o.row&&n.column>=o.column)throw new Error("invalid range");this._terminal.select(n.column,n.row,(o.row-n.row)*this._terminal.cols-n.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){var r,n;e.style.transform="";let t=e.getBoundingClientRect().width,s=(n=(r=this._rowColumns.get(e))==null?void 0:r.slice(-1))==null?void 0:n[0];if(!s)return;let i=s*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${i/t})`}};xr=Ae([Y(1,Bo),Y(2,cs),Y(3,us)],xr);var co=class extends he{constructor(e,t,s,i,r){super(),this._element=e,this._mouseService=t,this._renderService=s,this._bufferService=i,this._linkProviderService=r,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new W),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new W),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(De(()=>{var n;$s(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,(n=this._activeProviderReplies)==null||n.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(se(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(se(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(se(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(se(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let s=e.composedPath();for(let i=0;i<s.length;i++){let r=s[i];if(r.classList.contains("xterm"))break;if(r.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){var i,r;(!this._activeProviderReplies||!t)&&((i=this._activeProviderReplies)==null||i.forEach(n=>{n==null||n.forEach(o=>{o.link.dispose&&o.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let s=!1;for(let[n,o]of this._linkProviderService.linkProviders.entries())t?(r=this._activeProviderReplies)!=null&&r.get(n)&&(s=this._checkLinkProviderResult(n,e,s)):o.provideLinks(e.y,l=>{var h,c;if(this._isMouseOut)return;let a=l==null?void 0:l.map(u=>({link:u}));(h=this._activeProviderReplies)==null||h.set(n,a),s=this._checkLinkProviderResult(n,e,s),((c=this._activeProviderReplies)==null?void 0:c.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let s=new Set;for(let i=0;i<t.size;i++){let r=t.get(i);if(r)for(let n=0;n<r.length;n++){let o=r[n],l=o.link.range.start.y<e?0:o.link.range.start.x,a=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let h=l;h<=a;h++){if(s.has(h)){r.splice(n--,1);break}s.add(h)}}}}_checkLinkProviderResult(e,t,s){var n;if(!this._activeProviderReplies)return s;let i=this._activeProviderReplies.get(e),r=!1;for(let o=0;o<e;o++)(!this._activeProviderReplies.has(o)||this._activeProviderReplies.get(o))&&(r=!0);if(!r&&i){let o=i.find(l=>this._linkAtPosition(l.link,t));o&&(s=!0,this._handleNewLink(o))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!s)for(let o=0;o<this._activeProviderReplies.size;o++){let l=(n=this._activeProviderReplies.get(o))==null?void 0:n.find(a=>this._linkAtPosition(a.link,t));if(l){s=!0,this._handleNewLink(l);break}}return s}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&jm(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,$s(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.pointerCursor},set:s=>{var i;(i=this._currentLink)!=null&&i.state&&this._currentLink.state.decorations.pointerCursor!==s&&(this._currentLink.state.decorations.pointerCursor=s,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",s))}},underline:{get:()=>{var s,i;return(i=(s=this._currentLink)==null?void 0:s.state)==null?void 0:i.decorations.underline},set:s=>{var i,r,n;(i=this._currentLink)!=null&&i.state&&((n=(r=this._currentLink)==null?void 0:r.state)==null?void 0:n.decorations.underline)!==s&&(this._currentLink.state.decorations.underline=s,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,s))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(s=>{if(!this._currentLink)return;let i=s.start===0?0:s.start+1+this._bufferService.buffer.ydisp,r=this._bufferService.buffer.ydisp+1+s.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=r&&(this._clearCurrentLink(i,r),this._lastMouseEvent)){let n=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);n&&this._askForLink(n,!1)}})))}_linkHover(e,t,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(s,t.text)}_fireUnderlineEvent(e,t){let s=e.range,i=this._bufferService.buffer.ydisp,r=this._createLinkUnderlineEvent(s.start.x-1,s.start.y-i-1,s.end.x,s.end.y-i-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(r)}_linkLeave(e,t,s){var i;(i=this._currentLink)!=null&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(s,t.text)}_linkAtPosition(e,t){let s=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,r=t.y*this._bufferService.cols+t.x;return s<=r&&r<=i}_positionFromMouseEvent(e,t,s){let i=s.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,s,i,r){return{x1:e,y1:t,x2:s,y2:i,cols:this._bufferService.cols,fg:r}}};co=Ae([Y(1,Do),Y(2,us),Y(3,pt),Y(4,Fh)],co);function jm(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var qm=class extends $m{constructor(e={}){super(e),this._linkifier=this._register(new ti),this.browser=oc,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new ti),this._onCursorMove=this._register(new W),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new W),this.onKey=this._onKey.event,this._onRender=this._register(new W),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new W),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new W),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new W),this.onBell=this._onBell.event,this._onFocus=this._register(new W),this._onBlur=this._register(new W),this._onA11yCharEmitter=this._register(new W),this._onA11yTabEmitter=this._register(new W),this._onWillOpen=this._register(new W),this._setup(),this._decorationService=this._instantiationService.createInstance(zm),this._instantiationService.setService(Fi,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Ov),this._instantiationService.setService(Fh,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(Tn)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh((t==null?void 0:t.start)??0,(t==null?void 0:t.end)??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(nt.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(nt.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(nt.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(nt.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(De(()=>{var t,s;this._customKeyEventHandler=void 0,(s=(t=this.element)==null?void 0:t.parentNode)==null||s.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let s,i="";switch(t.index){case 256:s="foreground",i="10";break;case 257:s="background",i="11";break;case 258:s="cursor",i="12";break;default:s="ansi",i="4;"+t.index}switch(t.type){case 0:let r=Me.toColorRGB(s==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[s]);this.coreService.triggerDataEvent(`${E.ESC}]${i};${Pm(r)}${rc.ST}`);break;case 1:if(s==="ansi")this._themeService.modifyColors(n=>n.ansi[t.index]=Ke.toColor(...t.color));else{let n=s;this._themeService.modifyColors(o=>o[n]=Ke.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(xr,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var e;return(e=this.textarea)==null?void 0:e.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(E.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let s=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,r=t.getWidth(s),n=this._renderService.dimensions.css.cell.width*r,o=this.buffer.y*this._renderService.dimensions.css.cell.height,l=s*this._renderService.dimensions.css.cell.width;this.textarea.style.left=l+"px",this.textarea.style.top=o+"px",this.textarea.style.width=n+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(se(this.element,"copy",t=>{this.hasSelection()&&Jp(t,this._selectionService)}));let e=t=>Zp(t,this.textarea,this.coreService,this.optionsService);this._register(se(this.textarea,"paste",e)),this._register(se(this.element,"paste",e)),lc?this._register(se(this.element,"mousedown",t=>{t.button===2&&wl(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(se(this.element,"contextmenu",t=>{wl(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),$o&&this._register(se(this.element,"auxclick",t=>{t.button===1&&Ph(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(se(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(se(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(se(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(se(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(se(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(se(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(se(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){var r;if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((r=this.element)==null?void 0:r.ownerDocument.defaultView)&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(se(this.screenElement,"mousemove",n=>this.updateCursorStyle(n))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let s=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",Rn.get()),cc||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>s.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(Iv,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(cs,this._coreBrowserService),this._register(se(this.textarea,"focus",n=>this._handleTextAreaFocus(n))),this._register(se(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(Zn,this._document,this._helperContainer),this._instantiationService.setService(zr,this._charSizeService),this._themeService=this._instantiationService.createInstance(so),this._instantiationService.setService(si,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(yr),this._instantiationService.setService(Wh,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(eo,this.rows,this.screenElement)),this._instantiationService.setService(us,this._renderService),this._register(this._renderService.onRenderedViewportChange(n=>this._onRender.fire(n))),this.onResize(n=>this._renderService.resize(n.cols,n.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Xn,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(Qn),this._instantiationService.setService(Do,this._mouseService);let i=this._linkifier.value=this._register(this._instantiationService.createInstance(co,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(qn,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(n=>{super.scrollLines(n,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(to,this.element,this.screenElement,i)),this._instantiationService.setService(og,this._selectionService),this._register(this._selectionService.onRequestScrollLines(n=>this.scrollLines(n.amount,n.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(n=>this._renderService.handleSelectionChanged(n.start,n.end,n.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(n=>{this.textarea.value=n,this.textarea.focus(),this.textarea.select()})),this._register(nt.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{var n;this._selectionService.refresh(),(n=this._viewport)==null||n.queueSync()})),this._register(this._instantiationService.createInstance(Yn,this.screenElement)),this._register(se(this.element,"mousedown",n=>this._selectionService.handleMouseDown(n))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(xr,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",n=>this._handleScreenReaderModeOptionChange(n))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(br,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",n=>{!this._overviewRulerRenderer&&n&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(br,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(Jn,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function s(n){var h,c,u,d,f;let o=e._mouseService.getMouseReportCoords(n,e.screenElement);if(!o)return!1;let l,a;switch(n.overrideType||n.type){case"mousemove":a=32,n.buttons===void 0?(l=3,n.button!==void 0&&(l=n.button<3?n.button:3)):l=n.buttons&1?0:n.buttons&4?1:n.buttons&2?2:3;break;case"mouseup":a=0,l=n.button<3?n.button:3;break;case"mousedown":a=1,l=n.button<3?n.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(n)===!1)return!1;let _=n.deltaY;if(_===0||e.coreMouseService.consumeWheelEvent(n,(d=(u=(c=(h=e._renderService)==null?void 0:h.dimensions)==null?void 0:c.device)==null?void 0:u.cell)==null?void 0:d.height,(f=e._coreBrowserService)==null?void 0:f.dpr)===0)return!1;a=_<0?0:1,l=4;break;default:return!1}return a===void 0||l===void 0||l>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:l,action:a,ctrl:n.ctrlKey,alt:n.altKey,shift:n.shiftKey})}let i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},r={mouseup:n=>(s(n),n.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(n)),wheel:n=>(s(n),this.cancel(n,!0)),mousedrag:n=>{n.buttons&&s(n)},mousemove:n=>{n.buttons||s(n)}};this._register(this.coreMouseService.onProtocolChange(n=>{n?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(n)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),n&8?i.mousemove||(t.addEventListener("mousemove",r.mousemove),i.mousemove=r.mousemove):(t.removeEventListener("mousemove",i.mousemove),i.mousemove=null),n&16?i.wheel||(t.addEventListener("wheel",r.wheel,{passive:!1}),i.wheel=r.wheel):(t.removeEventListener("wheel",i.wheel),i.wheel=null),n&2?i.mouseup||(i.mouseup=r.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),i.mouseup=null),n&4?i.mousedrag||(i.mousedrag=r.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(se(t,"mousedown",n=>{if(n.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(n)))return s(n),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(n)})),this._register(se(t,"wheel",n=>{var o,l,a,h,c;if(!i.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(n)===!1)return!1;if(!this.buffer.hasScrollback){if(n.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(n,(h=(a=(l=(o=e._renderService)==null?void 0:o.dimensions)==null?void 0:l.device)==null?void 0:a.cell)==null?void 0:h.height,(c=e._coreBrowserService)==null?void 0:c.dpr)===0)return this.cancel(n,!0);let u=E.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(n.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(u,!0),this.cancel(n,!0)}}},{passive:!1}))}refresh(e,t){var s;(s=this._renderService)==null||s.refreshRows(e,t)}updateCursorStyle(e){var t;(t=this._selectionService)!=null&&t.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){Th(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,s){this._selectionService.setSelection(e,t,s)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var e;(e=this._selectionService)==null||e.clearSelection()}selectAll(){var e;(e=this._selectionService)==null||e.selectAll()}selectLines(e,t){var s;(s=this._selectionService)==null||s.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let s=Wm(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),s.type===3||s.type===2){let i=this.rows-1;return this.scrollLines(s.type===2?-i:i),this.cancel(e,!0)}if(s.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(s.cancel&&this.cancel(e,!0),!s.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((s.key===E.ETX||s.key===E.CR)&&(this.textarea.value=""),this._onKey.fire({key:s.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(s.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let s=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?s:s&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(Ym(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){var s;(s=this._charSizeService)==null||s.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(ze));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){var t;this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),(t=this._selectionService)==null||t.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){var e;(e=this._renderService)==null||e.clearTextureAtlas()}_reportFocus(){var e;(e=this.element)!=null&&e.classList.contains("focus")?this.coreService.triggerDataEvent(E.ESC+"[I"):this.coreService.triggerDataEvent(E.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),s=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${E.ESC}[4;${s};${t}t`);break;case 1:let i=this._renderService.dimensions.css.cell.width.toFixed(0),r=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${E.ESC}[6;${r};${i}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function Ym(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var Xm=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let s={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(s),t.dispose=()=>this._wrappedAddonDispose(s),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===e){t=s;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},Gm=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new Pt)}translateToString(e,t,s){return this._line.translateToString(e,t,s)}},fa=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new Gm(t)}getNullCell(){return new Pt}},Jm=class extends he{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new W),this.onBufferChange=this._onBufferChange.event,this._normal=new fa(this._core.buffers.normal,"normal"),this._alternate=new fa(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},Zm=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,s=>t(s.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(s,i)=>t(s,i.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},Qm=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},e0=["cols","rows"],Wt=0,t0=class extends he{constructor(e){super(),this._core=this._register(new qm(e)),this._addonManager=this._register(new Xm),this._publicOptions={...this._core.options};let t=i=>this._core.options[i],s=(i,r)=>{this._checkReadonlyOptions(i),this._core.options[i]=r};for(let i in this._core.options){let r={get:t.bind(this,i),set:s.bind(this,i)};Object.defineProperty(this._publicOptions,i,r)}}_checkReadonlyOptions(e){if(e0.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new Zm(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new Qm(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new Jm(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,s){this._verifyIntegers(e,t,s),this._core.select(e,t,s)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return Rn.get()},set promptLabel(e){Rn.set(e)},get tooMuchOutput(){return Bn.get()},set tooMuchOutput(e){Bn.set(e)}}}_verifyIntegers(...e){for(Wt of e)if(Wt===1/0||isNaN(Wt)||Wt%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(Wt of e)if(Wt&&(Wt===1/0||isNaN(Wt)||Wt%1!==0||Wt<0))throw new Error("This API only accepts positive integers")}};/**
 * Copyright (c) 2014-2024 The xterm.js authors. All rights reserved.
 * @license MIT
 *
 * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)
 * @license MIT
 *
 * Originally forked from (with the author's permission):
 *   Fabrice Bellard's javascript vt100 for jslinux:
 *   http://bellard.org/jslinux/
 *   Copyright (c) 2011 Fabrice Bellard
 */var s0=2,i0=1,r0=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){var u;if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:((u=this._terminal.options.overviewRuler)==null?void 0:u.width)||14,s=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(s.getPropertyValue("height")),r=Math.max(0,parseInt(s.getPropertyValue("width"))),n=window.getComputedStyle(this._terminal.element),o={top:parseInt(n.getPropertyValue("padding-top")),bottom:parseInt(n.getPropertyValue("padding-bottom")),right:parseInt(n.getPropertyValue("padding-right")),left:parseInt(n.getPropertyValue("padding-left"))},l=o.top+o.bottom,a=o.right+o.left,h=i-l,c=r-a-t;return{cols:Math.max(s0,Math.floor(c/e.css.cell.width)),rows:Math.max(i0,Math.floor(h/e.css.cell.height))}}};const n0={class:"h-full flex flex-col bg-monitor-bg-primary"},o0={class:"p-3 border-b border-slate-700 flex items-center justify-between"},l0={class:"flex items-center gap-2"},a0={class:"text-xs text-monitor-text-muted"},h0={key:0,class:"flex-1 flex items-center justify-center p-4"},c0={key:1,class:"flex-1 flex flex-col overflow-hidden"},u0={class:"flex border-b border-slate-700 overflow-x-auto"},d0=["onClick"],f0={class:"ml-2"},_0={key:0,class:"ml-2 text-xs text-green-400"},p0={key:0,class:"flex-1 flex flex-col overflow-hidden"},g0={class:"px-3 py-2 bg-slate-800/50 border-b border-slate-700 flex items-center justify-between"},v0={class:"flex items-center space-x-3"},m0={class:"text-xs text-monitor-accent-cyan"},S0={class:"text-xs text-slate-400"},b0={class:"flex items-center gap-3"},y0={key:1,class:"flex-1 flex items-center justify-center p-4"},w0={key:2,class:"border-t border-slate-700 p-3 bg-green-900/20"},C0={class:"text-xs text-green-400 mb-2"},x0={class:"flex flex-wrap gap-2"},k0=["onClick"],E0=Gt({__name:"WrapperPanel",setup(e){const t=hs(),s=ue(null),i=ue(new Map),r=_e(()=>t.wrappers),n=_e(()=>t.activeWrappers),o=_e(()=>t.selectedWrapper),l=_e(()=>t.wrappersWaitingInput);function a(m){if(i.value.has(m))return i.value.get(m);const y=new t0({cursorBlink:!0,cursorStyle:"block",fontSize:13,fontFamily:'Menlo, Monaco, "Courier New", monospace',theme:{background:"#0f172a",foreground:"#e2e8f0",cursor:"#22d3ee",cursorAccent:"#0f172a",selectionBackground:"#334155",black:"#1e293b",red:"#ef4444",green:"#22c55e",yellow:"#eab308",blue:"#3b82f6",magenta:"#a855f7",cyan:"#22d3ee",white:"#f1f5f9",brightBlack:"#475569",brightRed:"#f87171",brightGreen:"#4ade80",brightYellow:"#facc15",brightBlue:"#60a5fa",brightMagenta:"#c084fc",brightCyan:"#67e8f9",brightWhite:"#f8fafc"},scrollback:1e4,convertEol:!1,allowProposedApi:!0}),k=new r0;return y.loadAddon(k),y.onData(C=>{t.injectInput(m,C)}),y.onResize(({cols:C,rows:N})=>{t.resizeWrapper(m,C,N)}),i.value.set(m,{terminal:y,fitAddon:k}),{terminal:y,fitAddon:k}}async function h(m){if(await Qs(),!s.value)return;const y=a(m);if(!y)return;const{terminal:k,fitAddon:C}=y;if(s.value.querySelector(".xterm")){try{C.fit()}catch{}return}s.value.innerHTML="",k.open(s.value),await Qs();try{C.fit(),t.resizeWrapper(m,k.cols,k.rows)}catch{}k.focus()}function c(m,y){const k=i.value.get(m);k&&k.terminal.write(y)}As(()=>t.selectedWrapperId,async(m,y)=>{if(m){await h(m);const k=i.value.get(m);k&&k.terminal.focus()}},{immediate:!0}),As(()=>t.lastWrapperOutput,m=>{m&&c(m.wrapperId,m.data)});function u(){if(t.selectedWrapperId){const m=i.value.get(t.selectedWrapperId);if(m)try{m.fitAddon.fit()}catch{}}}Or(()=>{window.addEventListener("resize",u)}),$i(()=>{window.removeEventListener("resize",u);for(const[,{terminal:m}]of i.value)m.dispose();i.value.clear()});function d(m){t.selectWrapper(m)}function f(){t.spawnWrapper({cols:120,rows:40})}function _(m){confirm(`Are you sure you want to kill wrapper ${m}?`)&&t.killWrapper(m)}function v(m){switch(m){case"waiting_input":return"text-green-400";case"processing":return"text-yellow-400";case"starting":return"text-blue-400";case"ended":return"text-gray-500";default:return"text-gray-400"}}function b(m){switch(m){case"waiting_input":return"";case"processing":return"";case"starting":return"";case"ended":return"";default:return""}}return(m,y)=>(R(),B("div",n0,[p("div",o0,[y[3]||(y[3]=p("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Claude Wrappers ",-1)),p("div",l0,[p("span",a0,j(n.value.length)+" active ",1),p("button",{class:"px-2 py-1 bg-monitor-accent-cyan/20 text-monitor-accent-cyan rounded text-xs hover:bg-monitor-accent-cyan/30 transition-colors flex items-center gap-1",onClick:f,title:"Spawn new Claude Code session"},[...y[2]||(y[2]=[p("span",null,"+",-1),p("span",null,"New",-1)])])])]),r.value.length===0?(R(),B("div",h0,[p("div",{class:"text-center text-monitor-text-muted"},[y[4]||(y[4]=Mo('<p class="text-sm" data-v-05cc1497>No wrapper sessions</p><p class="text-xs mt-2" data-v-05cc1497>Click the <span class="text-monitor-accent-cyan" data-v-05cc1497>+ New</span> button above to spawn a Claude Code session</p><p class="text-xs mt-1" data-v-05cc1497>or run <code class="bg-slate-700 px-1 rounded" data-v-05cc1497>contextuate claude</code> from terminal</p>',3)),p("button",{class:"mt-4 px-4 py-2 bg-monitor-accent-cyan/20 text-monitor-accent-cyan rounded hover:bg-monitor-accent-cyan/30 transition-colors",onClick:f}," Spawn Claude Code Session ")])])):(R(),B("div",c0,[p("div",u0,[(R(!0),B(ye,null,_t(r.value,k=>(R(),B("button",{key:k.wrapperId,class:ve(["px-3 py-2 text-sm whitespace-nowrap border-b-2 transition-colors",[$e(t).selectedWrapperId===k.wrapperId?"border-monitor-accent-cyan text-monitor-accent-cyan bg-slate-800":"border-transparent text-monitor-text-secondary hover:text-monitor-text-primary hover:bg-slate-800/50"]]),onClick:C=>d(k.wrapperId)},[p("span",{class:ve(v(k.state))},j(b(k.state)),3),p("span",f0,j(k.wrapperId),1),k.state==="waiting_input"?(R(),B("span",_0,"(ready)")):Z("",!0)],10,d0))),128))]),o.value?(R(),B("div",p0,[p("div",g0,[p("div",v0,[y[6]||(y[6]=p("span",{class:"text-xs text-monitor-text-muted"},"ID:",-1)),p("code",m0,j(o.value.wrapperId),1),y[7]||(y[7]=p("span",{class:"text-xs text-monitor-text-muted"},"State:",-1)),p("span",{class:ve([v(o.value.state),"text-xs font-medium"])},j(o.value.state),3),o.value.claudeSessionId?(R(),B(ye,{key:0},[y[5]||(y[5]=p("span",{class:"text-xs text-monitor-text-muted"},"Session:",-1)),p("code",S0,j(o.value.claudeSessionId.slice(0,8)),1)],64)):Z("",!0)]),p("div",b0,[y[8]||(y[8]=p("span",{class:"text-xs text-monitor-text-muted"}," Click terminal to type directly ",-1)),o.value.state!=="ended"?(R(),B("button",{key:0,class:"px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs hover:bg-red-500/30 transition-colors",onClick:y[0]||(y[0]=k=>_(o.value.wrapperId)),title:"Kill this wrapper session"}," Kill ")):Z("",!0)])]),p("div",{ref_key:"terminalContainerRef",ref:s,class:"flex-1 overflow-hidden",onClick:y[1]||(y[1]=()=>{const k=i.value.get($e(t).selectedWrapperId||"");k&&k.terminal.focus()})},null,512)])):(R(),B("div",y0,[...y[9]||(y[9]=[p("p",{class:"text-sm text-monitor-text-muted"},"Select a wrapper to view terminal",-1)])]))])),l.value.length>0&&!o.value?(R(),B("div",w0,[p("div",C0,j(l.value.length)+" wrapper(s) waiting for input ",1),p("div",x0,[(R(!0),B(ye,null,_t(l.value,k=>(R(),B("button",{key:k.wrapperId,class:"px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-500 transition-colors",onClick:C=>d(k.wrapperId)},j(k.wrapperId),9,k0))),128))])])):Z("",!0)]))}}),M0=Bh(E0,[["__scopeId","data-v-05cc1497"]]),R0={class:"min-h-screen bg-monitor-bg-primary text-monitor-text-primary"},B0={class:"bg-monitor-bg-secondary border-b border-slate-700 px-4 py-3"},D0={class:"flex items-center justify-between"},T0={class:"flex items-center space-x-4"},P0={class:"flex items-center space-x-4"},L0={class:"flex items-center space-x-2"},I0={class:"text-monitor-text-muted text-sm"},A0={key:0,class:"w-2 h-2 rounded-full bg-white animate-pulse"},O0={class:"flex h-[calc(100vh-120px)]"},N0={class:"w-72 border-r border-slate-700 flex flex-col"},$0={class:"flex-1 flex flex-col"},H0={class:"h-32 border-b border-slate-700"},W0={key:0,class:"h-1/2 border-t border-slate-700 flex flex-col"},F0={class:"w-80 border-l border-slate-700 flex flex-col"},z0=Gt({__name:"App",setup(e){const t=hs(),s=ue(!1),i=_e(()=>{switch(t.connectionStatus){case"connected":return"status-connected";case"connecting":return"status-connecting";default:return"status-disconnected"}});function r(o){(o.key==="Control"||o.key==="Meta")&&t.setCtrlPressed(!0)}function n(o){(o.key==="Control"||o.key==="Meta")&&t.setCtrlPressed(!1)}return Or(()=>{t.connect(),window.addEventListener("keydown",r),window.addEventListener("keyup",n),window.addEventListener("blur",()=>t.setCtrlPressed(!1))}),$i(()=>{t.disconnect(),window.removeEventListener("keydown",r),window.removeEventListener("keyup",n),window.removeEventListener("blur",()=>t.setCtrlPressed(!1))}),(o,l)=>(R(),B("div",R0,[p("header",B0,[p("div",D0,[p("div",T0,[l[1]||(l[1]=p("img",{src:tf,alt:"Contextuate",class:"h-8 w-auto"},null,-1)),l[2]||(l[2]=p("h1",{class:"text-xl font-semibold"},[p("span",{class:"text-monitor-accent-cyan"},"Contextuate"),p("span",{class:"text-monitor-text-secondary ml-2"},"Monitor")],-1)),He(Lp)]),p("div",P0,[p("div",L0,[p("span",{class:ve(["w-2 h-2 rounded-full",{"bg-green-500 animate-pulse-dot":$e(t).connectionStatus==="connected","bg-yellow-500 animate-pulse":$e(t).connectionStatus==="connecting","bg-red-500":$e(t).connectionStatus==="disconnected"}])},null,2),p("span",{class:ve(["text-sm",i.value])},j($e(t).connectionStatus),3)]),p("span",I0,j($e(t).sessions.length)+" session(s) ",1),p("button",{class:ve(["flex items-center space-x-2 px-3 py-1 rounded text-sm transition-colors",[$e(t).activeWrappers.length>0?"bg-green-600 text-white hover:bg-green-500":s.value?"bg-monitor-accent-cyan text-white":"bg-slate-700 text-monitor-text-secondary hover:bg-slate-600"]]),onClick:l[0]||(l[0]=a=>s.value=!s.value)},[$e(t).activeWrappers.length>0?(R(),B("span",A0)):Z("",!0),p("span",null,"Wrappers ("+j($e(t).activeWrappers.length)+")",1)],2)])])]),He(jp,{class:"border-b border-slate-700"}),p("main",O0,[p("aside",N0,[l[3]||(l[3]=p("div",{class:"p-3 border-b border-slate-700"},[p("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Sessions ")],-1)),He(r_,{class:"flex-1 overflow-y-auto"})]),p("div",$0,[p("div",H0,[He(sp)]),p("div",{class:ve(["flex-1 overflow-hidden",{"h-1/2":s.value}])},[He(z_)],2),s.value?(R(),B("div",W0,[He(M0)])):Z("",!0)]),p("aside",F0,[l[4]||(l[4]=p("div",{class:"p-3 border-b border-slate-700"},[p("h2",{class:"text-sm font-medium text-monitor-text-secondary uppercase tracking-wide"}," Token Usage ")],-1)),He(Rp,{class:"flex-1 overflow-y-auto"})])])]))}}),bc=Vd(z0),K0=Yd();bc.use(K0);bc.mount("#app");
